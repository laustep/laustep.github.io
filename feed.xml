<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"
    xmlns:dc="http://purl.org/dc/elements/1.1/">
    <channel>
        <title>Saturn Elephant</title>
        <link>https://laustep.github.io/stlahblog</link>
        <description><![CDATA[A blog about R and more.]]></description>
        <atom:link href="https://laustep.github.io/stlahblog/feed.xml" rel="self"
                   type="application/rss+xml" />
        <lastBuildDate>Fri, 09 Oct 2020 00:00:00 UT</lastBuildDate>
        <item>
    <title>My RGL artworks</title>
    <link>https://laustep.github.io/stlahblog/posts/MyRGLartworks.html</link>
    <description><![CDATA[
  <link href="https://laustep.github.io/stlahblog/libraries/bootstrap/bootstrap-grid.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://laustep.github.io/stlahblog/css/default2.css" />
  <link rel="stylesheet" href="https://laustep.github.io/stlahblog/css/post.css" />
  <link rel="stylesheet" href="https://laustep.github.io/stlahblog/css/misc.css" />

    <link rel="stylesheet" href="https://laustep.github.io/stlahblog/css/pandoc-solarized.css" />


  <link href="https://fonts.googleapis.com/css?family=Raleway:400,600,200,800" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Droid+Sans" rel="stylesheet" type="text/css">
  <script src="https://laustep.github.io/stlahblog/libraries/jquery.min.js"></script>
  <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>

  <div class="container-fluid">
    <div class="row">
      <div class="main col-sm-12">
        <div id="header">
          <div id="logo" style="position:absolute;">
            <a href="https://laustep.github.io/stlahblog/">
              <img src="https://laustep.github.io/stlahblog/images/stla.jpg" alt="stla" width="100px" />
            </a>
          </div>
          <div id="navigation" style="margin-top:50px;">
            <a href="https://laustep.github.io/stlahblog/">Home</a>
            <a href="https://laustep.github.io/stlahblog/about.html">About</a>
            <a href="https://laustep.github.io/stlahblog/contact.html">Contact</a>
            <a href="https://laustep.github.io/stlahblog/archive.html">Archive</a>
          </div>
        </div>

        <div class="content">
          <h1>My RGL artworks</h1>
          <div class="info">
    Posted on October  8, 2020

        by Stéphane Laurent

</div>
<div class="info">

    Tags: <a href="https://laustep.github.io/stlahblog/tags/geometry.html">geometry</a>, <a href="https://laustep.github.io/stlahblog/tags/graphics.html">graphics</a>, <a href="https://laustep.github.io/stlahblog/tags/R.html">R</a>, <a href="https://laustep.github.io/stlahblog/tags/rgl.html">rgl</a>

</div>

<p>These are some of my artworks realized with the R package <code>rgl</code>. Source code is available in <a href="https://gist.github.com/stla">my gists</a>.</p>
<p><img src="https://camo.githubusercontent.com/3a27a77e8d60a10ea347017bb4f78a85f28dce7f/68747470733a2f2f7468756d62732e6766796361742e636f6d2f45737465656d656453686f7779446f6c7068696e2d73697a655f726573747269637465642e676966" /></p>
<p><img src="https://camo.githubusercontent.com/62bb1cef024c3353381dbadfdb75d8839d5ed1e3/68747470733a2f2f7468756d62732e6766796361742e636f6d2f48656c7066756c506c6173746963416e74626561722d73697a655f726573747269637465642e676966" /></p>
<p><img src="https://camo.githubusercontent.com/5ea6d902f0f85b3fff29e87251e6977e28ba0c3c/68747470733a2f2f7468756d62732e6766796361742e636f6d2f506c756d70496d70617373696f6e65644265617665722d73697a655f726573747269637465642e676966" /></p>
<p><img src="https://camo.githubusercontent.com/978e0f0f42673e22685f350e3c6dd6b1c8fe6dff/68747470733a2f2f7468756d62732e6766796361742e636f6d2f4269746573697a6564457175616c476175722d73697a655f726573747269637465642e676966" /></p>
<p><img src="https://camo.githubusercontent.com/93c6b1b2f80818492f9714858d7fc0ffe66f3266/68747470733a2f2f7468756d62732e6766796361742e636f6d2f416d626974696f757354616d6541646461782d73697a655f726573747269637465642e676966" /></p>
<p><img src="https://camo.githubusercontent.com/d1e218228c4efdf6085e5ae80f5cc9feeea1e04d/68747470733a2f2f7468756d62732e6766796361742e636f6d2f4b696e64686561727465644f726e6572794865646765686f672d73697a655f726573747269637465642e676966" /></p>
<p><img src="https://camo.githubusercontent.com/dcd38ed43716c092ae0723d1075b32e082a6cd5b/68747470733a2f2f7468756d62732e6766796361742e636f6d2f466c6177656453656c6672656c69616e7443697272697065642d73697a655f726573747269637465642e676966" /></p>
<p><img src="https://camo.githubusercontent.com/5ed40dd4b6e85f75621a47d3dc4230e1ad46dc75/68747470733a2f2f7468756d62732e6766796361742e636f6d2f556e73746561647957656570794672696c6c6e65636b65646c697a6172642d73697a655f726573747269637465642e676966" /></p>
<p><img src="https://camo.githubusercontent.com/14d6b4ef37daab1a761c14cc4e237510958615ae/68747470733a2f2f7468756d62732e6766796361742e636f6d2f59656c6c6f77496465616c496e6368776f726d2d73697a655f726573747269637465642e676966" /></p>
<p><img src="https://camo.githubusercontent.com/9b47e1d657392cd29e9d684864b0d531d701cf18/68747470733a2f2f7468756d62732e6766796361742e636f6d2f426f6e794964656e746963616c426f696c77656576696c2d73697a655f726573747269637465642e676966" /></p>
<p><img src="https://camo.githubusercontent.com/59629ef36e30e73ebf584a45435a5e9fcd8ab1ae/68747470733a2f2f7468756d62732e6766796361742e636f6d2f4c696b656c794561726c7942656e67616c74696765722d73697a655f726573747269637465642e676966" /></p>
<p><img src="https://camo.githubusercontent.com/94af9461f70bf88fed1ce3eaa9fbf0374b5d0883/68747470733a2f2f7468756d62732e6766796361742e636f6d2f5765656b6c79517561727465726c794963746572696e65776172626c65722d73697a655f726573747269637465642e676966" /></p>
<p><img src="https://camo.githubusercontent.com/460582ebfe5d8ef2724fb11970e634385a3ecc4d/68747470733a2f2f7468756d62732e6766796361742e636f6d2f546f726e536e65616b794b6f616c61626561722d73697a655f726573747269637465642e676966" /></p>
<p><img src="https://camo.githubusercontent.com/9cb20d35d9ad95e96c76946e65c3165d91726006/68747470733a2f2f7468756d62732e6766796361742e636f6d2f556e666f7274756e617465436172656672656547726f756e64626565746c652d73697a655f726573747269637465642e676966" /></p>
<p><img src="https://camo.githubusercontent.com/ff1d85320bd032c9082b008b6dec2df37ea073b8/68747470733a2f2f7468756d62732e6766796361742e636f6d2f46616d6f75734c6176697368416e7469706f646573677265656e706172616b6565742d73697a655f726573747269637465642e676966" /></p>
<p><img src="https://camo.githubusercontent.com/6a397f4022cb0794053f7e3f980dbf50e119c10c/68747470733a2f2f7468756d62732e6766796361742e636f6d2f537069666679536d616c6c42757a7a6172642d73697a655f726573747269637465642e676966" /></p>
<p><img src="https://camo.githubusercontent.com/184b3b5000b26e83ea3fe399352105d07df746d5/68747470733a2f2f7468756d62732e6766796361742e636f6d2f43697263756c6172536d6172744861636b65652d73697a655f726573747269637465642e676966" /></p>
<p><img src="https://camo.githubusercontent.com/abacd39b34b5b57c6c9db5d9c11c1b07c59de371/68747470733a2f2f7468756d62732e6766796361742e636f6d2f536572696f7573446972656374426f6e6f626f2d73697a655f726573747269637465642e676966" /></p>

        </div>


        <div id="footer">
          Site proudly generated by
          <a href="http://jaspervdj.be/hakyll">Hakyll</a>
        </div>

      </div>

    </div>

    <div class="row">
      <div class="col-sm-12">
        <div id="disqus_thread"></div>
        <div class="pagination">
          <ul>
            <li>
              <a href="http://laustep.github.io/stlahblog/">&#171; Back Home</a>
            </li>
          </ul>
        </div>
      </div>
    </div>

  </div>


<script src="https://laustep.github.io/stlahblog/libraries/bootstrap/bootstrap.min.js"></script>
<!-- MathJax: Fall back to local if CDN offline but local image fonts are not supported (saves >100MB) -->
<script type="text/x-mathjax-config" src="https://laustep.github.io/stlahblog/libraries/mathjax/config/TeX-MML-AM_CHTML.js"></script>
<!-- <script>
  window.MathJax || document.write('<script type="text/x-mathjax-config">MathJax.Hub.Config({"HTML-CSS":{imageFont:null}});<\/script><script src="https://laustep.github.io/stlahblog/libraries/mathjax/MathJax.js"><\/script>');
</script> -->


]]></description>
    <pubDate>Thu, 08 Oct 2020 00:00:00 UT</pubDate>
    <guid>https://laustep.github.io/stlahblog/posts/MyRGLartworks.html</guid>
    <dc:creator>Stéphane Laurent</dc:creator>

        <category>R</category>

</item>
<item>
    <title>Child tables with DT, editing, exporting</title>
    <link>https://laustep.github.io/stlahblog/posts/DT_childTables.html</link>
    <description>  &lt;link href=&quot;https://laustep.github.io/stlahblog/libraries/bootstrap/bootstrap-grid.min.css&quot; rel=&quot;stylesheet&quot;&gt;
  &lt;link rel=&quot;stylesheet&quot; href=&quot;https://laustep.github.io/stlahblog/css/default2.css&quot; /&gt;
  &lt;link rel=&quot;stylesheet&quot; href=&quot;https://laustep.github.io/stlahblog/css/post.css&quot; /&gt;
  &lt;link rel=&quot;stylesheet&quot; href=&quot;https://laustep.github.io/stlahblog/css/misc.css&quot; /&gt;

    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://laustep.github.io/stlahblog/css/pandoc-solarized.css&quot; /&gt;


    &lt;link href=&quot;https://laustep.github.io/stlahblog/libraries/highlighters/prettify/css/minimal.css&quot; rel=&quot;stylesheet&quot;&gt;

  &lt;link href=&quot;https://fonts.googleapis.com/css?family=Raleway:400,600,200,800&quot; rel=&quot;stylesheet&quot; type=&quot;text/css&quot;&gt;
  &lt;link href=&quot;https://fonts.googleapis.com/css?family=Open+Sans&quot; rel=&quot;stylesheet&quot; type=&quot;text/css&quot;&gt;
  &lt;link href=&quot;https://fonts.googleapis.com/css?family=Droid+Sans&quot; rel=&quot;stylesheet&quot; type=&quot;text/css&quot;&gt;
  &lt;script src=&quot;https://laustep.github.io/stlahblog/libraries/jquery.min.js&quot;&gt;&lt;/script&gt;
  &lt;script type=&quot;text/javascript&quot; async src=&quot;https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML&quot;&gt;&lt;/script&gt;

  &lt;div class=&quot;container-fluid&quot;&gt;
    &lt;div class=&quot;row&quot;&gt;
      &lt;div class=&quot;main col-sm-12&quot;&gt;
        &lt;div id=&quot;header&quot;&gt;
          &lt;div id=&quot;logo&quot; style=&quot;position:absolute;&quot;&gt;
            &lt;a href=&quot;https://laustep.github.io/stlahblog/&quot;&gt;
              &lt;img src=&quot;https://laustep.github.io/stlahblog/images/stla.jpg&quot; alt=&quot;stla&quot; width=&quot;100px&quot; /&gt;
            &lt;/a&gt;
          &lt;/div&gt;
          &lt;div id=&quot;navigation&quot; style=&quot;margin-top:50px;&quot;&gt;
            &lt;a href=&quot;https://laustep.github.io/stlahblog/&quot;&gt;Home&lt;/a&gt;
            &lt;a href=&quot;https://laustep.github.io/stlahblog/about.html&quot;&gt;About&lt;/a&gt;
            &lt;a href=&quot;https://laustep.github.io/stlahblog/contact.html&quot;&gt;Contact&lt;/a&gt;
            &lt;a href=&quot;https://laustep.github.io/stlahblog/archive.html&quot;&gt;Archive&lt;/a&gt;
          &lt;/div&gt;
        &lt;/div&gt;

        &lt;div class=&quot;content&quot;&gt;
          &lt;h1&gt;Child tables with DT, editing, exporting&lt;/h1&gt;
          &lt;div class=&quot;info&quot;&gt;
    Posted on May  8, 2020

        by Stéphane Laurent

&lt;/div&gt;
&lt;div class=&quot;info&quot;&gt;

    Tags: &lt;a href=&quot;https://laustep.github.io/stlahblog/tags/R.html&quot;&gt;R&lt;/a&gt;, &lt;a href=&quot;https://laustep.github.io/stlahblog/tags/datatables.html&quot;&gt;datatables&lt;/a&gt;, &lt;a href=&quot;https://laustep.github.io/stlahblog/tags/shiny.html&quot;&gt;shiny&lt;/a&gt;, &lt;a href=&quot;https://laustep.github.io/stlahblog/tags/javascript.html&quot;&gt;javascript&lt;/a&gt;

&lt;/div&gt;

&lt;p&gt;I&rsquo;m going to show how to use the &lt;code&gt;DT&lt;/code&gt; package to do a table with child tables, and how to edit and export such a table.&lt;/p&gt;
&lt;p&gt;In order to do a table with child tables, one adds a list column to the dataframe of the main table; each cell of this column contains the child table of the corresponding row, given as a list. This is done by the &lt;code&gt;NestedData&lt;/code&gt; function below.&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb1&quot;&gt;&lt;pre class=&quot;sourceCode r&quot;&gt;&lt;code class=&quot;sourceCode r&quot;&gt;&lt;a class=&quot;sourceLine&quot; id=&quot;cb1-1&quot; title=&quot;1&quot;&gt;NestedData &amp;lt;-&lt;span class=&quot;st&quot;&gt; &lt;/span&gt;&lt;span class=&quot;cf&quot;&gt;function&lt;/span&gt;(dat, children){&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb1-2&quot; title=&quot;2&quot;&gt;  &lt;span class=&quot;kw&quot;&gt;stopifnot&lt;/span&gt;(&lt;span class=&quot;kw&quot;&gt;length&lt;/span&gt;(children) &lt;span class=&quot;op&quot;&gt;==&lt;/span&gt;&lt;span class=&quot;st&quot;&gt; &lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;nrow&lt;/span&gt;(dat))&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb1-3&quot; title=&quot;3&quot;&gt;  g &amp;lt;-&lt;span class=&quot;st&quot;&gt; &lt;/span&gt;&lt;span class=&quot;cf&quot;&gt;function&lt;/span&gt;(d){&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb1-4&quot; title=&quot;4&quot;&gt;    &lt;span class=&quot;cf&quot;&gt;if&lt;/span&gt;(&lt;span class=&quot;kw&quot;&gt;is.data.frame&lt;/span&gt;(d)){&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb1-5&quot; title=&quot;5&quot;&gt;      purrr&lt;span class=&quot;op&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;transpose&lt;/span&gt;(d)&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb1-6&quot; title=&quot;6&quot;&gt;    }&lt;span class=&quot;cf&quot;&gt;else&lt;/span&gt;{&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb1-7&quot; title=&quot;7&quot;&gt;      purrr&lt;span class=&quot;op&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;transpose&lt;/span&gt;(&lt;span class=&quot;kw&quot;&gt;NestedData&lt;/span&gt;(d[[&lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;]], &lt;span class=&quot;dt&quot;&gt;children =&lt;/span&gt; d&lt;span class=&quot;op&quot;&gt;$&lt;/span&gt;children))&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb1-8&quot; title=&quot;8&quot;&gt;    }&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb1-9&quot; title=&quot;9&quot;&gt;  }&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb1-10&quot; title=&quot;10&quot;&gt;  subdats &amp;lt;-&lt;span class=&quot;st&quot;&gt; &lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;lapply&lt;/span&gt;(children, g)&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb1-11&quot; title=&quot;11&quot;&gt;  oplus &amp;lt;-&lt;span class=&quot;st&quot;&gt; &lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;ifelse&lt;/span&gt;(&lt;span class=&quot;kw&quot;&gt;lengths&lt;/span&gt;(subdats), &lt;span class=&quot;st&quot;&gt;&amp;quot;&amp;amp;oplus;&amp;quot;&lt;/span&gt;, &lt;span class=&quot;st&quot;&gt;&amp;quot;&amp;quot;&lt;/span&gt;) &lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb1-12&quot; title=&quot;12&quot;&gt;  &lt;span class=&quot;kw&quot;&gt;cbind&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;&amp;quot; &amp;quot;&lt;/span&gt; =&lt;span class=&quot;st&quot;&gt; &lt;/span&gt;oplus, dat, &lt;span class=&quot;st&quot;&gt;&amp;quot;_details&amp;quot;&lt;/span&gt; =&lt;span class=&quot;st&quot;&gt; &lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;I&lt;/span&gt;(subdats), &lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb1-13&quot; title=&quot;13&quot;&gt;        &lt;span class=&quot;dt&quot;&gt;stringsAsFactors =&lt;/span&gt; &lt;span class=&quot;ot&quot;&gt;FALSE&lt;/span&gt;)&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb1-14&quot; title=&quot;14&quot;&gt;}&lt;/a&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The usage of &lt;code&gt;NestedData&lt;/code&gt; is easy to understand with an example:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb2&quot;&gt;&lt;pre class=&quot;sourceCode r&quot;&gt;&lt;code class=&quot;sourceCode r&quot;&gt;&lt;a class=&quot;sourceLine&quot; id=&quot;cb2-1&quot; title=&quot;1&quot;&gt;dat0   =&lt;span class=&quot;st&quot;&gt; &lt;/span&gt;iris[&lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;3&lt;/span&gt;,]        &lt;span class=&quot;co&quot;&gt;# main table, with three rows&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb2-2&quot; title=&quot;2&quot;&gt;dat01  =&lt;span class=&quot;st&quot;&gt; &lt;/span&gt;airquality[&lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;4&lt;/span&gt;,]  &lt;span class=&quot;co&quot;&gt;# |- child of first row&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb2-3&quot; title=&quot;3&quot;&gt;dat02  =&lt;span class=&quot;st&quot;&gt; &lt;/span&gt;cars[&lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;2&lt;/span&gt;,]        &lt;span class=&quot;co&quot;&gt;# |- child of second row, with two rows&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb2-4&quot; title=&quot;4&quot;&gt;dat021 =&lt;span class=&quot;st&quot;&gt; &lt;/span&gt;mtcars[&lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;3&lt;/span&gt;,]      &lt;span class=&quot;co&quot;&gt;# |  |- child of first row of dat02&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb2-5&quot; title=&quot;5&quot;&gt;dat022 =&lt;span class=&quot;st&quot;&gt; &lt;/span&gt;PlantGrowth[&lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;4&lt;/span&gt;,] &lt;span class=&quot;co&quot;&gt;# |  |- child of second row of dat02&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb2-6&quot; title=&quot;6&quot;&gt;dat03  =&lt;span class=&quot;st&quot;&gt; &lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;data.frame&lt;/span&gt;(&lt;span class=&quot;ot&quot;&gt;NULL&lt;/span&gt;)  &lt;span class=&quot;co&quot;&gt;# |- third row has no child&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb2-7&quot; title=&quot;7&quot;&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb2-8&quot; title=&quot;8&quot;&gt;Dat &amp;lt;-&lt;span class=&quot;st&quot;&gt; &lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;NestedData&lt;/span&gt;(&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb2-9&quot; title=&quot;9&quot;&gt;  &lt;span class=&quot;dt&quot;&gt;dat =&lt;/span&gt; dat0, &lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb2-10&quot; title=&quot;10&quot;&gt;  &lt;span class=&quot;dt&quot;&gt;children =&lt;/span&gt; &lt;span class=&quot;kw&quot;&gt;list&lt;/span&gt;(&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb2-11&quot; title=&quot;11&quot;&gt;    dat01, &lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb2-12&quot; title=&quot;12&quot;&gt;    &lt;span class=&quot;kw&quot;&gt;list&lt;/span&gt;(  &lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb2-13&quot; title=&quot;13&quot;&gt;      dat02, &lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb2-14&quot; title=&quot;14&quot;&gt;      &lt;span class=&quot;dt&quot;&gt;children =&lt;/span&gt; &lt;span class=&quot;kw&quot;&gt;list&lt;/span&gt;(&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb2-15&quot; title=&quot;15&quot;&gt;        dat021, &lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb2-16&quot; title=&quot;16&quot;&gt;        dat022&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb2-17&quot; title=&quot;17&quot;&gt;      )&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb2-18&quot; title=&quot;18&quot;&gt;    ), &lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb2-19&quot; title=&quot;19&quot;&gt;    dat03 &lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb2-20&quot; title=&quot;20&quot;&gt;  )&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb2-21&quot; title=&quot;21&quot;&gt;)&lt;/a&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Now we define the JavaScript callback which will be used. The code depends on whether one wants to display the row names of the main table, so the user has to enter this information before.&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb3&quot;&gt;&lt;pre class=&quot;sourceCode r&quot;&gt;&lt;code class=&quot;sourceCode r&quot;&gt;&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-1&quot; title=&quot;1&quot;&gt;&lt;span class=&quot;kw&quot;&gt;library&lt;/span&gt;(DT)&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-2&quot; title=&quot;2&quot;&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-3&quot; title=&quot;3&quot;&gt;&lt;span class=&quot;co&quot;&gt;## whether to show row names&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-4&quot; title=&quot;4&quot;&gt;rowNames =&lt;span class=&quot;st&quot;&gt; &lt;/span&gt;&lt;span class=&quot;ot&quot;&gt;FALSE&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-5&quot; title=&quot;5&quot;&gt;colIdx &amp;lt;-&lt;span class=&quot;st&quot;&gt; &lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;as.integer&lt;/span&gt;(rowNames)&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-6&quot; title=&quot;6&quot;&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-7&quot; title=&quot;7&quot;&gt;&lt;span class=&quot;co&quot;&gt;## the callback&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-8&quot; title=&quot;8&quot;&gt;parentRows &amp;lt;-&lt;span class=&quot;st&quot;&gt; &lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;which&lt;/span&gt;(Dat[,&lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;] &lt;span class=&quot;op&quot;&gt;!=&lt;/span&gt;&lt;span class=&quot;st&quot;&gt; &amp;quot;&amp;quot;&lt;/span&gt;)&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-9&quot; title=&quot;9&quot;&gt;callback &amp;lt;-&lt;span class=&quot;st&quot;&gt; &lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;JS&lt;/span&gt;(&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-10&quot; title=&quot;10&quot;&gt;  &lt;span class=&quot;kw&quot;&gt;sprintf&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;&amp;quot;var parentRows = [%s];&amp;quot;&lt;/span&gt;, &lt;span class=&quot;kw&quot;&gt;toString&lt;/span&gt;(parentRows&lt;span class=&quot;dv&quot;&gt;-1&lt;/span&gt;)),&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-11&quot; title=&quot;11&quot;&gt;  &lt;span class=&quot;kw&quot;&gt;sprintf&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;&amp;quot;var j0 = %d;&amp;quot;&lt;/span&gt;, colIdx),&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-12&quot; title=&quot;12&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;var nrows = table.rows().count();&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-13&quot; title=&quot;13&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;for(let i = 0; i &amp;lt; nrows; ++i){&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-14&quot; title=&quot;14&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;  var $cell = table.cell(i,j0).nodes().to$();&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-15&quot; title=&quot;15&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;  if(parentRows.indexOf(i) &amp;gt; -1){&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-16&quot; title=&quot;16&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;    $cell.css({cursor: &amp;#39;pointer&amp;#39;});&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-17&quot; title=&quot;17&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;  }else{&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-18&quot; title=&quot;18&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;    $cell.removeClass(&amp;#39;details-control&amp;#39;);&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-19&quot; title=&quot;19&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;  }&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-20&quot; title=&quot;20&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;}&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-21&quot; title=&quot;21&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-22&quot; title=&quot;22&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;// --- make the table header of the nested table --- //&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-23&quot; title=&quot;23&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;var formatHeader = function(d, childId){&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-24&quot; title=&quot;24&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;  if(d !== null){&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-25&quot; title=&quot;25&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;    var html = &amp;quot;&lt;/span&gt;, &lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-26&quot; title=&quot;26&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;      &amp;#39;&amp;lt;table class=&lt;/span&gt;&lt;span class=&quot;ch&quot;&gt;\&amp;quot;&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;display compact hover&lt;/span&gt;&lt;span class=&quot;ch&quot;&gt;\&amp;quot;&lt;/span&gt;&lt;span class=&quot;st&quot;&gt; &amp;#39; + &amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-27&quot; title=&quot;27&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;      &amp;#39;style=&lt;/span&gt;&lt;span class=&quot;ch&quot;&gt;\&amp;quot;&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;padding-left: 30px;&lt;/span&gt;&lt;span class=&quot;ch&quot;&gt;\&amp;quot;&lt;/span&gt;&lt;span class=&quot;st&quot;&gt; id=&lt;/span&gt;&lt;span class=&quot;ch&quot;&gt;\&amp;quot;&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&amp;#39; + childId + &amp;quot;&lt;/span&gt;, &lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-28&quot; title=&quot;28&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;      &amp;#39;&lt;/span&gt;&lt;span class=&quot;ch&quot;&gt;\&amp;quot;&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&amp;gt;&amp;lt;thead&amp;gt;&amp;lt;tr&amp;gt;&amp;#39;;&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-29&quot; title=&quot;29&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;    var data = d[d.length-1] || d._details;&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-30&quot; title=&quot;30&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;    for(let key in data[0]){&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-31&quot; title=&quot;31&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;      html += &amp;#39;&amp;lt;th&amp;gt;&amp;#39; + key + &amp;#39;&amp;lt;/th&amp;gt;&amp;#39;;&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-32&quot; title=&quot;32&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;    }&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-33&quot; title=&quot;33&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;    html += &amp;#39;&amp;lt;/tr&amp;gt;&amp;lt;/thead&amp;gt;&amp;lt;/table&amp;gt;&amp;#39;&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-34&quot; title=&quot;34&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;    return html;&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-35&quot; title=&quot;35&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;  } else {&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-36&quot; title=&quot;36&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;    return &amp;#39;&amp;#39;;&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-37&quot; title=&quot;37&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;  }&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-38&quot; title=&quot;38&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;};&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-39&quot; title=&quot;39&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-40&quot; title=&quot;40&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;// --- row callback to style rows of child tables --- //&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-41&quot; title=&quot;41&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;var rowCallback = function(row, dat, displayNum, index){&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-42&quot; title=&quot;42&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;  if($(row).hasClass(&amp;#39;odd&amp;#39;)){&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-43&quot; title=&quot;43&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;    $(row).css(&amp;#39;background-color&amp;#39;, &amp;#39;papayawhip&amp;#39;);&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-44&quot; title=&quot;44&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;    $(row).hover(function(){&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-45&quot; title=&quot;45&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;      $(this).css(&amp;#39;background-color&amp;#39;, &amp;#39;#E6FF99&amp;#39;);&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-46&quot; title=&quot;46&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;    }, function(){&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-47&quot; title=&quot;47&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;      $(this).css(&amp;#39;background-color&amp;#39;, &amp;#39;papayawhip&amp;#39;);&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-48&quot; title=&quot;48&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;    });&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-49&quot; title=&quot;49&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;  } else {&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-50&quot; title=&quot;50&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;    $(row).css(&amp;#39;background-color&amp;#39;, &amp;#39;lemonchiffon&amp;#39;);&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-51&quot; title=&quot;51&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;    $(row).hover(function(){&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-52&quot; title=&quot;52&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;      $(this).css(&amp;#39;background-color&amp;#39;, &amp;#39;#DDFF75&amp;#39;);&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-53&quot; title=&quot;53&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;    }, function(){&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-54&quot; title=&quot;54&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;      $(this).css(&amp;#39;background-color&amp;#39;, &amp;#39;lemonchiffon&amp;#39;);&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-55&quot; title=&quot;55&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;    });&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-56&quot; title=&quot;56&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;  }&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-57&quot; title=&quot;57&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;};&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-58&quot; title=&quot;58&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-59&quot; title=&quot;59&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;// --- header callback to style header of child tables --- //&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-60&quot; title=&quot;60&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;var headerCallback = function(thead, data, start, end, display){&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-61&quot; title=&quot;61&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;  $(&amp;#39;th&amp;#39;, thead).css({&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-62&quot; title=&quot;62&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;    &amp;#39;border-top&amp;#39;: &amp;#39;3px solid indigo&amp;#39;,&amp;quot;&lt;/span&gt;, &lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-63&quot; title=&quot;63&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;    &amp;#39;color&amp;#39;: &amp;#39;indigo&amp;#39;,&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-64&quot; title=&quot;64&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;    &amp;#39;background-color&amp;#39;: &amp;#39;#fadadd&amp;#39;&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-65&quot; title=&quot;65&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;  });&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-66&quot; title=&quot;66&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;};&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-67&quot; title=&quot;67&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-68&quot; title=&quot;68&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;// --- make the datatable --- //&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-69&quot; title=&quot;69&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;var formatDatatable = function(d, childId){&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-70&quot; title=&quot;70&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;  var data = d[d.length-1] || d._details;&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-71&quot; title=&quot;71&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;  var colNames = Object.keys(data[0]);&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-72&quot; title=&quot;72&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;  var columns = colNames.map(function(x){&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-73&quot; title=&quot;73&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;    return {data: x.replace(/&lt;/span&gt;&lt;span class=&quot;ch&quot;&gt;\\&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;./g, &amp;#39;&lt;/span&gt;&lt;span class=&quot;ch&quot;&gt;\\\\\\&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;.&amp;#39;), title: x};&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-74&quot; title=&quot;74&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;  });&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-75&quot; title=&quot;75&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;  var id = &amp;#39;table#&amp;#39; + childId;&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-76&quot; title=&quot;76&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;  if(colNames.indexOf(&amp;#39;_details&amp;#39;) === -1){&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-77&quot; title=&quot;77&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;    var subtable = $(id).DataTable({&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-78&quot; title=&quot;78&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;      &amp;#39;data&amp;#39;: data,&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-79&quot; title=&quot;79&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;      &amp;#39;columns&amp;#39;: columns,&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-80&quot; title=&quot;80&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;      &amp;#39;autoWidth&amp;#39;: true,&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-81&quot; title=&quot;81&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;      &amp;#39;deferRender&amp;#39;: true,&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-82&quot; title=&quot;82&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;      &amp;#39;info&amp;#39;: false,&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-83&quot; title=&quot;83&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;      &amp;#39;lengthChange&amp;#39;: false,&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-84&quot; title=&quot;84&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;      &amp;#39;ordering&amp;#39;: data.length &amp;gt; 1,&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-85&quot; title=&quot;85&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;      &amp;#39;order&amp;#39;: [],&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-86&quot; title=&quot;86&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;      &amp;#39;paging&amp;#39;: false,&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-87&quot; title=&quot;87&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;      &amp;#39;scrollX&amp;#39;: false,&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-88&quot; title=&quot;88&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;      &amp;#39;scrollY&amp;#39;: false,&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-89&quot; title=&quot;89&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;      &amp;#39;searching&amp;#39;: false,&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-90&quot; title=&quot;90&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;      &amp;#39;sortClasses&amp;#39;: false,&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-91&quot; title=&quot;91&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;      &amp;#39;rowCallback&amp;#39;: rowCallback,&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-92&quot; title=&quot;92&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;      &amp;#39;headerCallback&amp;#39;: headerCallback,&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-93&quot; title=&quot;93&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;      &amp;#39;columnDefs&amp;#39;: [{targets: &amp;#39;_all&amp;#39;, className: &amp;#39;dt-center&amp;#39;}]&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-94&quot; title=&quot;94&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;    });&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-95&quot; title=&quot;95&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;  } else {&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-96&quot; title=&quot;96&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;    var subtable = $(id).DataTable({&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-97&quot; title=&quot;97&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;      &amp;#39;data&amp;#39;: data,&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-98&quot; title=&quot;98&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;      &amp;#39;columns&amp;#39;: columns,&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-99&quot; title=&quot;99&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;      &amp;#39;autoWidth&amp;#39;: true,&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-100&quot; title=&quot;100&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;      &amp;#39;deferRender&amp;#39;: true,&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-101&quot; title=&quot;101&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;      &amp;#39;info&amp;#39;: false,&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-102&quot; title=&quot;102&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;      &amp;#39;lengthChange&amp;#39;: false,&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-103&quot; title=&quot;103&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;      &amp;#39;ordering&amp;#39;: data.length &amp;gt; 1,&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-104&quot; title=&quot;104&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;      &amp;#39;order&amp;#39;: [],&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-105&quot; title=&quot;105&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;      &amp;#39;paging&amp;#39;: false,&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-106&quot; title=&quot;106&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;      &amp;#39;scrollX&amp;#39;: false,&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-107&quot; title=&quot;107&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;      &amp;#39;scrollY&amp;#39;: false,&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-108&quot; title=&quot;108&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;      &amp;#39;searching&amp;#39;: false,&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-109&quot; title=&quot;109&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;      &amp;#39;sortClasses&amp;#39;: false,&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-110&quot; title=&quot;110&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;      &amp;#39;rowCallback&amp;#39;: rowCallback,&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-111&quot; title=&quot;111&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;      &amp;#39;headerCallback&amp;#39;: headerCallback,&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-112&quot; title=&quot;112&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;      &amp;#39;columnDefs&amp;#39;: [&amp;quot;&lt;/span&gt;, &lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-113&quot; title=&quot;113&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;        {targets: -1, visible: false},&amp;quot;&lt;/span&gt;, &lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-114&quot; title=&quot;114&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;        {targets: 0, orderable: false, className: &amp;#39;details-control&amp;#39;},&amp;quot;&lt;/span&gt;, &lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-115&quot; title=&quot;115&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;        {targets: &amp;#39;_all&amp;#39;, className: &amp;#39;dt-center&amp;#39;}&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-116&quot; title=&quot;116&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;      ]&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-117&quot; title=&quot;117&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;    }).column(0).nodes().to$().css({cursor: &amp;#39;pointer&amp;#39;});&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-118&quot; title=&quot;118&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;  }&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-119&quot; title=&quot;119&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;};&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-120&quot; title=&quot;120&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-121&quot; title=&quot;121&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;// --- display the child table on click --- //&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-122&quot; title=&quot;122&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;// array to store id&amp;#39;s of already created child tables&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-123&quot; title=&quot;123&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;var children = [];&amp;quot;&lt;/span&gt;, &lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-124&quot; title=&quot;124&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;table.on(&amp;#39;click&amp;#39;, &amp;#39;td.details-control&amp;#39;, function(){&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-125&quot; title=&quot;125&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;  var tbl = $(this).closest(&amp;#39;table&amp;#39;),&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-126&quot; title=&quot;126&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;      tblId = tbl.attr(&amp;#39;id&amp;#39;),&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-127&quot; title=&quot;127&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;      td = $(this),&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-128&quot; title=&quot;128&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;      row = $(tbl).DataTable().row(td.closest(&amp;#39;tr&amp;#39;)),&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-129&quot; title=&quot;129&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;      rowIdx = row.index();&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-130&quot; title=&quot;130&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;  if(row.child.isShown()){&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-131&quot; title=&quot;131&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;    row.child.hide();&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-132&quot; title=&quot;132&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;    td.html(&amp;#39;&amp;amp;oplus;&amp;#39;);&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-133&quot; title=&quot;133&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;  } else {&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-134&quot; title=&quot;134&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;    var childId = tblId + &amp;#39;-child-&amp;#39; + rowIdx;&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-135&quot; title=&quot;135&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;    if(children.indexOf(childId) === -1){&amp;quot;&lt;/span&gt;, &lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-136&quot; title=&quot;136&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;      // this child has not been created yet&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-137&quot; title=&quot;137&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;      children.push(childId);&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-138&quot; title=&quot;138&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;      row.child(formatHeader(row.data(), childId)).show();&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-139&quot; title=&quot;139&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;      td.html(&amp;#39;&amp;amp;CircleMinus;&amp;#39;);&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-140&quot; title=&quot;140&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;      formatDatatable(row.data(), childId, rowIdx);&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-141&quot; title=&quot;141&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;    }else{&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-142&quot; title=&quot;142&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;      // this child has already been created&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-143&quot; title=&quot;143&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;      row.child(true);&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-144&quot; title=&quot;144&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;      td.html(&amp;#39;&amp;amp;CircleMinus;&amp;#39;);&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-145&quot; title=&quot;145&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;    }&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-146&quot; title=&quot;146&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;  }&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-147&quot; title=&quot;147&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;});&amp;quot;&lt;/span&gt;)&lt;/a&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Now, here is the code which generates the table. The first column contains some HTML (&oplus;) so we have to not escape it. The last column contains the child data, it has to be hidden. Finally we assign the class &lt;code&gt;details-control&lt;/code&gt; to the first column, this is used by the callback.&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb4&quot;&gt;&lt;pre class=&quot;sourceCode r&quot;&gt;&lt;code class=&quot;sourceCode r&quot;&gt;&lt;a class=&quot;sourceLine&quot; id=&quot;cb4-1&quot; title=&quot;1&quot;&gt;&lt;span class=&quot;kw&quot;&gt;datatable&lt;/span&gt;(&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb4-2&quot; title=&quot;2&quot;&gt;  Dat, &lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb4-3&quot; title=&quot;3&quot;&gt;  &lt;span class=&quot;dt&quot;&gt;callback =&lt;/span&gt; callback, &lt;span class=&quot;dt&quot;&gt;rownames =&lt;/span&gt; rowNames, &lt;span class=&quot;dt&quot;&gt;escape =&lt;/span&gt; &lt;span class=&quot;op&quot;&gt;-&lt;/span&gt;colIdx&lt;span class=&quot;dv&quot;&gt;-1&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb4-4&quot; title=&quot;4&quot;&gt;  &lt;span class=&quot;dt&quot;&gt;options =&lt;/span&gt; &lt;span class=&quot;kw&quot;&gt;list&lt;/span&gt;(&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb4-5&quot; title=&quot;5&quot;&gt;    &lt;span class=&quot;dt&quot;&gt;paging =&lt;/span&gt; &lt;span class=&quot;ot&quot;&gt;FALSE&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb4-6&quot; title=&quot;6&quot;&gt;    &lt;span class=&quot;dt&quot;&gt;searching =&lt;/span&gt; &lt;span class=&quot;ot&quot;&gt;FALSE&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb4-7&quot; title=&quot;7&quot;&gt;    &lt;span class=&quot;dt&quot;&gt;columnDefs =&lt;/span&gt; &lt;span class=&quot;kw&quot;&gt;list&lt;/span&gt;(&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb4-8&quot; title=&quot;8&quot;&gt;      &lt;span class=&quot;kw&quot;&gt;list&lt;/span&gt;(&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb4-9&quot; title=&quot;9&quot;&gt;        &lt;span class=&quot;dt&quot;&gt;visible =&lt;/span&gt; &lt;span class=&quot;ot&quot;&gt;FALSE&lt;/span&gt;, &lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb4-10&quot; title=&quot;10&quot;&gt;        &lt;span class=&quot;dt&quot;&gt;targets =&lt;/span&gt; &lt;span class=&quot;kw&quot;&gt;ncol&lt;/span&gt;(Dat)&lt;span class=&quot;op&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;+&lt;/span&gt;colIdx&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb4-11&quot; title=&quot;11&quot;&gt;      ),&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb4-12&quot; title=&quot;12&quot;&gt;      &lt;span class=&quot;kw&quot;&gt;list&lt;/span&gt;(&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb4-13&quot; title=&quot;13&quot;&gt;        &lt;span class=&quot;dt&quot;&gt;orderable =&lt;/span&gt; &lt;span class=&quot;ot&quot;&gt;FALSE&lt;/span&gt;, &lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb4-14&quot; title=&quot;14&quot;&gt;        &lt;span class=&quot;dt&quot;&gt;className =&lt;/span&gt; &lt;span class=&quot;st&quot;&gt;&amp;quot;details-control&amp;quot;&lt;/span&gt;, &lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb4-15&quot; title=&quot;15&quot;&gt;        &lt;span class=&quot;dt&quot;&gt;targets =&lt;/span&gt; colIdx&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb4-16&quot; title=&quot;16&quot;&gt;      ),&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb4-17&quot; title=&quot;17&quot;&gt;      &lt;span class=&quot;kw&quot;&gt;list&lt;/span&gt;(&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb4-18&quot; title=&quot;18&quot;&gt;        &lt;span class=&quot;dt&quot;&gt;className =&lt;/span&gt; &lt;span class=&quot;st&quot;&gt;&amp;quot;dt-center&amp;quot;&lt;/span&gt;, &lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb4-19&quot; title=&quot;19&quot;&gt;        &lt;span class=&quot;dt&quot;&gt;targets =&lt;/span&gt; &lt;span class=&quot;st&quot;&gt;&amp;quot;_all&amp;quot;&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb4-20&quot; title=&quot;20&quot;&gt;      )&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb4-21&quot; title=&quot;21&quot;&gt;    )&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb4-22&quot; title=&quot;22&quot;&gt;  )&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb4-23&quot; title=&quot;23&quot;&gt;)&lt;/a&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;img src=&quot;https://laustep.github.io/stlahblog/posts/figures/DTchildRows1.gif&quot; /&gt;&lt;/p&gt;
&lt;h1 id=&quot;editing&quot;&gt;Editing&lt;/h1&gt;
&lt;p&gt;We use the JavaScript library &lt;a href=&quot;https://github.com/ejbeaty/CellEdit&quot;&gt;CellEdit&lt;/a&gt; to allow cells, including the cells of the child tables, to be editable. Download the file &lt;strong&gt;dataTables.cellEdit.js&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;Some CSS is required in order to make things pretty. Save the following CSS code in a file &lt;strong&gt;dataTables.cellEdit.css&lt;/strong&gt;.&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb5&quot;&gt;&lt;pre class=&quot;sourceCode css&quot;&gt;&lt;code class=&quot;sourceCode css&quot;&gt;&lt;a class=&quot;sourceLine&quot; id=&quot;cb5-1&quot; title=&quot;1&quot;&gt;&lt;span class=&quot;fu&quot;&gt;.my-input-class&lt;/span&gt; {&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb5-2&quot; title=&quot;2&quot;&gt;  &lt;span class=&quot;kw&quot;&gt;padding&lt;/span&gt;: &lt;span class=&quot;dv&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;px&lt;/span&gt; &lt;span class=&quot;dv&quot;&gt;6&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;px&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;;&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb5-3&quot; title=&quot;3&quot;&gt;  &lt;span class=&quot;kw&quot;&gt;border&lt;/span&gt;: &lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;px&lt;/span&gt; &lt;span class=&quot;dv&quot;&gt;solid&lt;/span&gt; &lt;span class=&quot;cn&quot;&gt;#ccc&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;;&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb5-4&quot; title=&quot;4&quot;&gt;  &lt;span class=&quot;kw&quot;&gt;border-radius&lt;/span&gt;: &lt;span class=&quot;dv&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;px&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;;&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb5-5&quot; title=&quot;5&quot;&gt;  &lt;span class=&quot;kw&quot;&gt;width&lt;/span&gt;: &lt;span class=&quot;dv&quot;&gt;60&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;px&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;;&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb5-6&quot; title=&quot;6&quot;&gt;}&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb5-7&quot; title=&quot;7&quot;&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb5-8&quot; title=&quot;8&quot;&gt;&lt;span class=&quot;fu&quot;&gt;.my-confirm-class&lt;/span&gt; {&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb5-9&quot; title=&quot;9&quot;&gt;  &lt;span class=&quot;kw&quot;&gt;padding&lt;/span&gt;: &lt;span class=&quot;dv&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;px&lt;/span&gt; &lt;span class=&quot;dv&quot;&gt;6&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;px&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;;&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb5-10&quot; title=&quot;10&quot;&gt;  &lt;span class=&quot;kw&quot;&gt;font-size&lt;/span&gt;: &lt;span class=&quot;dv&quot;&gt;12&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;px&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;;&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb5-11&quot; title=&quot;11&quot;&gt;  &lt;span class=&quot;kw&quot;&gt;color&lt;/span&gt;: &lt;span class=&quot;cn&quot;&gt;white&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;;&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb5-12&quot; title=&quot;12&quot;&gt;  &lt;span class=&quot;kw&quot;&gt;text-align&lt;/span&gt;: &lt;span class=&quot;dv&quot;&gt;center&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;;&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb5-13&quot; title=&quot;13&quot;&gt;  &lt;span class=&quot;kw&quot;&gt;vertical-align&lt;/span&gt;: &lt;span class=&quot;dv&quot;&gt;middle&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;;&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb5-14&quot; title=&quot;14&quot;&gt;  &lt;span class=&quot;kw&quot;&gt;border-radius&lt;/span&gt;: &lt;span class=&quot;dv&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;px&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;;&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb5-15&quot; title=&quot;15&quot;&gt;  &lt;span class=&quot;kw&quot;&gt;background-color&lt;/span&gt;: &lt;span class=&quot;cn&quot;&gt;#337ab7&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;;&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb5-16&quot; title=&quot;16&quot;&gt;  &lt;span class=&quot;kw&quot;&gt;text-decoration&lt;/span&gt;: &lt;span class=&quot;dv&quot;&gt;none&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;;&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb5-17&quot; title=&quot;17&quot;&gt;}&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb5-18&quot; title=&quot;18&quot;&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb5-19&quot; title=&quot;19&quot;&gt;&lt;span class=&quot;fu&quot;&gt;.my-cancel-class&lt;/span&gt; {&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb5-20&quot; title=&quot;20&quot;&gt;  &lt;span class=&quot;kw&quot;&gt;padding&lt;/span&gt;: &lt;span class=&quot;dv&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;px&lt;/span&gt; &lt;span class=&quot;dv&quot;&gt;6&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;px&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;;&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb5-21&quot; title=&quot;21&quot;&gt;  &lt;span class=&quot;kw&quot;&gt;font-size&lt;/span&gt;: &lt;span class=&quot;dv&quot;&gt;12&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;px&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;;&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb5-22&quot; title=&quot;22&quot;&gt;  &lt;span class=&quot;kw&quot;&gt;color&lt;/span&gt;: &lt;span class=&quot;cn&quot;&gt;white&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;;&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb5-23&quot; title=&quot;23&quot;&gt;  &lt;span class=&quot;kw&quot;&gt;text-align&lt;/span&gt;: &lt;span class=&quot;dv&quot;&gt;center&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;;&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb5-24&quot; title=&quot;24&quot;&gt;  &lt;span class=&quot;kw&quot;&gt;vertical-align&lt;/span&gt;: &lt;span class=&quot;dv&quot;&gt;middle&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;;&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb5-25&quot; title=&quot;25&quot;&gt;  &lt;span class=&quot;kw&quot;&gt;border-radius&lt;/span&gt;: &lt;span class=&quot;dv&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;px&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;;&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb5-26&quot; title=&quot;26&quot;&gt;  &lt;span class=&quot;kw&quot;&gt;background-color&lt;/span&gt;: &lt;span class=&quot;cn&quot;&gt;#a94442&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;;&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb5-27&quot; title=&quot;27&quot;&gt;  &lt;span class=&quot;kw&quot;&gt;text-decoration&lt;/span&gt;: &lt;span class=&quot;dv&quot;&gt;none&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;;&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb5-28&quot; title=&quot;28&quot;&gt;}&lt;/a&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Now modify the callback as follows:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb6&quot;&gt;&lt;pre class=&quot;sourceCode r&quot;&gt;&lt;code class=&quot;sourceCode r&quot;&gt;&lt;a class=&quot;sourceLine&quot; id=&quot;cb6-1&quot; title=&quot;1&quot;&gt;callback &amp;lt;-&lt;span class=&quot;st&quot;&gt; &lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;JS&lt;/span&gt;(&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb6-2&quot; title=&quot;2&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;function onUpdate(updatedCell, updatedRow, oldValue) {};&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb6-3&quot; title=&quot;3&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;table.MakeCellsEditable({&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb6-4&quot; title=&quot;4&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;  onUpdate: onUpdate,&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb6-5&quot; title=&quot;5&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;  inputCss: &amp;#39;my-input-class&amp;#39;,&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb6-6&quot; title=&quot;6&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;  confirmationButton: {&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb6-7&quot; title=&quot;7&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;    confirmCss: &amp;#39;my-confirm-class&amp;#39;,&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb6-8&quot; title=&quot;8&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;    cancelCss: &amp;#39;my-cancel-class&amp;#39;&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb6-9&quot; title=&quot;9&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;  }&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb6-10&quot; title=&quot;10&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;});&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb6-11&quot; title=&quot;11&quot;&gt;  &lt;span class=&quot;kw&quot;&gt;sprintf&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;&amp;quot;var parentRows = [%s];&amp;quot;&lt;/span&gt;, &lt;span class=&quot;kw&quot;&gt;toString&lt;/span&gt;(parentRows&lt;span class=&quot;dv&quot;&gt;-1&lt;/span&gt;)),&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb6-12&quot; title=&quot;12&quot;&gt;  &lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb6-13&quot; title=&quot;13&quot;&gt;  ......&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb6-14&quot; title=&quot;14&quot;&gt;  &lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb6-15&quot; title=&quot;15&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;// --- make the datatable --- //&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb6-16&quot; title=&quot;16&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;var formatDatatable = function(d, childId){&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb6-17&quot; title=&quot;17&quot;&gt;  &lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb6-18&quot; title=&quot;18&quot;&gt;  ......&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb6-19&quot; title=&quot;19&quot;&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb6-20&quot; title=&quot;20&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;    }).column(0).nodes().to$().css({cursor: &amp;#39;pointer&amp;#39;});&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb6-21&quot; title=&quot;21&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;  }&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb6-22&quot; title=&quot;22&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;  subtable.MakeCellsEditable({&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb6-23&quot; title=&quot;23&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;    onUpdate: onUpdate,&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb6-24&quot; title=&quot;24&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;    inputCss: &amp;#39;my-input-class&amp;#39;,&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb6-25&quot; title=&quot;25&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;    confirmationButton: {&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb6-26&quot; title=&quot;26&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;      confirmCss: &amp;#39;my-confirm-class&amp;#39;,&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb6-27&quot; title=&quot;27&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;      cancelCss: &amp;#39;my-cancel-class&amp;#39;&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb6-28&quot; title=&quot;28&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;    }&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb6-29&quot; title=&quot;29&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;  });&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb6-30&quot; title=&quot;30&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;};&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb6-31&quot; title=&quot;31&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb6-32&quot; title=&quot;32&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;// --- display the child table on click --- //&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb6-33&quot; title=&quot;33&quot;&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb6-34&quot; title=&quot;34&quot;&gt;  ......&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb6-35&quot; title=&quot;35&quot;&gt;  &lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb6-36&quot; title=&quot;36&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;});&amp;quot;&lt;/span&gt;)&lt;/a&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Use the same code as before to generate the table but store the output:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb7&quot;&gt;&lt;pre class=&quot;sourceCode r&quot;&gt;&lt;code class=&quot;sourceCode r&quot;&gt;&lt;a class=&quot;sourceLine&quot; id=&quot;cb7-1&quot; title=&quot;1&quot;&gt;dtable &amp;lt;-&lt;span class=&quot;st&quot;&gt; &lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;datatable&lt;/span&gt;(&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb7-2&quot; title=&quot;2&quot;&gt;  Dat, &lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb7-3&quot; title=&quot;3&quot;&gt;  &lt;span class=&quot;dt&quot;&gt;callback =&lt;/span&gt; callback, &lt;span class=&quot;dt&quot;&gt;rownames =&lt;/span&gt; rowNames, &lt;span class=&quot;dt&quot;&gt;escape =&lt;/span&gt; &lt;span class=&quot;op&quot;&gt;-&lt;/span&gt;colIdx&lt;span class=&quot;dv&quot;&gt;-1&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb7-4&quot; title=&quot;4&quot;&gt;  &lt;span class=&quot;dt&quot;&gt;options =&lt;/span&gt; &lt;span class=&quot;kw&quot;&gt;list&lt;/span&gt;(&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb7-5&quot; title=&quot;5&quot;&gt;    &lt;span class=&quot;dt&quot;&gt;paging =&lt;/span&gt; &lt;span class=&quot;ot&quot;&gt;FALSE&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb7-6&quot; title=&quot;6&quot;&gt;    &lt;span class=&quot;dt&quot;&gt;searching =&lt;/span&gt; &lt;span class=&quot;ot&quot;&gt;FALSE&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb7-7&quot; title=&quot;7&quot;&gt;    &lt;span class=&quot;dt&quot;&gt;columnDefs =&lt;/span&gt; &lt;span class=&quot;kw&quot;&gt;list&lt;/span&gt;(&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb7-8&quot; title=&quot;8&quot;&gt;      &lt;span class=&quot;kw&quot;&gt;list&lt;/span&gt;(&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb7-9&quot; title=&quot;9&quot;&gt;        &lt;span class=&quot;dt&quot;&gt;visible =&lt;/span&gt; &lt;span class=&quot;ot&quot;&gt;FALSE&lt;/span&gt;, &lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb7-10&quot; title=&quot;10&quot;&gt;        &lt;span class=&quot;dt&quot;&gt;targets =&lt;/span&gt; &lt;span class=&quot;kw&quot;&gt;ncol&lt;/span&gt;(Dat)&lt;span class=&quot;op&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;+&lt;/span&gt;colIdx&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb7-11&quot; title=&quot;11&quot;&gt;      ),&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb7-12&quot; title=&quot;12&quot;&gt;      &lt;span class=&quot;kw&quot;&gt;list&lt;/span&gt;(&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb7-13&quot; title=&quot;13&quot;&gt;        &lt;span class=&quot;dt&quot;&gt;orderable =&lt;/span&gt; &lt;span class=&quot;ot&quot;&gt;FALSE&lt;/span&gt;, &lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb7-14&quot; title=&quot;14&quot;&gt;        &lt;span class=&quot;dt&quot;&gt;className =&lt;/span&gt; &lt;span class=&quot;st&quot;&gt;&amp;quot;details-control&amp;quot;&lt;/span&gt;, &lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb7-15&quot; title=&quot;15&quot;&gt;        &lt;span class=&quot;dt&quot;&gt;targets =&lt;/span&gt; colIdx&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb7-16&quot; title=&quot;16&quot;&gt;      ),&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb7-17&quot; title=&quot;17&quot;&gt;      &lt;span class=&quot;kw&quot;&gt;list&lt;/span&gt;(&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb7-18&quot; title=&quot;18&quot;&gt;        &lt;span class=&quot;dt&quot;&gt;className =&lt;/span&gt; &lt;span class=&quot;st&quot;&gt;&amp;quot;dt-center&amp;quot;&lt;/span&gt;, &lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb7-19&quot; title=&quot;19&quot;&gt;        &lt;span class=&quot;dt&quot;&gt;targets =&lt;/span&gt; &lt;span class=&quot;st&quot;&gt;&amp;quot;_all&amp;quot;&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb7-20&quot; title=&quot;20&quot;&gt;      )&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb7-21&quot; title=&quot;21&quot;&gt;    )&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb7-22&quot; title=&quot;22&quot;&gt;  )&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb7-23&quot; title=&quot;23&quot;&gt;)&lt;/a&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Now we add the dependencies to the &lt;code&gt;datatable&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb8&quot;&gt;&lt;pre class=&quot;sourceCode r&quot;&gt;&lt;code class=&quot;sourceCode r&quot;&gt;&lt;a class=&quot;sourceLine&quot; id=&quot;cb8-1&quot; title=&quot;1&quot;&gt;path &amp;lt;-&lt;span class=&quot;st&quot;&gt; &amp;quot;path/to/cellEdit&amp;quot;&lt;/span&gt; &lt;span class=&quot;co&quot;&gt;# folder containing the files &lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb8-2&quot; title=&quot;2&quot;&gt;                           &lt;span class=&quot;co&quot;&gt;# dataTables.cellEdit.js and &lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb8-3&quot; title=&quot;3&quot;&gt;                           &lt;span class=&quot;co&quot;&gt;# dataTables.cellEdit.css&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb8-4&quot; title=&quot;4&quot;&gt;dep &amp;lt;-&lt;span class=&quot;st&quot;&gt; &lt;/span&gt;htmltools&lt;span class=&quot;op&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;htmlDependency&lt;/span&gt;(&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb8-5&quot; title=&quot;5&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;CellEdit&amp;quot;&lt;/span&gt;, &lt;span class=&quot;st&quot;&gt;&amp;quot;1.0.19&amp;quot;&lt;/span&gt;, path, &lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb8-6&quot; title=&quot;6&quot;&gt;  &lt;span class=&quot;dt&quot;&gt;script =&lt;/span&gt; &lt;span class=&quot;st&quot;&gt;&amp;quot;dataTables.cellEdit.js&amp;quot;&lt;/span&gt;, &lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb8-7&quot; title=&quot;7&quot;&gt;  &lt;span class=&quot;dt&quot;&gt;stylesheet =&lt;/span&gt; &lt;span class=&quot;st&quot;&gt;&amp;quot;dataTables.cellEdit.css&amp;quot;&lt;/span&gt;)&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb8-8&quot; title=&quot;8&quot;&gt;dtable&lt;span class=&quot;op&quot;&gt;$&lt;/span&gt;dependencies &amp;lt;-&lt;span class=&quot;st&quot;&gt; &lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;c&lt;/span&gt;(dtable&lt;span class=&quot;op&quot;&gt;$&lt;/span&gt;dependencies, &lt;span class=&quot;kw&quot;&gt;list&lt;/span&gt;(dep))&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb8-9&quot; title=&quot;9&quot;&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb8-10&quot; title=&quot;10&quot;&gt;dtable&lt;/a&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;img src=&quot;https://laustep.github.io/stlahblog/posts/figures/DTchildRows2.gif&quot; /&gt;&lt;/p&gt;
&lt;h1 id=&quot;exporting&quot;&gt;Exporting&lt;/h1&gt;
&lt;p&gt;Now we show how to export a table with its child tables to an Excel file, when there is only one level of child tables (&lt;em&gt;i.e.&lt;/em&gt; when the child tables of the main table do not have child tables themselves). To do so, we use the &lt;code&gt;customize&lt;/code&gt; callback of the Excel button provided by the &lt;code&gt;Buttons&lt;/code&gt; extension. I found this code on the DataTables forum. In the first row of the callback, &lt;code&gt;mytable&lt;/code&gt; is the id of the datatable:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb9&quot;&gt;&lt;pre class=&quot;sourceCode js&quot;&gt;&lt;code class=&quot;sourceCode javascript&quot;&gt;&lt;a class=&quot;sourceLine&quot; id=&quot;cb9-1&quot; title=&quot;1&quot;&gt;&lt;span class=&quot;kw&quot;&gt;var&lt;/span&gt; table &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;at&quot;&gt;$&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;&amp;#39;#mytable&amp;#39;&lt;/span&gt;).&lt;span class=&quot;at&quot;&gt;find&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;&amp;#39;table&amp;#39;&lt;/span&gt;).&lt;span class=&quot;at&quot;&gt;DataTable&lt;/span&gt;()&lt;span class=&quot;op&quot;&gt;;&lt;/span&gt;&lt;/a&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;If you don&rsquo;t use Shiny, you have to set this id in the &lt;code&gt;elementId&lt;/code&gt; argument of the &lt;code&gt;datatable&lt;/code&gt; function. If you use Shiny, this id is the key of the element of the &lt;code&gt;output&lt;/code&gt; object in which you assign a &lt;code&gt;renderDT&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb10&quot;&gt;&lt;pre class=&quot;sourceCode r&quot;&gt;&lt;code class=&quot;sourceCode r&quot;&gt;&lt;a class=&quot;sourceLine&quot; id=&quot;cb10-1&quot; title=&quot;1&quot;&gt;output[[&lt;span class=&quot;st&quot;&gt;&amp;quot;mytable&amp;quot;&lt;/span&gt;]] &amp;lt;-&lt;span class=&quot;st&quot;&gt; &lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;renderDT&lt;/span&gt;({&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb10-2&quot; title=&quot;2&quot;&gt;  ......&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb10-3&quot; title=&quot;3&quot;&gt;})&lt;/a&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The JavaScript code depends on whether the user desires a title in the Excel file, so this information has to be provided first.&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb11&quot;&gt;&lt;pre class=&quot;sourceCode r&quot;&gt;&lt;code class=&quot;sourceCode r&quot;&gt;&lt;a class=&quot;sourceLine&quot; id=&quot;cb11-1&quot; title=&quot;1&quot;&gt;excelTitle =&lt;span class=&quot;st&quot;&gt; &lt;/span&gt;&lt;span class=&quot;ot&quot;&gt;NULL&lt;/span&gt; &lt;span class=&quot;co&quot;&gt;# enter title or set to NULL if you don&amp;#39;t want a title&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb11-2&quot; title=&quot;2&quot;&gt;js_customXLSX &amp;lt;-&lt;span class=&quot;st&quot;&gt; &lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;JS&lt;/span&gt;(&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb11-3&quot; title=&quot;3&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;function(xlsx){&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb11-4&quot; title=&quot;4&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;  var table = $(&amp;#39;#mytable&amp;#39;).find(&amp;#39;table&amp;#39;).DataTable();&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb11-5&quot; title=&quot;5&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;  // Number of columns.&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb11-6&quot; title=&quot;6&quot;&gt;  &lt;span class=&quot;kw&quot;&gt;sprintf&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;&amp;quot;  var ncols = %d;&amp;quot;&lt;/span&gt;, &lt;span class=&quot;kw&quot;&gt;ncol&lt;/span&gt;(Dat)),&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb11-7&quot; title=&quot;7&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;  // Is there a title?&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb11-8&quot; title=&quot;8&quot;&gt;  &lt;span class=&quot;kw&quot;&gt;sprintf&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;&amp;quot;  var title = %s;&amp;quot;&lt;/span&gt;, &lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb11-9&quot; title=&quot;9&quot;&gt;          &lt;span class=&quot;kw&quot;&gt;ifelse&lt;/span&gt;(&lt;span class=&quot;kw&quot;&gt;is.null&lt;/span&gt;(excelTitle), &lt;span class=&quot;st&quot;&gt;&amp;quot;false&amp;quot;&lt;/span&gt;, &lt;span class=&quot;st&quot;&gt;&amp;quot;true&amp;quot;&lt;/span&gt;)),&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb11-10&quot; title=&quot;10&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;  // Integer to Excel column: 0 -&amp;gt; A, 1 -&amp;gt; B, ..., 25 -&amp;gt; Z, 26 -&amp;gt; AA, ...&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb11-11&quot; title=&quot;11&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;  var XLcolumn = function(j){&amp;quot;&lt;/span&gt;, &lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb11-12&quot; title=&quot;12&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;    return j &amp;lt; 0 ? &amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb11-13&quot; title=&quot;13&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;      &amp;#39;&amp;#39; : XLcolumn(j/26-1) + String.fromCharCode(j % 26 + 65);&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb11-14&quot; title=&quot;14&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;  };&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb11-15&quot; title=&quot;15&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;  // Get sheet.&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb11-16&quot; title=&quot;16&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;  var sheet = xlsx.xl.worksheets[&amp;#39;sheet1.xml&amp;#39;];&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb11-17&quot; title=&quot;17&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;  // Get a clone of the sheet data.        &amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb11-18&quot; title=&quot;18&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;  var sheetData = $(&amp;#39;sheetData&amp;#39;, sheet).clone();&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb11-19&quot; title=&quot;19&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;  // Clear the current sheet data for appending rows.&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb11-20&quot; title=&quot;20&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;  $(&amp;#39;sheetData&amp;#39;, sheet).empty();&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb11-21&quot; title=&quot;21&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;  // Row count in Excel sheet.&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb11-22&quot; title=&quot;22&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;  var rowCount = 1;&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb11-23&quot; title=&quot;23&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;  // Iterate each row in the sheet data.&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb11-24&quot; title=&quot;24&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;  $(sheetData).children().each(function (index) {&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb11-25&quot; title=&quot;25&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;    // Used for DT row() API to get child data.&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb11-26&quot; title=&quot;26&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;    var rowIndex = title ? index - 2 : index - 1;&amp;quot;&lt;/span&gt;, &lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb11-27&quot; title=&quot;27&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;    // Don&amp;#39;t process row if it&amp;#39;s the title row or the header row.&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb11-28&quot; title=&quot;28&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;    var i0 = title ? 1 : 0;&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb11-29&quot; title=&quot;29&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;    if (index &amp;gt; i0) {&amp;quot;&lt;/span&gt;, &lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb11-30&quot; title=&quot;30&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;      // Get row&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb11-31&quot; title=&quot;31&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;      var row = $(this.outerHTML);&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb11-32&quot; title=&quot;32&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;      // Set the Excel row attr to the current Excel row count.&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb11-33&quot; title=&quot;33&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;      row.attr(&amp;#39;r&amp;#39;, rowCount);&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb11-34&quot; title=&quot;34&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;      // Iterate each cell in the row to change the row number.&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb11-35&quot; title=&quot;35&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;      row.children().each(function (index) {&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb11-36&quot; title=&quot;36&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;        var cell = $(this);&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb11-37&quot; title=&quot;37&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;        // Set each cell&amp;#39;s row value.&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb11-38&quot; title=&quot;38&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;        var rc = cell.attr(&amp;#39;r&amp;#39;);&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb11-39&quot; title=&quot;39&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;        rc = rc.replace(/&lt;/span&gt;&lt;span class=&quot;ch&quot;&gt;\\&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;d+$/, &lt;/span&gt;&lt;span class=&quot;ch&quot;&gt;\&amp;quot;\&amp;quot;&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;) + rowCount;&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb11-40&quot; title=&quot;40&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;        cell.attr(&amp;#39;r&amp;#39;, rc);&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb11-41&quot; title=&quot;41&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;      });&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb11-42&quot; title=&quot;42&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;      // Get the row HTML and append to sheetData.&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb11-43&quot; title=&quot;43&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;      row = row[0].outerHTML;&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb11-44&quot; title=&quot;44&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;      $(&amp;#39;sheetData&amp;#39;, sheet).append(row);&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb11-45&quot; title=&quot;45&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;      rowCount++;&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb11-46&quot; title=&quot;46&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;      // Get the child data - could be any data attached to the row.&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb11-47&quot; title=&quot;47&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;      var data = table.row(&amp;#39;:eq(&amp;#39; + rowIndex + &amp;#39;)&amp;#39;).data();&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb11-48&quot; title=&quot;48&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;      var childData = data[ncols-1];&amp;quot;&lt;/span&gt;, &lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb11-49&quot; title=&quot;49&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;      if(childData.length &amp;gt; 0){&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb11-50&quot; title=&quot;50&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;        var colNames = Object.keys(childData[0]);&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb11-51&quot; title=&quot;51&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;        // Prepare Excel formatted row&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb11-52&quot; title=&quot;52&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;        var headerRow = &amp;#39;&amp;lt;row r=&lt;/span&gt;&lt;span class=&quot;ch&quot;&gt;\&amp;quot;&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&amp;#39; + rowCount +&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb11-53&quot; title=&quot;53&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;          &amp;#39;&lt;/span&gt;&lt;span class=&quot;ch&quot;&gt;\&amp;quot;&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&amp;gt;&amp;lt;c t=&lt;/span&gt;&lt;span class=&quot;ch&quot;&gt;\&amp;quot;&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;inlineStr&lt;/span&gt;&lt;span class=&quot;ch&quot;&gt;\&amp;quot;&lt;/span&gt;&lt;span class=&quot;st&quot;&gt; r=&lt;/span&gt;&lt;span class=&quot;ch&quot;&gt;\&amp;quot;&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;A&amp;#39; + rowCount +&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb11-54&quot; title=&quot;54&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;          &amp;#39;&lt;/span&gt;&lt;span class=&quot;ch&quot;&gt;\&amp;quot;&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&amp;gt;&amp;lt;is&amp;gt;&amp;lt;t&amp;gt;&amp;lt;/t&amp;gt;&amp;lt;/is&amp;gt;&amp;lt;/c&amp;gt;&amp;#39;;&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb11-55&quot; title=&quot;55&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;        for(let i = 0; i &amp;lt; colNames.length; i++){&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb11-56&quot; title=&quot;56&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;          headerRow = headerRow +&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb11-57&quot; title=&quot;57&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;            &amp;#39;&amp;lt;c t=&lt;/span&gt;&lt;span class=&quot;ch&quot;&gt;\&amp;quot;&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;inlineStr&lt;/span&gt;&lt;span class=&quot;ch&quot;&gt;\&amp;quot;&lt;/span&gt;&lt;span class=&quot;st&quot;&gt; r=&lt;/span&gt;&lt;span class=&quot;ch&quot;&gt;\&amp;quot;&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&amp;#39; + XLcolumn(i+1) + rowCount +&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb11-58&quot; title=&quot;58&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;            &amp;#39;&lt;/span&gt;&lt;span class=&quot;ch&quot;&gt;\&amp;quot;&lt;/span&gt;&lt;span class=&quot;st&quot;&gt; s=&lt;/span&gt;&lt;span class=&quot;ch&quot;&gt;\&amp;quot;&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;ch&quot;&gt;\&amp;quot;&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&amp;gt;&amp;lt;is&amp;gt;&amp;lt;t&amp;gt;&amp;#39; + colNames[i] +&amp;quot;&lt;/span&gt;, &lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb11-59&quot; title=&quot;59&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;            &amp;#39;&amp;lt;/t&amp;gt;&amp;lt;/is&amp;gt;&amp;lt;/c&amp;gt;&amp;#39;;&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb11-60&quot; title=&quot;60&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;        }&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb11-61&quot; title=&quot;61&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;        headerRow = headerRow + &amp;#39;&amp;lt;/row&amp;gt;&amp;#39;;&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb11-62&quot; title=&quot;62&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;        // Append header row to sheetData.&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb11-63&quot; title=&quot;63&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;        $(&amp;#39;sheetData&amp;#39;, sheet).append(headerRow);&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb11-64&quot; title=&quot;64&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;        rowCount++; // Increment excel row counter.&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb11-65&quot; title=&quot;65&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;      }&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb11-66&quot; title=&quot;66&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;      // The child data is an array of rows&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb11-67&quot; title=&quot;67&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;      for(let c = 0; c &amp;lt; childData.length; c++){&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb11-68&quot; title=&quot;68&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;        // Get row data.&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb11-69&quot; title=&quot;69&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;        var child = childData[c];&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb11-70&quot; title=&quot;70&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;        // Prepare Excel formatted row&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb11-71&quot; title=&quot;71&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;        var childRow = &amp;#39;&amp;lt;row r=&lt;/span&gt;&lt;span class=&quot;ch&quot;&gt;\&amp;quot;&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&amp;#39; + rowCount +&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb11-72&quot; title=&quot;72&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;          &amp;#39;&lt;/span&gt;&lt;span class=&quot;ch&quot;&gt;\&amp;quot;&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&amp;gt;&amp;lt;c t=&lt;/span&gt;&lt;span class=&quot;ch&quot;&gt;\&amp;quot;&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;inlineStr&lt;/span&gt;&lt;span class=&quot;ch&quot;&gt;\&amp;quot;&lt;/span&gt;&lt;span class=&quot;st&quot;&gt; r=&lt;/span&gt;&lt;span class=&quot;ch&quot;&gt;\&amp;quot;&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;A&amp;#39; + rowCount +&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb11-73&quot; title=&quot;73&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;          &amp;#39;&lt;/span&gt;&lt;span class=&quot;ch&quot;&gt;\&amp;quot;&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&amp;gt;&amp;lt;is&amp;gt;&amp;lt;t&amp;gt;&amp;lt;/t&amp;gt;&amp;lt;/is&amp;gt;&amp;lt;/c&amp;gt;&amp;#39;;&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb11-74&quot; title=&quot;74&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;        for(let i = 0; i &amp;lt; colNames.length; i++){&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb11-75&quot; title=&quot;75&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;          childRow = childRow +&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb11-76&quot; title=&quot;76&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;            &amp;#39;&amp;lt;c t=&lt;/span&gt;&lt;span class=&quot;ch&quot;&gt;\&amp;quot;&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;inlineStr&lt;/span&gt;&lt;span class=&quot;ch&quot;&gt;\&amp;quot;&lt;/span&gt;&lt;span class=&quot;st&quot;&gt; r=&lt;/span&gt;&lt;span class=&quot;ch&quot;&gt;\&amp;quot;&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&amp;#39; + XLcolumn(i+1) + rowCount +&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb11-77&quot; title=&quot;77&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;            &amp;#39;&lt;/span&gt;&lt;span class=&quot;ch&quot;&gt;\&amp;quot;&lt;/span&gt;&lt;span class=&quot;st&quot;&gt; s=&lt;/span&gt;&lt;span class=&quot;ch&quot;&gt;\&amp;quot;&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;ch&quot;&gt;\&amp;quot;&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&amp;gt;&amp;lt;is&amp;gt;&amp;lt;t&amp;gt;&amp;#39; + child[colNames[i]] +&amp;quot;&lt;/span&gt;, &lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb11-78&quot; title=&quot;78&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;            &amp;#39;&amp;lt;/t&amp;gt;&amp;lt;/is&amp;gt;&amp;lt;/c&amp;gt;&amp;#39;;&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb11-79&quot; title=&quot;79&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;        }&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb11-80&quot; title=&quot;80&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;        childRow = childRow + &amp;#39;&amp;lt;/row&amp;gt;&amp;#39;;&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb11-81&quot; title=&quot;81&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;        // Append row to sheetData.&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb11-82&quot; title=&quot;82&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;        $(&amp;#39;sheetData&amp;#39;, sheet).append(childRow);&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb11-83&quot; title=&quot;83&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;        rowCount++; // Increment excel row counter.&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb11-84&quot; title=&quot;84&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;      }&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb11-85&quot; title=&quot;85&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;      // Just append the header row and increment excel row counter.&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb11-86&quot; title=&quot;86&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;    } else {&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb11-87&quot; title=&quot;87&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;      $(&amp;#39;sheetData&amp;#39;, sheet).append(this.outerHTML);&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb11-88&quot; title=&quot;88&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;      rowCount++;&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb11-89&quot; title=&quot;89&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;    }&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb11-90&quot; title=&quot;90&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;  });&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb11-91&quot; title=&quot;91&quot;&gt;  &lt;span class=&quot;st&quot;&gt;&amp;quot;}&amp;quot;&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb11-92&quot; title=&quot;92&quot;&gt;)&lt;/a&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Let&rsquo;s see an example.&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb12&quot;&gt;&lt;pre class=&quot;sourceCode r&quot;&gt;&lt;code class=&quot;sourceCode r&quot;&gt;&lt;a class=&quot;sourceLine&quot; id=&quot;cb12-1&quot; title=&quot;1&quot;&gt;dat0  =&lt;span class=&quot;st&quot;&gt; &lt;/span&gt;iris[&lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;3&lt;/span&gt;,]         &lt;span class=&quot;co&quot;&gt;# main table, with three rows&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb12-2&quot; title=&quot;2&quot;&gt;dat01 =&lt;span class=&quot;st&quot;&gt; &lt;/span&gt;airquality[&lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;4&lt;/span&gt;,]   &lt;span class=&quot;co&quot;&gt;# |- child of first row&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb12-3&quot; title=&quot;3&quot;&gt;dat02 =&lt;span class=&quot;st&quot;&gt; &lt;/span&gt;cars[&lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;2&lt;/span&gt;,]         &lt;span class=&quot;co&quot;&gt;# |- child of second row&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb12-4&quot; title=&quot;4&quot;&gt;dat03 =&lt;span class=&quot;st&quot;&gt; &lt;/span&gt;PlantGrowth[&lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;3&lt;/span&gt;,]  &lt;span class=&quot;co&quot;&gt;# |- child of third row&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb12-5&quot; title=&quot;5&quot;&gt;Dat &amp;lt;-&lt;span class=&quot;st&quot;&gt; &lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;NestedData&lt;/span&gt;(&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb12-6&quot; title=&quot;6&quot;&gt;  &lt;span class=&quot;dt&quot;&gt;dat =&lt;/span&gt; dat0, &lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb12-7&quot; title=&quot;7&quot;&gt;  &lt;span class=&quot;dt&quot;&gt;children =&lt;/span&gt; &lt;span class=&quot;kw&quot;&gt;list&lt;/span&gt;(dat01, dat02, dat03)&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb12-8&quot; title=&quot;8&quot;&gt;)&lt;/a&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Below is the code generating the table with a button for the exporting. Remember, if you use Shiny, do not set &lt;code&gt;elementId&lt;/code&gt;.&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb13&quot;&gt;&lt;pre class=&quot;sourceCode r&quot;&gt;&lt;code class=&quot;sourceCode r&quot;&gt;&lt;a class=&quot;sourceLine&quot; id=&quot;cb13-1&quot; title=&quot;1&quot;&gt;dtable &amp;lt;-&lt;span class=&quot;st&quot;&gt; &lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;datatable&lt;/span&gt;(&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb13-2&quot; title=&quot;2&quot;&gt;  Dat, &lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb13-3&quot; title=&quot;3&quot;&gt;  &lt;span class=&quot;dt&quot;&gt;callback =&lt;/span&gt; callback, &lt;span class=&quot;dt&quot;&gt;rownames =&lt;/span&gt; rowNames, &lt;span class=&quot;dt&quot;&gt;escape =&lt;/span&gt; &lt;span class=&quot;op&quot;&gt;-&lt;/span&gt;colIdx&lt;span class=&quot;dv&quot;&gt;-1&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb13-4&quot; title=&quot;4&quot;&gt;  &lt;span class=&quot;dt&quot;&gt;extensions =&lt;/span&gt; &lt;span class=&quot;st&quot;&gt;&amp;quot;Buttons&amp;quot;&lt;/span&gt;, &lt;span class=&quot;dt&quot;&gt;elementId =&lt;/span&gt; &lt;span class=&quot;st&quot;&gt;&amp;quot;mytable&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb13-5&quot; title=&quot;5&quot;&gt;  &lt;span class=&quot;dt&quot;&gt;options =&lt;/span&gt; &lt;span class=&quot;kw&quot;&gt;list&lt;/span&gt;(&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb13-6&quot; title=&quot;6&quot;&gt;    &lt;span class=&quot;dt&quot;&gt;paging =&lt;/span&gt; &lt;span class=&quot;ot&quot;&gt;FALSE&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb13-7&quot; title=&quot;7&quot;&gt;    &lt;span class=&quot;dt&quot;&gt;searching =&lt;/span&gt; &lt;span class=&quot;ot&quot;&gt;FALSE&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb13-8&quot; title=&quot;8&quot;&gt;    &lt;span class=&quot;dt&quot;&gt;dom =&lt;/span&gt; &lt;span class=&quot;st&quot;&gt;&amp;quot;Bfrtip&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb13-9&quot; title=&quot;9&quot;&gt;    &lt;span class=&quot;dt&quot;&gt;columnDefs =&lt;/span&gt; &lt;span class=&quot;kw&quot;&gt;list&lt;/span&gt;(&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb13-10&quot; title=&quot;10&quot;&gt;      &lt;span class=&quot;kw&quot;&gt;list&lt;/span&gt;(&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb13-11&quot; title=&quot;11&quot;&gt;        &lt;span class=&quot;dt&quot;&gt;visible =&lt;/span&gt; &lt;span class=&quot;ot&quot;&gt;FALSE&lt;/span&gt;, &lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb13-12&quot; title=&quot;12&quot;&gt;        &lt;span class=&quot;dt&quot;&gt;targets =&lt;/span&gt; &lt;span class=&quot;kw&quot;&gt;ncol&lt;/span&gt;(Dat)&lt;span class=&quot;op&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;+&lt;/span&gt;colIdx&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb13-13&quot; title=&quot;13&quot;&gt;      ),&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb13-14&quot; title=&quot;14&quot;&gt;      &lt;span class=&quot;kw&quot;&gt;list&lt;/span&gt;(&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb13-15&quot; title=&quot;15&quot;&gt;        &lt;span class=&quot;dt&quot;&gt;orderable =&lt;/span&gt; &lt;span class=&quot;ot&quot;&gt;FALSE&lt;/span&gt;, &lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb13-16&quot; title=&quot;16&quot;&gt;        &lt;span class=&quot;dt&quot;&gt;className =&lt;/span&gt; &lt;span class=&quot;st&quot;&gt;&amp;quot;details-control&amp;quot;&lt;/span&gt;, &lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb13-17&quot; title=&quot;17&quot;&gt;        &lt;span class=&quot;dt&quot;&gt;targets =&lt;/span&gt; colIdx&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb13-18&quot; title=&quot;18&quot;&gt;      ),&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb13-19&quot; title=&quot;19&quot;&gt;      &lt;span class=&quot;kw&quot;&gt;list&lt;/span&gt;(&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb13-20&quot; title=&quot;20&quot;&gt;        &lt;span class=&quot;dt&quot;&gt;className =&lt;/span&gt; &lt;span class=&quot;st&quot;&gt;&amp;quot;dt-center&amp;quot;&lt;/span&gt;, &lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb13-21&quot; title=&quot;21&quot;&gt;        &lt;span class=&quot;dt&quot;&gt;targets =&lt;/span&gt; &lt;span class=&quot;st&quot;&gt;&amp;quot;_all&amp;quot;&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb13-22&quot; title=&quot;22&quot;&gt;      )&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb13-23&quot; title=&quot;23&quot;&gt;    ),&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb13-24&quot; title=&quot;24&quot;&gt;    &lt;span class=&quot;dt&quot;&gt;buttons =&lt;/span&gt; &lt;span class=&quot;kw&quot;&gt;list&lt;/span&gt;(&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb13-25&quot; title=&quot;25&quot;&gt;      &lt;span class=&quot;kw&quot;&gt;list&lt;/span&gt;(&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb13-26&quot; title=&quot;26&quot;&gt;        &lt;span class=&quot;dt&quot;&gt;extend =&lt;/span&gt; &lt;span class=&quot;st&quot;&gt;&amp;quot;excel&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb13-27&quot; title=&quot;27&quot;&gt;        &lt;span class=&quot;dt&quot;&gt;exportOptions =&lt;/span&gt; &lt;span class=&quot;kw&quot;&gt;list&lt;/span&gt;(&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb13-28&quot; title=&quot;28&quot;&gt;          &lt;span class=&quot;dt&quot;&gt;orthogonal =&lt;/span&gt; &lt;span class=&quot;st&quot;&gt;&amp;quot;export&amp;quot;&lt;/span&gt;, &lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb13-29&quot; title=&quot;29&quot;&gt;          &lt;span class=&quot;dt&quot;&gt;columns =&lt;/span&gt; &lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;(&lt;span class=&quot;kw&quot;&gt;ncol&lt;/span&gt;(Dat)&lt;span class=&quot;op&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;2&lt;/span&gt;)&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb13-30&quot; title=&quot;30&quot;&gt;        ),&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb13-31&quot; title=&quot;31&quot;&gt;        &lt;span class=&quot;dt&quot;&gt;title =&lt;/span&gt; excelTitle,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb13-32&quot; title=&quot;32&quot;&gt;        &lt;span class=&quot;dt&quot;&gt;orientation =&lt;/span&gt; &lt;span class=&quot;st&quot;&gt;&amp;quot;landscape&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb13-33&quot; title=&quot;33&quot;&gt;        &lt;span class=&quot;dt&quot;&gt;customize =&lt;/span&gt; js_customXLSX&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb13-34&quot; title=&quot;34&quot;&gt;      )&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb13-35&quot; title=&quot;35&quot;&gt;    )&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb13-36&quot; title=&quot;36&quot;&gt;  )&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb13-37&quot; title=&quot;37&quot;&gt;)&lt;/a&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Here is the Excel file one gets:&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://laustep.github.io/stlahblog/posts/figures/DTchildRows3.png&quot; /&gt;&lt;/p&gt;

        &lt;/div&gt;


        &lt;div id=&quot;footer&quot;&gt;
          Site proudly generated by
          &lt;a href=&quot;http://jaspervdj.be/hakyll&quot;&gt;Hakyll&lt;/a&gt;
        &lt;/div&gt;

      &lt;/div&gt;

    &lt;/div&gt;

    &lt;div class=&quot;row&quot;&gt;
      &lt;div class=&quot;col-sm-12&quot;&gt;
        &lt;div id=&quot;disqus_thread&quot;&gt;&lt;/div&gt;
        &lt;div class=&quot;pagination&quot;&gt;
          &lt;ul&gt;
            &lt;li&gt;
              &lt;a href=&quot;http://laustep.github.io/stlahblog/&quot;&gt;&amp;#171; Back Home&lt;/a&gt;
            &lt;/li&gt;
          &lt;/ul&gt;
        &lt;/div&gt;
      &lt;/div&gt;
    &lt;/div&gt;

  &lt;/div&gt;


&lt;script src=&quot;https://laustep.github.io/stlahblog/libraries/bootstrap/bootstrap.min.js&quot;&gt;&lt;/script&gt;
&lt;!-- MathJax: Fall back to local if CDN offline but local image fonts are not supported (saves &gt;100MB) --&gt;
&lt;script type=&quot;text/x-mathjax-config&quot; src=&quot;https://laustep.github.io/stlahblog/libraries/mathjax/config/TeX-MML-AM_CHTML.js&quot;&gt;&lt;/script&gt;
&lt;!-- &lt;script&gt;
  window.MathJax || document.write('&lt;script type=&quot;text/x-mathjax-config&quot;&gt;MathJax.Hub.Config({&quot;HTML-CSS&quot;:{imageFont:null}});&lt;\/script&gt;&lt;script src=&quot;https://laustep.github.io/stlahblog/libraries/mathjax/MathJax.js&quot;&gt;&lt;\/script&gt;');
&lt;/script&gt; --&gt;
</description>
    <pubDate>Fri, 08 May 2020 00:00:00 UT</pubDate>
    <guid>https://laustep.github.io/stlahblog/posts/DT_childTables.html</guid>
    <dc:creator>Stéphane Laurent</dc:creator>

        <category>R</category>

</item>
<item>
    <title>Focal quadrics and their lines of curvature</title>
    <link>https://laustep.github.io/stlahblog/posts/focalQuadrics.html</link>
    <description><![CDATA[
        <link href="https://laustep.github.io/stlahblog/libraries/bootstrap/bootstrap-grid.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://laustep.github.io/stlahblog/css/default2.css" />
  <link rel="stylesheet" href="https://laustep.github.io/stlahblog/css/post.css" />
  <link rel="stylesheet" href="https://laustep.github.io/stlahblog/css/misc.css" />

    <link rel="stylesheet" href="https://laustep.github.io/stlahblog/css/pandoc-solarized.css" />


    <link href="https://laustep.github.io/stlahblog/libraries/highlighters/prettify/css/minimal.css" rel="stylesheet">

  <link href="https://fonts.googleapis.com/css?family=Raleway:400,600,200,800" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Droid+Sans" rel="stylesheet" type="text/css">
  <script src="https://laustep.github.io/stlahblog/libraries/jquery.min.js"></script>
  <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>

  <div class="container-fluid">
    <div class="row">
      <div class="main col-sm-12">
        <div id="header">
          <div id="logo" style="position:absolute;">
            <a href="https://laustep.github.io/stlahblog/">
              <img src="https://laustep.github.io/stlahblog/images/stla.jpg" alt="stla" width="100px" />
            </a>
          </div>
          <div id="navigation" style="margin-top:50px;">
            <a href="https://laustep.github.io/stlahblog/">Home</a>
            <a href="https://laustep.github.io/stlahblog/about.html">About</a>
            <a href="https://laustep.github.io/stlahblog/contact.html">Contact</a>
            <a href="https://laustep.github.io/stlahblog/archive.html">Archive</a>
          </div>
        </div>

        <div class="content">
          <h1>Focal quadrics and their lines of curvature</h1>
          <div class="info">
    Posted on May  3, 2020

        by Stéphane Laurent

</div>
<div class="info">

    Tags: <a href="https://laustep.github.io/stlahblog/tags/R.html">R</a>, <a href="https://laustep.github.io/stlahblog/tags/graphics.html">graphics</a>, <a href="https://laustep.github.io/stlahblog/tags/rgl.html">rgl</a>, <a href="https://laustep.github.io/stlahblog/tags/geometry.html">geometry</a>, <a href="https://laustep.github.io/stlahblog/tags/maths.html">maths</a>

</div>

<p>This blog post provides some R code for drawing focal quadrics and their curvatures lines with the <code>rgl</code> package.</p>
<h1 id="ellipsoid">Ellipsoid</h1>
<p>The <code>ellipsoidMesh</code> function below generates a mesh of the ellipsoid of equation <span class="math display">\[
\frac{x^2}{a^2} + \frac{y^2}{b^2} + \frac{z^2}{c^2} = 1.
\]</span></p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1"><span class="kw">library</span>(rgl)</a>
<a class="sourceLine" id="cb1-2" title="2">ellipsoidMesh &lt;-<span class="st"> </span><span class="cf">function</span>(a, b, c, <span class="dt">smoothness =</span> <span class="dv">5</span>){</a>
<a class="sourceLine" id="cb1-3" title="3">  <span class="kw">stopifnot</span>(a <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>, b <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>, c <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>)</a>
<a class="sourceLine" id="cb1-4" title="4">  sphere &lt;-<span class="st"> </span><span class="kw">subdivision3d</span>(<span class="kw">icosahedron3d</span>(), <span class="dt">depth =</span> smoothness)</a>
<a class="sourceLine" id="cb1-5" title="5">  sphere<span class="op">$</span>vb[4L,] &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb1-6" title="6"><span class="st">    </span><span class="kw">apply</span>(sphere<span class="op">$</span>vb[1L<span class="op">:</span>3L,], 2L, <span class="cf">function</span>(x) <span class="kw">sqrt</span>(<span class="kw">sum</span>(x<span class="op">*</span>x)))</a>
<a class="sourceLine" id="cb1-7" title="7">  sphere<span class="op">$</span>normals &lt;-<span class="st"> </span>sphere<span class="op">$</span>vb</a>
<a class="sourceLine" id="cb1-8" title="8">  <span class="kw">scale3d</span>(sphere, a, b, c)</a>
<a class="sourceLine" id="cb1-9" title="9">}</a></code></pre></div>
<p>The curvature lines of this ellipsoid are generated by the function <code>curvatureLinesE</code> given below. There are two families of curvature lines. The arguments <code>nu</code> and <code>nv</code> control the numbers of curvature lines in these two families. When the ellipsoid is tri-axial, <em>i.e.</em> when <span class="math inline">\(a\)</span>, <span class="math inline">\(b\)</span>, <span class="math inline">\(c\)</span> are distinct, the arguments <code>du</code> and <code>dv</code> must be positive and they control the size of the smallest curvature lines (if they were <span class="math inline">\(0\)</span>, the smallest curvature lines would degenerate to segments). When the ellipsoid is an ellipsoid of revolution, <em>i.e.</em> when two values of <span class="math inline">\(a\)</span>, <span class="math inline">\(b\)</span>, <span class="math inline">\(c\)</span> are equal, the curvature lines are the meridians and the parallels; in this case, <code>du</code> is ignored, and <code>dv</code>, which must be positive and strictly smaller than <span class="math inline">\(\frac{\pi}{2}\)</span>, control the size of the smallest parallel.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1">curvatureLinesE &lt;-<span class="st"> </span><span class="cf">function</span>(a, b, c, nu, nv, du, dv, <span class="dt">npoints =</span> <span class="dv">100</span>){</a>
<a class="sourceLine" id="cb2-2" title="2">  <span class="kw">stopifnot</span>(a <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>, b <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>, c <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>)</a>
<a class="sourceLine" id="cb2-3" title="3">  <span class="cf">if</span>((a <span class="op">!=</span><span class="st"> </span>b <span class="op">&amp;&amp;</span><span class="st"> </span>b <span class="op">!=</span><span class="st"> </span>c) <span class="op">&amp;&amp;</span><span class="st"> </span>(a <span class="op">&lt;</span><span class="st"> </span>b <span class="op">||</span><span class="st"> </span>b <span class="op">&lt;</span><span class="st"> </span>c)){</a>
<a class="sourceLine" id="cb2-4" title="4">    perm &lt;-<span class="st"> </span><span class="kw">order</span>(<span class="kw">c</span>(a,b,c), <span class="dt">decreasing =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb2-5" title="5">    abc &lt;-<span class="st"> </span><span class="kw">c</span>(a,b,c)[perm]</a>
<a class="sourceLine" id="cb2-6" title="6">    clines &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb2-7" title="7"><span class="st">      </span><span class="kw">curvatureLinesE</span>(abc[1L], abc[2L], abc[3L], nu, nv, du, dv, npoints)</a>
<a class="sourceLine" id="cb2-8" title="8">    <span class="kw">return</span>(<span class="kw">lapply</span>(clines, <span class="cf">function</span>(l) l[, perm]))</a>
<a class="sourceLine" id="cb2-9" title="9">  }</a>
<a class="sourceLine" id="cb2-10" title="10">  <span class="cf">if</span>(a <span class="op">!=</span><span class="st"> </span>b <span class="op">&amp;&amp;</span><span class="st"> </span>b <span class="op">!=</span><span class="st"> </span>c){</a>
<a class="sourceLine" id="cb2-11" title="11">    <span class="kw">stopifnot</span>(du <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>, dv <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>)</a>
<a class="sourceLine" id="cb2-12" title="12">    a2 &lt;-<span class="st"> </span>a<span class="op">^</span><span class="dv">2</span>; b2 &lt;-<span class="st"> </span>b<span class="op">^</span><span class="dv">2</span>; c2 &lt;-<span class="st"> </span>c<span class="op">^</span><span class="dv">2</span></a>
<a class="sourceLine" id="cb2-13" title="13">    h2ab &lt;-<span class="st"> </span>a2 <span class="op">-</span><span class="st"> </span>b2; h2ac &lt;-<span class="st"> </span>a2 <span class="op">-</span><span class="st"> </span>c2; h2bc &lt;-<span class="st"> </span>b2 <span class="op">-</span><span class="st"> </span>c2</a>
<a class="sourceLine" id="cb2-14" title="14">    <span class="cf">if</span>(du <span class="op">&gt;=</span><span class="st"> </span>h2ab) <span class="kw">stop</span>(<span class="st">&quot;`du` is too large.&quot;</span>)</a>
<a class="sourceLine" id="cb2-15" title="15">    <span class="cf">if</span>(dv <span class="op">&gt;=</span><span class="st"> </span>h2bc) <span class="kw">stop</span>(<span class="st">&quot;`dv` is too large.&quot;</span>)</a>
<a class="sourceLine" id="cb2-16" title="16">    out &lt;-<span class="st"> </span><span class="kw">vector</span>(<span class="st">&quot;list&quot;</span>, <span class="dv">2</span><span class="op">*</span>nv<span class="dv">-1</span> <span class="op">+</span><span class="st"> </span><span class="dv">2</span><span class="op">*</span>nu<span class="dv">-1</span>)</a>
<a class="sourceLine" id="cb2-17" title="17">    u_ &lt;-<span class="st"> </span><span class="kw">seq</span>(b2<span class="op">+</span>du, a2, <span class="dt">length.out =</span> nu)</a>
<a class="sourceLine" id="cb2-18" title="18">    s_ &lt;-<span class="st"> </span><span class="kw">seq</span>(b2, a2, <span class="dt">length.out =</span> npoints)</a>
<a class="sourceLine" id="cb2-19" title="19">    v_ &lt;-<span class="st"> </span><span class="kw">seq</span>(c2, b2<span class="op">-</span>dv, <span class="dt">length.out =</span> nv) </a>
<a class="sourceLine" id="cb2-20" title="20">    t_ &lt;-<span class="st"> </span><span class="kw">seq</span>(c2, b2, <span class="dt">length.out =</span> npoints)</a>
<a class="sourceLine" id="cb2-21" title="21">    mx &lt;-<span class="st"> </span>a <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(h2ac<span class="op">*</span>h2ab)</a>
<a class="sourceLine" id="cb2-22" title="22">    my &lt;-<span class="st"> </span>b <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(h2bc<span class="op">*</span>h2ab)</a>
<a class="sourceLine" id="cb2-23" title="23">    mz &lt;-<span class="st"> </span>c <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(h2bc<span class="op">*</span>h2ac)</a>
<a class="sourceLine" id="cb2-24" title="24">    <span class="cf">for</span>(j <span class="cf">in</span> 1L<span class="op">:</span>nv){</a>
<a class="sourceLine" id="cb2-25" title="25">      x &lt;-<span class="st"> </span>mx <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>((a2<span class="op">-</span>s_)<span class="op">*</span>(a2<span class="op">-</span>v_[j]))</a>
<a class="sourceLine" id="cb2-26" title="26">      y &lt;-<span class="st"> </span>my <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>((s_<span class="op">-</span>b2)<span class="op">*</span>(b2<span class="op">-</span>v_[j]))</a>
<a class="sourceLine" id="cb2-27" title="27">      z &lt;-<span class="st"> </span>mz <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>((s_<span class="op">-</span>c2)<span class="op">*</span>(v_[j]<span class="op">-</span>c2))</a>
<a class="sourceLine" id="cb2-28" title="28">      M &lt;-<span class="st"> </span><span class="kw">rbind</span>(<span class="kw">cbind</span>(x, y, z), <span class="kw">cbind</span>(<span class="op">-</span>x, y, z)[(npoints<span class="dv">-1</span>)<span class="op">:</span>1L,])</a>
<a class="sourceLine" id="cb2-29" title="29">      M &lt;-<span class="st"> </span><span class="kw">rbind</span>(M, <span class="kw">cbind</span>(M[,1L], <span class="op">-</span>M[,2L], M[,3L])[(<span class="dv">2</span><span class="op">*</span>npoints<span class="dv">-2</span>)<span class="op">:</span>1L,])</a>
<a class="sourceLine" id="cb2-30" title="30">      out[[j]] &lt;-<span class="st"> </span>M</a>
<a class="sourceLine" id="cb2-31" title="31">      <span class="cf">if</span>(j <span class="op">&gt;</span><span class="st"> </span>1L){</a>
<a class="sourceLine" id="cb2-32" title="32">        out[[nv<span class="op">+</span>j<span class="dv">-1</span>]] &lt;-<span class="st"> </span><span class="kw">cbind</span>(M[,<span class="kw">c</span>(1L,2L)], <span class="op">-</span>M[,3L])</a>
<a class="sourceLine" id="cb2-33" title="33">      }</a>
<a class="sourceLine" id="cb2-34" title="34">    }</a>
<a class="sourceLine" id="cb2-35" title="35">    <span class="cf">for</span>(i <span class="cf">in</span> 1L<span class="op">:</span>nu){</a>
<a class="sourceLine" id="cb2-36" title="36">      x &lt;-<span class="st"> </span>mx <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>((a2<span class="op">-</span>u_[i])<span class="op">*</span>(a2<span class="op">-</span>t_))</a>
<a class="sourceLine" id="cb2-37" title="37">      y &lt;-<span class="st"> </span>my <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>((u_[i]<span class="op">-</span>b2)<span class="op">*</span>(b2<span class="op">-</span>t_))</a>
<a class="sourceLine" id="cb2-38" title="38">      z &lt;-<span class="st"> </span>mz <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>((u_[i]<span class="op">-</span>c2)<span class="op">*</span>(t_<span class="op">-</span>c2))</a>
<a class="sourceLine" id="cb2-39" title="39">      M &lt;-<span class="st"> </span><span class="kw">rbind</span>(<span class="kw">cbind</span>(x, y, z), <span class="kw">cbind</span>(x, <span class="op">-</span>y, z)[(npoints<span class="dv">-1</span>)<span class="op">:</span>1L,])</a>
<a class="sourceLine" id="cb2-40" title="40">      M &lt;-<span class="st"> </span><span class="kw">rbind</span>(M, <span class="kw">cbind</span>(M[,<span class="kw">c</span>(1L,2L)], <span class="op">-</span>M[,3L])[(<span class="dv">2</span><span class="op">*</span>npoints<span class="dv">-2</span>)<span class="op">:</span>1L,])</a>
<a class="sourceLine" id="cb2-41" title="41">      out[[<span class="dv">2</span><span class="op">*</span>nv<span class="dv">-1</span><span class="op">+</span>i]] &lt;-<span class="st"> </span>M</a>
<a class="sourceLine" id="cb2-42" title="42">      <span class="cf">if</span>(i <span class="op">&lt;</span><span class="st"> </span>nu){</a>
<a class="sourceLine" id="cb2-43" title="43">        out[[<span class="dv">2</span><span class="op">*</span>nv<span class="dv">-1</span><span class="op">+</span>nu<span class="op">+</span>i]] &lt;-<span class="st"> </span><span class="kw">cbind</span>(<span class="op">-</span>M[,1L], M[,<span class="kw">c</span>(2L,3L)])</a>
<a class="sourceLine" id="cb2-44" title="44">      }</a>
<a class="sourceLine" id="cb2-45" title="45">    }</a>
<a class="sourceLine" id="cb2-46" title="46">  }<span class="cf">else</span>{ <span class="co"># a == b || b == c </span></a>
<a class="sourceLine" id="cb2-47" title="47">    <span class="co"># surface of revolution =&gt; curvature lines are meridians and parallels</span></a>
<a class="sourceLine" id="cb2-48" title="48">    <span class="kw">stopifnot</span>(dv <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>, dv <span class="op">&lt;</span><span class="st"> </span>pi<span class="op">/</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb2-49" title="49">    out &lt;-<span class="st"> </span><span class="kw">vector</span>(<span class="st">&quot;list&quot;</span>, nu <span class="op">+</span><span class="st"> </span>nv)</a>
<a class="sourceLine" id="cb2-50" title="50">    u_ &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">2</span><span class="op">*</span>pi, <span class="dt">length.out =</span> nu<span class="op">+</span><span class="dv">1</span>)[<span class="op">-</span>1L]</a>
<a class="sourceLine" id="cb2-51" title="51">    s_ &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">2</span><span class="op">*</span>pi, <span class="dt">length.out =</span> npoints)</a>
<a class="sourceLine" id="cb2-52" title="52">    v_ &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="op">-</span>pi<span class="op">/</span><span class="dv">2</span><span class="op">+</span>dv, pi<span class="op">/</span><span class="dv">2</span><span class="op">-</span>dv, <span class="dt">length.out =</span> nv) </a>
<a class="sourceLine" id="cb2-53" title="53">    t_ &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="op">-</span>pi, pi, <span class="dt">length.out =</span> npoints)</a>
<a class="sourceLine" id="cb2-54" title="54">    coss_ &lt;-<span class="st"> </span><span class="kw">cos</span>(s_); sins_ &lt;-<span class="st"> </span><span class="kw">sin</span>(s_)</a>
<a class="sourceLine" id="cb2-55" title="55">    cost_ &lt;-<span class="st"> </span><span class="kw">cos</span>(t_); sint_ &lt;-<span class="st"> </span><span class="kw">sin</span>(t_)</a>
<a class="sourceLine" id="cb2-56" title="56">    <span class="cf">for</span>(j <span class="cf">in</span> 1L<span class="op">:</span>nv){</a>
<a class="sourceLine" id="cb2-57" title="57">      x &lt;-<span class="st"> </span>a <span class="op">*</span><span class="st"> </span>coss_ <span class="op">*</span><span class="st"> </span><span class="kw">cos</span>(v_[j])</a>
<a class="sourceLine" id="cb2-58" title="58">      y &lt;-<span class="st"> </span>b <span class="op">*</span><span class="st"> </span>sins_ <span class="op">*</span><span class="st"> </span><span class="kw">cos</span>(v_[j])</a>
<a class="sourceLine" id="cb2-59" title="59">      z &lt;-<span class="st"> </span>c <span class="op">*</span><span class="st"> </span><span class="kw">sin</span>(v_[j])</a>
<a class="sourceLine" id="cb2-60" title="60">      out[[j]] &lt;-<span class="st"> </span><span class="kw">cbind</span>(x, y, z)</a>
<a class="sourceLine" id="cb2-61" title="61">    }</a>
<a class="sourceLine" id="cb2-62" title="62">    <span class="cf">for</span>(i <span class="cf">in</span> 1L<span class="op">:</span>nu){</a>
<a class="sourceLine" id="cb2-63" title="63">      x &lt;-<span class="st"> </span>a <span class="op">*</span><span class="st"> </span><span class="kw">cos</span>(u_[i]) <span class="op">*</span><span class="st"> </span>cost_</a>
<a class="sourceLine" id="cb2-64" title="64">      y &lt;-<span class="st"> </span>b <span class="op">*</span><span class="st"> </span><span class="kw">sin</span>(u_[i]) <span class="op">*</span><span class="st"> </span>cost_</a>
<a class="sourceLine" id="cb2-65" title="65">      z &lt;-<span class="st"> </span>c <span class="op">*</span><span class="st"> </span>sint_</a>
<a class="sourceLine" id="cb2-66" title="66">      out[[nv<span class="op">+</span>i]] &lt;-<span class="st"> </span><span class="kw">cbind</span>(x, y, z)</a>
<a class="sourceLine" id="cb2-67" title="67">    }</a>
<a class="sourceLine" id="cb2-68" title="68">  }</a>
<a class="sourceLine" id="cb2-69" title="69">  out</a>
<a class="sourceLine" id="cb2-70" title="70">}</a></code></pre></div>
<p>Here is an example:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1">a =<span class="st"> </span><span class="dv">7</span>; b =<span class="st"> </span><span class="dv">5</span>; c =<span class="st"> </span><span class="dv">3</span></a>
<a class="sourceLine" id="cb3-2" title="2">mesh &lt;-<span class="st"> </span><span class="kw">ellipsoidMesh</span>(a, b, c)</a>
<a class="sourceLine" id="cb3-3" title="3">clines &lt;-<span class="st"> </span><span class="kw">curvatureLinesE</span>(a, b, c, <span class="dt">nu =</span> <span class="dv">5</span>, <span class="dt">nv =</span> <span class="dv">5</span>, <span class="dt">du =</span> <span class="fl">0.4</span>, <span class="dt">dv =</span> <span class="dv">1</span>, </a>
<a class="sourceLine" id="cb3-4" title="4">                          <span class="dt">npoints =</span> <span class="dv">300</span>)</a>
<a class="sourceLine" id="cb3-5" title="5"><span class="kw">shade3d</span>(mesh, <span class="dt">col =</span> <span class="st">&quot;springgreen&quot;</span>)</a>
<a class="sourceLine" id="cb3-6" title="6"><span class="kw">invisible</span>(<span class="kw">lapply</span>(clines, <span class="cf">function</span>(l){</a>
<a class="sourceLine" id="cb3-7" title="7">  <span class="kw">shade3d</span>(<span class="kw">cylinder3d</span>(l, <span class="dt">radius =</span> <span class="fl">0.08</span>, <span class="dt">sides =</span> <span class="dv">30</span>))</a>
<a class="sourceLine" id="cb3-8" title="8">}))</a></code></pre></div>
<p><img src="https://laustep.github.io/stlahblog/posts/figures/quadrics_E.png" /></p>
<h1 id="one-sheeted-hyperboloid">One-sheeted hyperboloid</h1>
<p>There are three types of one-sheeted hyperboloids, corresponding to these equations: <span class="math display">\[
\frac{x^2}{a^2} + \frac{y^2}{b^2} - \frac{z^2}{c^2} = 1 \\
\frac{x^2}{a^2} - \frac{y^2}{b^2} + \frac{z^2}{c^2} = 1 \\
-\frac{x^2}{a^2} + \frac{y^2}{b^2} + \frac{z^2}{c^2} = 1.
\]</span> The <code>hyperboloidMesh</code> function below generates a mesh of the one-sheeted hyperboloid; the <code>signature</code> argument corresponds to one of the above equations, it must be <code>"++-"</code>, <code>"+-+"</code> or <code>"-++"</code>. The mesh is made of quadrilaterals and their number is controlled by the arguments <code>nu</code> and <code>nv</code>. The hyperboloid is infinite along the direction corresponding to the minus sign, and the argument <code>vmin</code> controls the truncation of the hyperboloid in this direction.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1">hyperboloidMesh &lt;-<span class="st"> </span><span class="cf">function</span>(a, b, c, signature, nu, nv, vmin){</a>
<a class="sourceLine" id="cb4-2" title="2">  <span class="kw">stopifnot</span>(signature <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;++-&quot;</span>, <span class="st">&quot;+-+&quot;</span>, <span class="st">&quot;-++&quot;</span>))</a>
<a class="sourceLine" id="cb4-3" title="3">  <span class="kw">stopifnot</span>(vmin <span class="op">&lt;</span><span class="st"> </span><span class="dv">1</span>, a <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>, b <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>, c <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>)</a>
<a class="sourceLine" id="cb4-4" title="4">  <span class="cf">if</span>(signature <span class="op">==</span><span class="st"> &quot;+-+&quot;</span>){</a>
<a class="sourceLine" id="cb4-5" title="5">    mesh &lt;-<span class="st"> </span><span class="kw">hyperboloidMesh</span>(a, c, b, <span class="st">&quot;++-&quot;</span>, nu, nv, vmin)</a>
<a class="sourceLine" id="cb4-6" title="6">    mesh<span class="op">$</span>vb &lt;-<span class="st"> </span>mesh<span class="op">$</span>vb[<span class="kw">c</span>(1L,3L,2L,4L),]</a>
<a class="sourceLine" id="cb4-7" title="7">    mesh<span class="op">$</span>normals &lt;-<span class="st"> </span>mesh<span class="op">$</span>normals[<span class="kw">c</span>(1L,3L,2L),]</a>
<a class="sourceLine" id="cb4-8" title="8">    mesh<span class="op">$</span>ib &lt;-<span class="st"> </span>mesh<span class="op">$</span>ib[4L<span class="op">:</span>1L,]</a>
<a class="sourceLine" id="cb4-9" title="9">    <span class="kw">return</span>(mesh)</a>
<a class="sourceLine" id="cb4-10" title="10">  }<span class="cf">else</span> <span class="cf">if</span>(signature <span class="op">==</span><span class="st"> &quot;-++&quot;</span>){</a>
<a class="sourceLine" id="cb4-11" title="11">    mesh &lt;-<span class="st"> </span><span class="kw">hyperboloidMesh</span>(c, b, a, <span class="st">&quot;++-&quot;</span>, nu, nv, vmin)</a>
<a class="sourceLine" id="cb4-12" title="12">    mesh<span class="op">$</span>vb &lt;-<span class="st"> </span>mesh<span class="op">$</span>vb[<span class="kw">c</span>(3L,2L,1L,4L),]</a>
<a class="sourceLine" id="cb4-13" title="13">    mesh<span class="op">$</span>normals &lt;-<span class="st"> </span>mesh<span class="op">$</span>normals[<span class="kw">c</span>(3L,2L,1L),]</a>
<a class="sourceLine" id="cb4-14" title="14">    mesh<span class="op">$</span>ib &lt;-<span class="st"> </span>mesh<span class="op">$</span>ib[4L<span class="op">:</span>1L,]</a>
<a class="sourceLine" id="cb4-15" title="15">    <span class="kw">return</span>(mesh)</a>
<a class="sourceLine" id="cb4-16" title="16">  }</a>
<a class="sourceLine" id="cb4-17" title="17">  c0 &lt;-<span class="st"> </span>c</a>
<a class="sourceLine" id="cb4-18" title="18">  <span class="cf">if</span>(b <span class="op">&gt;</span><span class="st"> </span>a){</a>
<a class="sourceLine" id="cb4-19" title="19">    exchange &lt;-<span class="st"> </span><span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb4-20" title="20">    a0 &lt;-<span class="st"> </span>b; b0 &lt;-<span class="st"> </span>a</a>
<a class="sourceLine" id="cb4-21" title="21">  }<span class="cf">else</span>{</a>
<a class="sourceLine" id="cb4-22" title="22">    exchange &lt;-<span class="st"> </span><span class="ot">FALSE</span></a>
<a class="sourceLine" id="cb4-23" title="23">    a0 &lt;-<span class="st"> </span>a; b0 &lt;-<span class="st"> </span>b</a>
<a class="sourceLine" id="cb4-24" title="24">  }</a>
<a class="sourceLine" id="cb4-25" title="25">  Mu2 &lt;-<span class="st"> </span>a0<span class="op">^</span><span class="dv">2</span></a>
<a class="sourceLine" id="cb4-26" title="26">  h2ab &lt;-<span class="st"> </span>Mu2 <span class="op">-</span><span class="st"> </span>b0<span class="op">^</span><span class="dv">2</span>; h2ac &lt;-<span class="st"> </span>c0<span class="op">^</span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span>Mu2</a>
<a class="sourceLine" id="cb4-27" title="27">  c2 &lt;-<span class="st"> </span><span class="dv">1</span>; a2 &lt;-<span class="st"> </span>c2 <span class="op">+</span><span class="st"> </span>h2ac; b2 &lt;-<span class="st"> </span>a2 <span class="op">-</span><span class="st"> </span>h2ab</a>
<a class="sourceLine" id="cb4-28" title="28">  h2bc &lt;-<span class="st"> </span>b2 <span class="op">-</span><span class="st"> </span>c2</a>
<a class="sourceLine" id="cb4-29" title="29">  <span class="co">#</span></a>
<a class="sourceLine" id="cb4-30" title="30">  vertices &lt;-<span class="st"> </span>Normals &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="ot">NA_real_</span>, <span class="dt">nrow =</span> 3L, <span class="dt">ncol =</span> nu<span class="op">*</span>nv)</a>
<a class="sourceLine" id="cb4-31" title="31">  indices &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="ot">NA_integer_</span>, <span class="dt">nrow =</span> 4L, <span class="dt">ncol =</span> (nu<span class="dv">-1</span>)<span class="op">*</span>(nv<span class="dv">-1</span>))</a>
<a class="sourceLine" id="cb4-32" title="32">  v_ &lt;-<span class="st"> </span><span class="kw">seq</span>(vmin, c2, <span class="dt">length.out =</span> nv)</a>
<a class="sourceLine" id="cb4-33" title="33">  <span class="co">#</span></a>
<a class="sourceLine" id="cb4-34" title="34">  <span class="cf">if</span>(a0 <span class="op">!=</span><span class="st"> </span>b0){</a>
<a class="sourceLine" id="cb4-35" title="35">    u_ &lt;-<span class="st"> </span><span class="kw">seq</span>(b2, a2, <span class="dt">length.out =</span> nu)</a>
<a class="sourceLine" id="cb4-36" title="36">    x &lt;-<span class="st"> </span>a0 <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(h2ac<span class="op">*</span>h2ab) <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>(a2<span class="op">-</span>u_)</a>
<a class="sourceLine" id="cb4-37" title="37">    y &lt;-<span class="st"> </span>b0 <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(h2bc<span class="op">*</span>h2ab) <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>(u_<span class="op">-</span>b2)</a>
<a class="sourceLine" id="cb4-38" title="38">    z &lt;-<span class="st"> </span>c0 <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(h2bc<span class="op">*</span>h2ac) <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>(u_<span class="op">-</span>c2)</a>
<a class="sourceLine" id="cb4-39" title="39">  }<span class="cf">else</span>{</a>
<a class="sourceLine" id="cb4-40" title="40">    u_ &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">2</span><span class="op">*</span>pi, <span class="dt">length.out =</span> nu<span class="op">+</span><span class="dv">1</span>)[<span class="op">-</span>1L]</a>
<a class="sourceLine" id="cb4-41" title="41">    z &lt;-<span class="st"> </span><span class="kw">rep</span>(c0<span class="op">/</span><span class="kw">sqrt</span>(h2ac), nu)</a>
<a class="sourceLine" id="cb4-42" title="42">    mxy &lt;-<span class="st"> </span>a0 <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(h2ac)</a>
<a class="sourceLine" id="cb4-43" title="43">    x &lt;-<span class="st"> </span>mxy <span class="op">*</span><span class="st"> </span><span class="kw">cos</span>(u_)</a>
<a class="sourceLine" id="cb4-44" title="44">    y &lt;-<span class="st"> </span>mxy <span class="op">*</span><span class="st"> </span><span class="kw">sin</span>(u_)</a>
<a class="sourceLine" id="cb4-45" title="45">  }</a>
<a class="sourceLine" id="cb4-46" title="46">  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>nu){</a>
<a class="sourceLine" id="cb4-47" title="47">    <span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>nv){</a>
<a class="sourceLine" id="cb4-48" title="48">      P &lt;-<span class="st"> </span>vertices[, (i<span class="dv">-1</span>)<span class="op">*</span>nv<span class="op">+</span>j] &lt;-<span class="st"> </span><span class="kw">c</span>(</a>
<a class="sourceLine" id="cb4-49" title="49">        x[i] <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>(a2<span class="op">-</span>v_[j]),</a>
<a class="sourceLine" id="cb4-50" title="50">        y[i] <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>(b2<span class="op">-</span>v_[j]),</a>
<a class="sourceLine" id="cb4-51" title="51">        z[i] <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>(c2<span class="op">-</span>v_[j])</a>
<a class="sourceLine" id="cb4-52" title="52">      )</a>
<a class="sourceLine" id="cb4-53" title="53">      Normals[, (i<span class="dv">-1</span>)<span class="op">*</span>nv<span class="op">+</span>j] &lt;-<span class="st"> </span><span class="kw">c</span>(P[1L]<span class="op">/</span>a0<span class="op">^</span><span class="dv">2</span>, P[2L]<span class="op">/</span>b0<span class="op">^</span><span class="dv">2</span>, <span class="op">-</span>P[3L]<span class="op">/</span>c0<span class="op">^</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb4-54" title="54">    }</a>
<a class="sourceLine" id="cb4-55" title="55">  }</a>
<a class="sourceLine" id="cb4-56" title="56">  <span class="co"># quads</span></a>
<a class="sourceLine" id="cb4-57" title="57">  <span class="cf">for</span>(i <span class="cf">in</span> 1L<span class="op">:</span>(nu<span class="dv">-1</span>)){</a>
<a class="sourceLine" id="cb4-58" title="58">    im1 &lt;-<span class="st"> </span>i<span class="op">-</span>1L</a>
<a class="sourceLine" id="cb4-59" title="59">    <span class="cf">for</span>(j <span class="cf">in</span> 1L<span class="op">:</span>(nv<span class="dv">-1</span>)){</a>
<a class="sourceLine" id="cb4-60" title="60">      jp1 &lt;-<span class="st"> </span>j<span class="op">+</span>1L</a>
<a class="sourceLine" id="cb4-61" title="61">      quad &lt;-<span class="st"> </span><span class="kw">c</span>(im1<span class="op">*</span>nv<span class="op">+</span>j, im1<span class="op">*</span>nv<span class="op">+</span>jp1, i<span class="op">*</span>nv<span class="op">+</span>jp1, i<span class="op">*</span>nv<span class="op">+</span>j)</a>
<a class="sourceLine" id="cb4-62" title="62">      indices[, im1<span class="op">*</span>(nv<span class="dv">-1</span>)<span class="op">+</span>j] &lt;-<span class="st"> </span><span class="cf">if</span>(exchange) <span class="kw">rev</span>(quad) <span class="cf">else</span> quad</a>
<a class="sourceLine" id="cb4-63" title="63">    }</a>
<a class="sourceLine" id="cb4-64" title="64">  }</a>
<a class="sourceLine" id="cb4-65" title="65">  vertices &lt;-<span class="st"> </span><span class="kw">cbind</span>(vertices, <span class="kw">c</span>(<span class="op">-</span><span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>) <span class="op">*</span><span class="st"> </span>vertices)</a>
<a class="sourceLine" id="cb4-66" title="66">  indices &lt;-<span class="st"> </span><span class="kw">cbind</span>(indices, indices[4L<span class="op">:</span>1L,] <span class="op">+</span><span class="st"> </span>nu<span class="op">*</span>nv)</a>
<a class="sourceLine" id="cb4-67" title="67">  Normals &lt;-<span class="st"> </span><span class="kw">cbind</span>(Normals, <span class="kw">c</span>(<span class="op">-</span><span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>) <span class="op">*</span><span class="st"> </span>Normals)</a>
<a class="sourceLine" id="cb4-68" title="68">  vertices &lt;-<span class="st"> </span><span class="kw">cbind</span>(vertices, <span class="kw">c</span>(<span class="dv">1</span>,<span class="op">-</span><span class="dv">1</span>,<span class="dv">1</span>) <span class="op">*</span><span class="st"> </span>vertices)</a>
<a class="sourceLine" id="cb4-69" title="69">  indices &lt;-<span class="st"> </span><span class="kw">cbind</span>(indices, indices[4L<span class="op">:</span>1L,] <span class="op">+</span><span class="st"> </span><span class="dv">2</span><span class="op">*</span>nu<span class="op">*</span>nv)</a>
<a class="sourceLine" id="cb4-70" title="70">  Normals &lt;-<span class="st"> </span><span class="kw">cbind</span>(Normals, <span class="kw">c</span>(<span class="dv">1</span>,<span class="op">-</span><span class="dv">1</span>,<span class="dv">1</span>) <span class="op">*</span><span class="st"> </span>Normals)</a>
<a class="sourceLine" id="cb4-71" title="71">  vertices &lt;-<span class="st"> </span><span class="kw">cbind</span>(vertices, <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="op">-</span><span class="dv">1</span>) <span class="op">*</span><span class="st"> </span>vertices)</a>
<a class="sourceLine" id="cb4-72" title="72">  indices &lt;-<span class="st"> </span><span class="kw">cbind</span>(indices, indices[4L<span class="op">:</span>1L,] <span class="op">+</span><span class="st"> </span><span class="dv">4</span><span class="op">*</span>nu<span class="op">*</span>nv)</a>
<a class="sourceLine" id="cb4-73" title="73">  Normals &lt;-<span class="st"> </span><span class="kw">cbind</span>(Normals, <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="op">-</span><span class="dv">1</span>) <span class="op">*</span><span class="st"> </span>Normals)</a>
<a class="sourceLine" id="cb4-74" title="74">  mesh &lt;-<span class="st"> </span><span class="kw">qmesh3d</span>(</a>
<a class="sourceLine" id="cb4-75" title="75">    <span class="dt">vertices =</span> <span class="cf">if</span>(exchange) vertices[<span class="kw">c</span>(2L,1L,3L),] <span class="cf">else</span> vertices,</a>
<a class="sourceLine" id="cb4-76" title="76">    <span class="dt">indices =</span> indices,</a>
<a class="sourceLine" id="cb4-77" title="77">    <span class="dt">homogeneous =</span> <span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb4-78" title="78">    <span class="dt">normals =</span> <span class="kw">t</span>(<span class="cf">if</span>(exchange) Normals[<span class="kw">c</span>(2L,1L,3L),] <span class="cf">else</span> Normals)</a>
<a class="sourceLine" id="cb4-79" title="79">  )</a>
<a class="sourceLine" id="cb4-80" title="80">  mesh</a>
<a class="sourceLine" id="cb4-81" title="81">}</a></code></pre></div>
<p>The <code>curvatureLinesH1</code> function below generates some curvature lines of the one-sheeted hyperboloid. There are two families of curvature lines and the desired numbers of lines in them are controlled by the arguments <code>nu</code> and <code>nv</code>.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1">curvatureLinesH1 &lt;-<span class="st"> </span><span class="cf">function</span>(a, b, c, <span class="dt">signature =</span> <span class="st">&quot;++-&quot;</span>, nu, nv, vmin,  </a>
<a class="sourceLine" id="cb5-2" title="2">                             <span class="dt">npoints =</span> <span class="dv">100</span>){</a>
<a class="sourceLine" id="cb5-3" title="3">  <span class="kw">stopifnot</span>(signature <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;++-&quot;</span>, <span class="st">&quot;+-+&quot;</span>, <span class="st">&quot;-++&quot;</span>))</a>
<a class="sourceLine" id="cb5-4" title="4">  <span class="kw">stopifnot</span>(vmin <span class="op">&lt;</span><span class="st"> </span><span class="dv">1</span>, a <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>, b <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>, c <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>)</a>
<a class="sourceLine" id="cb5-5" title="5">  <span class="cf">if</span>(signature <span class="op">==</span><span class="st"> &quot;+-+&quot;</span>){</a>
<a class="sourceLine" id="cb5-6" title="6">    clines &lt;-<span class="st"> </span><span class="kw">curvatureLinesH1</span>(a, c, b, <span class="st">&quot;++-&quot;</span>, nu, nv, vmin, npoints)</a>
<a class="sourceLine" id="cb5-7" title="7">    <span class="kw">return</span>(<span class="kw">lapply</span>(clines, <span class="cf">function</span>(l) l[,<span class="kw">c</span>(1L,3L,2L)]))</a>
<a class="sourceLine" id="cb5-8" title="8">  }<span class="cf">else</span> <span class="cf">if</span>(signature <span class="op">==</span><span class="st"> &quot;-++&quot;</span>){</a>
<a class="sourceLine" id="cb5-9" title="9">    clines &lt;-<span class="st"> </span><span class="kw">curvatureLinesH1</span>(c, b, a, <span class="st">&quot;++-&quot;</span>, nu, nv, vmin, npoints)</a>
<a class="sourceLine" id="cb5-10" title="10">    <span class="kw">return</span>(<span class="kw">lapply</span>(clines, <span class="cf">function</span>(l) l[,<span class="kw">c</span>(3L,2L,1L)]))</a>
<a class="sourceLine" id="cb5-11" title="11">  }</a>
<a class="sourceLine" id="cb5-12" title="12">  c0 &lt;-<span class="st"> </span>c</a>
<a class="sourceLine" id="cb5-13" title="13">  <span class="cf">if</span>(b <span class="op">&gt;</span><span class="st"> </span>a){</a>
<a class="sourceLine" id="cb5-14" title="14">    exchange &lt;-<span class="st"> </span><span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb5-15" title="15">    a0 &lt;-<span class="st"> </span>b; b0 &lt;-<span class="st"> </span>a</a>
<a class="sourceLine" id="cb5-16" title="16">  }<span class="cf">else</span>{</a>
<a class="sourceLine" id="cb5-17" title="17">    exchange &lt;-<span class="st"> </span><span class="ot">FALSE</span></a>
<a class="sourceLine" id="cb5-18" title="18">    a0 &lt;-<span class="st"> </span>a; b0 &lt;-<span class="st"> </span>b</a>
<a class="sourceLine" id="cb5-19" title="19">  }</a>
<a class="sourceLine" id="cb5-20" title="20">  Mu2 &lt;-<span class="st"> </span>a0<span class="op">^</span><span class="dv">2</span></a>
<a class="sourceLine" id="cb5-21" title="21">  h2ab &lt;-<span class="st"> </span>Mu2 <span class="op">-</span><span class="st"> </span>b0<span class="op">^</span><span class="dv">2</span>; h2ac &lt;-<span class="st"> </span>c0<span class="op">^</span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span>Mu2</a>
<a class="sourceLine" id="cb5-22" title="22">  c2 &lt;-<span class="st"> </span><span class="dv">1</span>; a2 &lt;-<span class="st"> </span>c2 <span class="op">+</span><span class="st"> </span>h2ac; b2 &lt;-<span class="st"> </span>a2 <span class="op">-</span><span class="st"> </span>h2ab</a>
<a class="sourceLine" id="cb5-23" title="23">  h2bc &lt;-<span class="st"> </span>b2 <span class="op">-</span><span class="st"> </span>c2</a>
<a class="sourceLine" id="cb5-24" title="24">  <span class="co">#  </span></a>
<a class="sourceLine" id="cb5-25" title="25">  v_ &lt;-<span class="st"> </span><span class="kw">seq</span>(vmin, c2, <span class="dt">length.out =</span> nv)</a>
<a class="sourceLine" id="cb5-26" title="26">  t_ &lt;-<span class="st"> </span><span class="kw">seq</span>(vmin, c2, <span class="dt">length.out =</span> npoints)</a>
<a class="sourceLine" id="cb5-27" title="27">  <span class="co">#</span></a>
<a class="sourceLine" id="cb5-28" title="28">  <span class="cf">if</span>(a0 <span class="op">!=</span><span class="st"> </span>b0){</a>
<a class="sourceLine" id="cb5-29" title="29">    u_ &lt;-<span class="st"> </span><span class="kw">seq</span>(b2, a2, <span class="dt">length.out =</span> nu)</a>
<a class="sourceLine" id="cb5-30" title="30">    s_ &lt;-<span class="st"> </span><span class="kw">seq</span>(b2, a2, <span class="dt">length.out =</span> npoints)</a>
<a class="sourceLine" id="cb5-31" title="31">    mx &lt;-<span class="st"> </span>a0 <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(h2ac<span class="op">*</span>h2ab)</a>
<a class="sourceLine" id="cb5-32" title="32">    my &lt;-<span class="st"> </span>b0 <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(h2bc<span class="op">*</span>h2ab)</a>
<a class="sourceLine" id="cb5-33" title="33">    mz &lt;-<span class="st"> </span>c0 <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(h2bc<span class="op">*</span>h2ac)</a>
<a class="sourceLine" id="cb5-34" title="34">    out &lt;-<span class="st"> </span><span class="kw">vector</span>(<span class="st">&quot;list&quot;</span>, <span class="dv">2</span><span class="op">*</span>nv <span class="op">+</span><span class="st"> </span><span class="dv">4</span><span class="op">*</span>nu <span class="op">-</span><span class="st"> </span><span class="dv">5</span>)</a>
<a class="sourceLine" id="cb5-35" title="35">    <span class="cf">for</span>(j <span class="cf">in</span> 1L<span class="op">:</span>nv){</a>
<a class="sourceLine" id="cb5-36" title="36">      x &lt;-<span class="st"> </span>mx <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>((a2<span class="op">-</span>s_)<span class="op">*</span>(a2<span class="op">-</span>v_[j]))</a>
<a class="sourceLine" id="cb5-37" title="37">      y &lt;-<span class="st"> </span>my <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>((s_<span class="op">-</span>b2)<span class="op">*</span>(b2<span class="op">-</span>v_[j]))</a>
<a class="sourceLine" id="cb5-38" title="38">      z &lt;-<span class="st"> </span>mz <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>((s_<span class="op">-</span>c2)<span class="op">*</span>(c2<span class="op">-</span>v_[j]))</a>
<a class="sourceLine" id="cb5-39" title="39">      M &lt;-<span class="st"> </span><span class="kw">rbind</span>(<span class="kw">cbind</span>(x, y, z), <span class="kw">cbind</span>(<span class="op">-</span>x, y, z)[(npoints<span class="dv">-1</span>)<span class="op">:</span>1L,])</a>
<a class="sourceLine" id="cb5-40" title="40">      M &lt;-<span class="st"> </span><span class="kw">rbind</span>(M, <span class="kw">cbind</span>(M[,1L], <span class="op">-</span>M[,2L], M[,3L])[(<span class="dv">2</span><span class="op">*</span>npoints<span class="dv">-2</span>)<span class="op">:</span>1L,])</a>
<a class="sourceLine" id="cb5-41" title="41">      out[[j]] &lt;-<span class="st"> </span>M</a>
<a class="sourceLine" id="cb5-42" title="42">      <span class="cf">if</span>(j <span class="op">&lt;</span><span class="st"> </span>nv){</a>
<a class="sourceLine" id="cb5-43" title="43">        out[[nv<span class="op">+</span>j]] &lt;-<span class="st"> </span><span class="kw">cbind</span>(M[,<span class="kw">c</span>(1L,2L)], <span class="op">-</span>M[,3L])</a>
<a class="sourceLine" id="cb5-44" title="44">      }</a>
<a class="sourceLine" id="cb5-45" title="45">    }</a>
<a class="sourceLine" id="cb5-46" title="46">    <span class="cf">for</span>(i <span class="cf">in</span> 1L<span class="op">:</span>nu){</a>
<a class="sourceLine" id="cb5-47" title="47">      x &lt;-<span class="st"> </span>mx <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>((a2<span class="op">-</span>u_[i])<span class="op">*</span>(a2<span class="op">-</span>t_))</a>
<a class="sourceLine" id="cb5-48" title="48">      y &lt;-<span class="st"> </span>my <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>((u_[i]<span class="op">-</span>b2)<span class="op">*</span>(b2<span class="op">-</span>t_))</a>
<a class="sourceLine" id="cb5-49" title="49">      z &lt;-<span class="st"> </span>mz <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>((u_[i]<span class="op">-</span>c2)<span class="op">*</span>(c2<span class="op">-</span>t_))</a>
<a class="sourceLine" id="cb5-50" title="50">      M &lt;-<span class="st"> </span><span class="kw">rbind</span>(<span class="kw">cbind</span>(x, y, z), <span class="kw">cbind</span>(x, y, <span class="op">-</span>z)[(npoints<span class="dv">-1</span>)<span class="op">:</span>1L,])</a>
<a class="sourceLine" id="cb5-51" title="51">      out[[<span class="dv">2</span><span class="op">*</span>nv<span class="dv">-1</span><span class="op">+</span>i]] &lt;-<span class="st"> </span>M</a>
<a class="sourceLine" id="cb5-52" title="52">      <span class="cf">if</span>(i <span class="op">&lt;</span><span class="st"> </span>nu){</a>
<a class="sourceLine" id="cb5-53" title="53">        out[[<span class="dv">2</span><span class="op">*</span>nv<span class="dv">-1</span><span class="op">+</span>nu<span class="op">+</span>i]] &lt;-<span class="st"> </span><span class="kw">cbind</span>(<span class="op">-</span>M[,1L], M[,<span class="kw">c</span>(2L,3L)])</a>
<a class="sourceLine" id="cb5-54" title="54">        <span class="cf">if</span>(i<span class="op">&gt;</span>1L) out[[<span class="dv">2</span><span class="op">*</span>nv<span class="op">+</span><span class="dv">3</span><span class="op">*</span>nu<span class="op">+</span>i<span class="dv">-4</span>]] &lt;-<span class="st"> </span><span class="kw">cbind</span>(<span class="op">-</span>M[,<span class="kw">c</span>(1L,2L)], M[,3L])</a>
<a class="sourceLine" id="cb5-55" title="55">      }</a>
<a class="sourceLine" id="cb5-56" title="56">      <span class="cf">if</span>(i <span class="op">&gt;</span><span class="st"> </span>1L){</a>
<a class="sourceLine" id="cb5-57" title="57">        out[[<span class="dv">2</span><span class="op">*</span>nv<span class="op">+</span><span class="dv">2</span><span class="op">*</span>nu<span class="op">+</span>i<span class="dv">-3</span>]] &lt;-<span class="st"> </span><span class="kw">cbind</span>(M[,1L], <span class="op">-</span>M[,2L], M[,3L])</a>
<a class="sourceLine" id="cb5-58" title="58">      }</a>
<a class="sourceLine" id="cb5-59" title="59">    }</a>
<a class="sourceLine" id="cb5-60" title="60">  }<span class="cf">else</span>{ <span class="co"># a0 = b0</span></a>
<a class="sourceLine" id="cb5-61" title="61">    u_ &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">2</span><span class="op">*</span>pi, <span class="dt">length.out =</span> nu<span class="op">+</span><span class="dv">1</span>)[<span class="op">-</span>1L]</a>
<a class="sourceLine" id="cb5-62" title="62">    s_ &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">2</span><span class="op">*</span>pi, <span class="dt">length.out =</span> npoints)</a>
<a class="sourceLine" id="cb5-63" title="63">    coss_ &lt;-<span class="st"> </span><span class="kw">cos</span>(s_); sins_ &lt;-<span class="st"> </span><span class="kw">sin</span>(s_)</a>
<a class="sourceLine" id="cb5-64" title="64">    mxy &lt;-<span class="st"> </span>a0 <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(h2ac)</a>
<a class="sourceLine" id="cb5-65" title="65">    mz &lt;-<span class="st"> </span>c0 <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(h2bc)</a>
<a class="sourceLine" id="cb5-66" title="66">    out &lt;-<span class="st"> </span><span class="kw">vector</span>(<span class="st">&quot;list&quot;</span>, <span class="dv">2</span><span class="op">*</span>nv <span class="op">+</span><span class="st"> </span><span class="dv">4</span><span class="op">*</span>nu <span class="op">-</span><span class="st"> </span><span class="dv">5</span>)</a>
<a class="sourceLine" id="cb5-67" title="67">    <span class="cf">for</span>(j <span class="cf">in</span> 1L<span class="op">:</span>nv){</a>
<a class="sourceLine" id="cb5-68" title="68">      x &lt;-<span class="st"> </span>mxy <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>(a2<span class="op">-</span>v_[j]) <span class="op">*</span><span class="st"> </span>coss_</a>
<a class="sourceLine" id="cb5-69" title="69">      y &lt;-<span class="st"> </span>mxy <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>(b2<span class="op">-</span>v_[j]) <span class="op">*</span><span class="st"> </span>sins_</a>
<a class="sourceLine" id="cb5-70" title="70">      z &lt;-<span class="st"> </span>mz <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>(c2<span class="op">-</span>v_[j]) </a>
<a class="sourceLine" id="cb5-71" title="71">      M &lt;-<span class="st"> </span><span class="kw">cbind</span>(x, y, z)</a>
<a class="sourceLine" id="cb5-72" title="72">      out[[j]] &lt;-<span class="st"> </span>M</a>
<a class="sourceLine" id="cb5-73" title="73">      <span class="cf">if</span>(j <span class="op">&lt;</span><span class="st"> </span>nv){</a>
<a class="sourceLine" id="cb5-74" title="74">        out[[nv<span class="op">+</span>j]] &lt;-<span class="st"> </span><span class="kw">cbind</span>(M[,<span class="kw">c</span>(1L,2L)], <span class="op">-</span>M[,3L])</a>
<a class="sourceLine" id="cb5-75" title="75">      }</a>
<a class="sourceLine" id="cb5-76" title="76">    }</a>
<a class="sourceLine" id="cb5-77" title="77">    r &lt;-<span class="st"> </span>mxy <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>(a2<span class="op">-</span>t_)</a>
<a class="sourceLine" id="cb5-78" title="78">    z &lt;-<span class="st"> </span>mz <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>(c2<span class="op">-</span>t_)</a>
<a class="sourceLine" id="cb5-79" title="79">    <span class="cf">for</span>(i <span class="cf">in</span> 1L<span class="op">:</span>nu){</a>
<a class="sourceLine" id="cb5-80" title="80">      x &lt;-<span class="st"> </span>r <span class="op">*</span><span class="st"> </span><span class="kw">cos</span>(u_[i])</a>
<a class="sourceLine" id="cb5-81" title="81">      y &lt;-<span class="st"> </span>r <span class="op">*</span><span class="st"> </span><span class="kw">sin</span>(u_[i])</a>
<a class="sourceLine" id="cb5-82" title="82">      M &lt;-<span class="st"> </span><span class="kw">rbind</span>(<span class="kw">cbind</span>(x, y, z), <span class="kw">cbind</span>(x, y, <span class="op">-</span>z)[(npoints<span class="dv">-1</span>)<span class="op">:</span>1L,])</a>
<a class="sourceLine" id="cb5-83" title="83">      out[[<span class="dv">2</span><span class="op">*</span>nv<span class="dv">-1</span><span class="op">+</span>i]] &lt;-<span class="st"> </span>M</a>
<a class="sourceLine" id="cb5-84" title="84">      <span class="cf">if</span>(i <span class="op">&lt;</span><span class="st"> </span>nu){</a>
<a class="sourceLine" id="cb5-85" title="85">        out[[<span class="dv">2</span><span class="op">*</span>nv<span class="dv">-1</span><span class="op">+</span>nu<span class="op">+</span>i]] &lt;-<span class="st"> </span><span class="kw">cbind</span>(<span class="op">-</span>M[,1L], M[,<span class="kw">c</span>(2L,3L)])</a>
<a class="sourceLine" id="cb5-86" title="86">        <span class="cf">if</span>(i<span class="op">&gt;</span>1L) out[[<span class="dv">2</span><span class="op">*</span>nv<span class="op">+</span><span class="dv">3</span><span class="op">*</span>nu<span class="op">+</span>i<span class="dv">-4</span>]] &lt;-<span class="st"> </span><span class="kw">cbind</span>(<span class="op">-</span>M[,<span class="kw">c</span>(1L,2L)], M[,3L])</a>
<a class="sourceLine" id="cb5-87" title="87">      }</a>
<a class="sourceLine" id="cb5-88" title="88">      <span class="cf">if</span>(i <span class="op">&gt;</span><span class="st"> </span>1L){</a>
<a class="sourceLine" id="cb5-89" title="89">        out[[<span class="dv">2</span><span class="op">*</span>nv<span class="op">+</span><span class="dv">2</span><span class="op">*</span>nu<span class="op">+</span>i<span class="dv">-3</span>]] &lt;-<span class="st"> </span><span class="kw">cbind</span>(M[,1L], <span class="op">-</span>M[,2L], M[,3L])</a>
<a class="sourceLine" id="cb5-90" title="90">      }</a>
<a class="sourceLine" id="cb5-91" title="91">    }</a>
<a class="sourceLine" id="cb5-92" title="92">  }</a>
<a class="sourceLine" id="cb5-93" title="93">  <span class="cf">if</span>(exchange){</a>
<a class="sourceLine" id="cb5-94" title="94">    out &lt;-<span class="st"> </span><span class="kw">lapply</span>(out, <span class="cf">function</span>(M){</a>
<a class="sourceLine" id="cb5-95" title="95">      M[, <span class="kw">c</span>(2L,1L,3L)]</a>
<a class="sourceLine" id="cb5-96" title="96">    })</a>
<a class="sourceLine" id="cb5-97" title="97">  }</a>
<a class="sourceLine" id="cb5-98" title="98">  out</a>
<a class="sourceLine" id="cb5-99" title="99">}</a></code></pre></div>
<p>Here is an example:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1">sgntr =<span class="st"> &quot;++-&quot;</span></a>
<a class="sourceLine" id="cb6-2" title="2">a =<span class="st"> </span><span class="dv">4</span>; b =<span class="st"> </span><span class="dv">6</span>; c =<span class="st"> </span><span class="dv">5</span></a>
<a class="sourceLine" id="cb6-3" title="3">mesh &lt;-<span class="st"> </span><span class="kw">hyperboloidMesh</span>(a, b, c, sgntr, <span class="dt">nu =</span> <span class="dv">100</span>, <span class="dt">nv =</span> <span class="dv">100</span>, <span class="dt">vmin =</span> <span class="dv">-150</span>)</a>
<a class="sourceLine" id="cb6-4" title="4">clines &lt;-<span class="st"> </span><span class="kw">curvatureLinesH1</span>(a, b, c, sgntr, <span class="dt">nu =</span> <span class="dv">5</span>, <span class="dt">nv =</span> <span class="dv">5</span>, <span class="dt">vmin =</span> <span class="dv">-150</span>)</a>
<a class="sourceLine" id="cb6-5" title="5"><span class="kw">shade3d</span>(mesh, <span class="dt">color =</span> <span class="st">&quot;chartreuse4&quot;</span>, <span class="dt">back =</span> <span class="st">&quot;culled&quot;</span>) </a>
<a class="sourceLine" id="cb6-6" title="6"><span class="kw">shade3d</span>(mesh, <span class="dt">color =</span> <span class="st">&quot;yellow&quot;</span>, <span class="dt">front =</span> <span class="st">&quot;culled&quot;</span>) </a>
<a class="sourceLine" id="cb6-7" title="7"><span class="kw">invisible</span>(<span class="kw">lapply</span>(clines, <span class="cf">function</span>(l){</a>
<a class="sourceLine" id="cb6-8" title="8">  <span class="kw">shade3d</span>(<span class="kw">cylinder3d</span>(l, <span class="dt">radius =</span> <span class="fl">0.1</span>, <span class="dt">sides =</span> <span class="dv">30</span>))</a>
<a class="sourceLine" id="cb6-9" title="9">}))</a></code></pre></div>
<p><img src="https://laustep.github.io/stlahblog/posts/figures/quadrics_H1.png" /></p>
<h1 id="two-sheeted-hyperboloid">Two-sheeted hyperboloid</h1>
<p>There are three types of two-sheeted hyperboloids, corresponding to these equations: <span class="math display">\[
\frac{x^2}{a^2} - \frac{y^2}{b^2} - \frac{z^2}{c^2} = 1 \\
-\frac{x^2}{a^2} - \frac{y^2}{b^2} + \frac{z^2}{c^2} = 1 \\
-\frac{x^2}{a^2} + \frac{y^2}{b^2} - \frac{z^2}{c^2} = 1.
\]</span> The <code>twoSheetsHyperboloidMesh</code> function below generates a mesh of the two-sheeted hyperboloid; the <code>signature</code> argument corresponds to one of the above equations, it must be <code>"+--"</code>, <code>"--+"</code> or <code>"-+-"</code>. The mesh is made of quadrilaterals and their number is controlled by the arguments <code>nu</code> and <code>nv</code>. The two-sheeted hyperboloid is infinite and the argument <code>vmin</code> is here to control its truncation.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" title="1">twoSheetsHyperboloidMesh &lt;-<span class="st"> </span><span class="cf">function</span>(a, b, c, signature, nu, nv, vmin){</a>
<a class="sourceLine" id="cb7-2" title="2">  <span class="kw">stopifnot</span>(signature <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;+--&quot;</span>, <span class="st">&quot;--+&quot;</span>, <span class="st">&quot;-+-&quot;</span>))</a>
<a class="sourceLine" id="cb7-3" title="3">  <span class="kw">stopifnot</span>(vmin <span class="op">&lt;</span><span class="st"> </span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb7-4" title="4">  <span class="cf">if</span>(signature <span class="op">==</span><span class="st"> &quot;--+&quot;</span>){</a>
<a class="sourceLine" id="cb7-5" title="5">    mesh &lt;-<span class="st"> </span><span class="kw">twoSheetsHyperboloidMesh</span>(c, b, a, <span class="st">&quot;+--&quot;</span>, nu, nv, vmin)</a>
<a class="sourceLine" id="cb7-6" title="6">    mesh<span class="op">$</span>vb &lt;-<span class="st"> </span>mesh<span class="op">$</span>vb[<span class="kw">c</span>(3L,2L,1L,4L),]</a>
<a class="sourceLine" id="cb7-7" title="7">    mesh<span class="op">$</span>normals &lt;-<span class="st"> </span>mesh<span class="op">$</span>normals[<span class="kw">c</span>(3L,2L,1L),]</a>
<a class="sourceLine" id="cb7-8" title="8">    mesh<span class="op">$</span>ib &lt;-<span class="st"> </span>mesh<span class="op">$</span>ib[4L<span class="op">:</span>1L,]</a>
<a class="sourceLine" id="cb7-9" title="9">    <span class="kw">return</span>(mesh)</a>
<a class="sourceLine" id="cb7-10" title="10">  }<span class="cf">else</span> <span class="cf">if</span>(signature <span class="op">==</span><span class="st"> &quot;-+-&quot;</span>){</a>
<a class="sourceLine" id="cb7-11" title="11">    mesh &lt;-<span class="st"> </span><span class="kw">twoSheetsHyperboloidMesh</span>(b, a, c, <span class="st">&quot;+--&quot;</span>, nu, nv, vmin)</a>
<a class="sourceLine" id="cb7-12" title="12">    mesh<span class="op">$</span>vb &lt;-<span class="st"> </span>mesh<span class="op">$</span>vb[<span class="kw">c</span>(2L,1L,3L,4L),]</a>
<a class="sourceLine" id="cb7-13" title="13">    mesh<span class="op">$</span>normals &lt;-<span class="st"> </span>mesh<span class="op">$</span>normals[<span class="kw">c</span>(2L,1L,3L),]</a>
<a class="sourceLine" id="cb7-14" title="14">    mesh<span class="op">$</span>ib &lt;-<span class="st"> </span>mesh<span class="op">$</span>ib[4L<span class="op">:</span>1L,]</a>
<a class="sourceLine" id="cb7-15" title="15">    <span class="kw">return</span>(mesh)</a>
<a class="sourceLine" id="cb7-16" title="16">  }</a>
<a class="sourceLine" id="cb7-17" title="17">  a0 &lt;-<span class="st"> </span>a</a>
<a class="sourceLine" id="cb7-18" title="18">  <span class="cf">if</span>(b <span class="op">&gt;</span><span class="st"> </span>c){</a>
<a class="sourceLine" id="cb7-19" title="19">    exchange &lt;-<span class="st"> </span><span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb7-20" title="20">    b0 &lt;-<span class="st"> </span>c; c0 &lt;-<span class="st"> </span>b</a>
<a class="sourceLine" id="cb7-21" title="21">  }<span class="cf">else</span>{</a>
<a class="sourceLine" id="cb7-22" title="22">    exchange &lt;-<span class="st"> </span><span class="ot">FALSE</span></a>
<a class="sourceLine" id="cb7-23" title="23">    b0 &lt;-<span class="st"> </span>b; c0 &lt;-<span class="st"> </span>c</a>
<a class="sourceLine" id="cb7-24" title="24">  }</a>
<a class="sourceLine" id="cb7-25" title="25">  Nu2 &lt;-<span class="st"> </span>a0<span class="op">^</span><span class="dv">2</span></a>
<a class="sourceLine" id="cb7-26" title="26">  h2ab &lt;-<span class="st"> </span>b0<span class="op">^</span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span>Nu2; h2ac &lt;-<span class="st"> </span>c0<span class="op">^</span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span>Nu2</a>
<a class="sourceLine" id="cb7-27" title="27">  c2 &lt;-<span class="st"> </span><span class="dv">1</span>; a2 &lt;-<span class="st"> </span>c2 <span class="op">+</span><span class="st"> </span>h2ac; b2 &lt;-<span class="st"> </span>a2 <span class="op">-</span><span class="st"> </span>h2ab</a>
<a class="sourceLine" id="cb7-28" title="28">  h2bc &lt;-<span class="st"> </span>b2 <span class="op">-</span><span class="st"> </span>c2</a>
<a class="sourceLine" id="cb7-29" title="29">  <span class="co">#</span></a>
<a class="sourceLine" id="cb7-30" title="30">  vertices &lt;-<span class="st"> </span>Normals &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="ot">NA_real_</span>, <span class="dt">nrow =</span> 3L, <span class="dt">ncol =</span> nu<span class="op">*</span>nv)</a>
<a class="sourceLine" id="cb7-31" title="31">  indices &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="ot">NA_integer_</span>, <span class="dt">nrow =</span> 4L, <span class="dt">ncol =</span> (nu<span class="dv">-1</span>)<span class="op">*</span>(nv<span class="dv">-1</span>))</a>
<a class="sourceLine" id="cb7-32" title="32">  v_ &lt;-<span class="st"> </span><span class="kw">seq</span>(vmin, c2, <span class="dt">length.out =</span> nv)</a>
<a class="sourceLine" id="cb7-33" title="33">  <span class="co">#</span></a>
<a class="sourceLine" id="cb7-34" title="34">  <span class="cf">if</span>(b0 <span class="op">!=</span><span class="st"> </span>c0){</a>
<a class="sourceLine" id="cb7-35" title="35">    u_ &lt;-<span class="st"> </span><span class="kw">seq</span>(c2, b2, <span class="dt">length.out =</span> nu)</a>
<a class="sourceLine" id="cb7-36" title="36">    x &lt;-<span class="st"> </span>a0 <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(h2ac<span class="op">*</span>h2ab) <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>(a2<span class="op">-</span>u_)</a>
<a class="sourceLine" id="cb7-37" title="37">    y &lt;-<span class="st"> </span>b0 <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(h2bc<span class="op">*</span>h2ab) <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>(b2<span class="op">-</span>u_)</a>
<a class="sourceLine" id="cb7-38" title="38">    z &lt;-<span class="st"> </span>c0 <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(h2bc<span class="op">*</span>h2ac) <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>(u_<span class="op">-</span>c2)</a>
<a class="sourceLine" id="cb7-39" title="39">  }<span class="cf">else</span>{</a>
<a class="sourceLine" id="cb7-40" title="40">    u_ &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">2</span><span class="op">*</span>pi, <span class="dt">length.out =</span> nu<span class="op">+</span><span class="dv">1</span>)[<span class="op">-</span>1L]</a>
<a class="sourceLine" id="cb7-41" title="41">    x &lt;-<span class="st"> </span><span class="kw">rep</span>(a0<span class="op">/</span><span class="kw">sqrt</span>(h2ac), nu)</a>
<a class="sourceLine" id="cb7-42" title="42">    myz &lt;-<span class="st"> </span>b0 <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(h2ab)</a>
<a class="sourceLine" id="cb7-43" title="43">    y &lt;-<span class="st"> </span>myz <span class="op">*</span><span class="st"> </span><span class="kw">cos</span>(u_)</a>
<a class="sourceLine" id="cb7-44" title="44">    z &lt;-<span class="st"> </span>myz <span class="op">*</span><span class="st"> </span><span class="kw">sin</span>(u_)</a>
<a class="sourceLine" id="cb7-45" title="45">  }</a>
<a class="sourceLine" id="cb7-46" title="46">  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>nu){</a>
<a class="sourceLine" id="cb7-47" title="47">    <span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>nv){</a>
<a class="sourceLine" id="cb7-48" title="48">      P &lt;-<span class="st"> </span>vertices[, (i<span class="dv">-1</span>)<span class="op">*</span>nv<span class="op">+</span>j] &lt;-<span class="st"> </span><span class="kw">c</span>(</a>
<a class="sourceLine" id="cb7-49" title="49">        x[i] <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>(a2<span class="op">-</span>v_[j]),</a>
<a class="sourceLine" id="cb7-50" title="50">        y[i] <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>(b2<span class="op">-</span>v_[j]),</a>
<a class="sourceLine" id="cb7-51" title="51">        z[i] <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>(c2<span class="op">-</span>v_[j])</a>
<a class="sourceLine" id="cb7-52" title="52">      )</a>
<a class="sourceLine" id="cb7-53" title="53">      Normals[, (i<span class="dv">-1</span>)<span class="op">*</span>nv<span class="op">+</span>j] &lt;-<span class="st"> </span><span class="kw">c</span>(P[1L]<span class="op">/</span>a0<span class="op">^</span><span class="dv">2</span>, <span class="op">-</span>P[2L]<span class="op">/</span>b0<span class="op">^</span><span class="dv">2</span>, <span class="op">-</span>P[3L]<span class="op">/</span>c0<span class="op">^</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb7-54" title="54">    }</a>
<a class="sourceLine" id="cb7-55" title="55">  }</a>
<a class="sourceLine" id="cb7-56" title="56">  <span class="co"># quads</span></a>
<a class="sourceLine" id="cb7-57" title="57">  <span class="cf">for</span>(i <span class="cf">in</span> 1L<span class="op">:</span>(nu<span class="dv">-1</span>)){</a>
<a class="sourceLine" id="cb7-58" title="58">    im1 &lt;-<span class="st"> </span>i<span class="op">-</span>1L</a>
<a class="sourceLine" id="cb7-59" title="59">    <span class="cf">for</span>(j <span class="cf">in</span> 1L<span class="op">:</span>(nv<span class="dv">-1</span>)){</a>
<a class="sourceLine" id="cb7-60" title="60">      jp1 &lt;-<span class="st"> </span>j<span class="op">+</span>1L</a>
<a class="sourceLine" id="cb7-61" title="61">      quad &lt;-<span class="st"> </span><span class="kw">c</span>(im1<span class="op">*</span>nv<span class="op">+</span>j, im1<span class="op">*</span>nv<span class="op">+</span>jp1, i<span class="op">*</span>nv<span class="op">+</span>jp1, i<span class="op">*</span>nv<span class="op">+</span>j)</a>
<a class="sourceLine" id="cb7-62" title="62">      indices[, im1<span class="op">*</span>(nv<span class="dv">-1</span>)<span class="op">+</span>j] &lt;-<span class="st"> </span><span class="cf">if</span>(exchange) <span class="kw">rev</span>(quad) <span class="cf">else</span> quad</a>
<a class="sourceLine" id="cb7-63" title="63">    }</a>
<a class="sourceLine" id="cb7-64" title="64">  }</a>
<a class="sourceLine" id="cb7-65" title="65">  vertices &lt;-<span class="st"> </span><span class="kw">cbind</span>(vertices, <span class="kw">c</span>(<span class="op">-</span><span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>) <span class="op">*</span><span class="st"> </span>vertices)</a>
<a class="sourceLine" id="cb7-66" title="66">  indices &lt;-<span class="st"> </span><span class="kw">cbind</span>(indices, indices[4L<span class="op">:</span>1L,] <span class="op">+</span><span class="st"> </span>nu<span class="op">*</span>nv)</a>
<a class="sourceLine" id="cb7-67" title="67">  Normals &lt;-<span class="st"> </span><span class="kw">cbind</span>(Normals, <span class="kw">c</span>(<span class="op">-</span><span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>) <span class="op">*</span><span class="st"> </span>Normals)</a>
<a class="sourceLine" id="cb7-68" title="68">  vertices &lt;-<span class="st"> </span><span class="kw">cbind</span>(vertices, <span class="kw">c</span>(<span class="dv">1</span>,<span class="op">-</span><span class="dv">1</span>,<span class="dv">1</span>) <span class="op">*</span><span class="st"> </span>vertices)</a>
<a class="sourceLine" id="cb7-69" title="69">  indices &lt;-<span class="st"> </span><span class="kw">cbind</span>(indices, indices[4L<span class="op">:</span>1L,] <span class="op">+</span><span class="st"> </span><span class="dv">2</span><span class="op">*</span>nu<span class="op">*</span>nv)</a>
<a class="sourceLine" id="cb7-70" title="70">  Normals &lt;-<span class="st"> </span><span class="kw">cbind</span>(Normals, <span class="kw">c</span>(<span class="dv">1</span>,<span class="op">-</span><span class="dv">1</span>,<span class="dv">1</span>) <span class="op">*</span><span class="st"> </span>Normals)</a>
<a class="sourceLine" id="cb7-71" title="71">  vertices &lt;-<span class="st"> </span><span class="kw">cbind</span>(vertices, <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="op">-</span><span class="dv">1</span>) <span class="op">*</span><span class="st"> </span>vertices)</a>
<a class="sourceLine" id="cb7-72" title="72">  indices &lt;-<span class="st"> </span><span class="kw">cbind</span>(indices, indices[4L<span class="op">:</span>1L,] <span class="op">+</span><span class="st"> </span><span class="dv">4</span><span class="op">*</span>nu<span class="op">*</span>nv)</a>
<a class="sourceLine" id="cb7-73" title="73">  Normals &lt;-<span class="st"> </span><span class="kw">cbind</span>(Normals, <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="op">-</span><span class="dv">1</span>) <span class="op">*</span><span class="st"> </span>Normals)</a>
<a class="sourceLine" id="cb7-74" title="74">  mesh &lt;-<span class="st"> </span><span class="kw">qmesh3d</span>(</a>
<a class="sourceLine" id="cb7-75" title="75">    <span class="dt">vertices =</span> <span class="cf">if</span>(exchange) vertices[<span class="kw">c</span>(1L,3L,2L),] <span class="cf">else</span> vertices,</a>
<a class="sourceLine" id="cb7-76" title="76">    <span class="dt">indices =</span> indices,</a>
<a class="sourceLine" id="cb7-77" title="77">    <span class="dt">homogeneous =</span> <span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb7-78" title="78">    <span class="dt">normals =</span> <span class="op">-</span><span class="kw">t</span>(<span class="cf">if</span>(exchange) Normals[<span class="kw">c</span>(1L,3L,2L),] <span class="cf">else</span> Normals)</a>
<a class="sourceLine" id="cb7-79" title="79">  )</a>
<a class="sourceLine" id="cb7-80" title="80">  mesh</a>
<a class="sourceLine" id="cb7-81" title="81">}</a></code></pre></div>
<p>The <code>curvatureLinesH2</code> function below generates some curvature lines of the two-sheeted hyperboloid. The role of the arguments <code>du</code> and <code>dv</code> is similar to the role of the arguments <code>du</code> and <code>dv</code> in <code>curvatureLinesE</code>.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" title="1">curvatureLinesH2 &lt;-<span class="st"> </span><span class="cf">function</span>(a, b, c, signature, nu, nv, vmin, du, dv, </a>
<a class="sourceLine" id="cb8-2" title="2">                             <span class="dt">npoints =</span> <span class="dv">100</span>){</a>
<a class="sourceLine" id="cb8-3" title="3">  <span class="kw">stopifnot</span>(signature <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;+--&quot;</span>, <span class="st">&quot;--+&quot;</span>, <span class="st">&quot;-+-&quot;</span>))</a>
<a class="sourceLine" id="cb8-4" title="4">  <span class="kw">stopifnot</span>(du <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>, dv <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>, vmin <span class="op">&lt;</span><span class="st"> </span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb8-5" title="5">  <span class="cf">if</span>(signature <span class="op">==</span><span class="st"> &quot;--+&quot;</span>){</a>
<a class="sourceLine" id="cb8-6" title="6">    clines &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb8-7" title="7"><span class="st">      </span><span class="kw">curvatureLinesH2</span>(c, b, a, <span class="st">&quot;+--&quot;</span>, nu, nv, vmin, du, dv, npoints)</a>
<a class="sourceLine" id="cb8-8" title="8">    <span class="kw">return</span>(<span class="kw">lapply</span>(clines, <span class="cf">function</span>(l) l[, <span class="kw">c</span>(3L,2L,1L)]))</a>
<a class="sourceLine" id="cb8-9" title="9">  }<span class="cf">else</span> <span class="cf">if</span>(signature <span class="op">==</span><span class="st"> &quot;-+-&quot;</span>){</a>
<a class="sourceLine" id="cb8-10" title="10">    clines &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb8-11" title="11"><span class="st">      </span><span class="kw">curvatureLinesH2</span>(b, a, c, <span class="st">&quot;+--&quot;</span>, nu, nv, vmin, du, dv, npoints)</a>
<a class="sourceLine" id="cb8-12" title="12">    <span class="kw">return</span>(<span class="kw">lapply</span>(clines, <span class="cf">function</span>(l) l[, <span class="kw">c</span>(2L,1L,3L)]))</a>
<a class="sourceLine" id="cb8-13" title="13">  }</a>
<a class="sourceLine" id="cb8-14" title="14">  a0 &lt;-<span class="st"> </span>a</a>
<a class="sourceLine" id="cb8-15" title="15">  <span class="cf">if</span>(b <span class="op">&gt;</span><span class="st"> </span>c){</a>
<a class="sourceLine" id="cb8-16" title="16">    exchange &lt;-<span class="st"> </span><span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb8-17" title="17">    b0 &lt;-<span class="st"> </span>c; c0 &lt;-<span class="st"> </span>b</a>
<a class="sourceLine" id="cb8-18" title="18">  }<span class="cf">else</span>{</a>
<a class="sourceLine" id="cb8-19" title="19">    exchange &lt;-<span class="st"> </span><span class="ot">FALSE</span></a>
<a class="sourceLine" id="cb8-20" title="20">    b0 &lt;-<span class="st"> </span>b; c0 &lt;-<span class="st"> </span>c</a>
<a class="sourceLine" id="cb8-21" title="21">  }</a>
<a class="sourceLine" id="cb8-22" title="22">  Nu2 &lt;-<span class="st"> </span>a0<span class="op">^</span><span class="dv">2</span></a>
<a class="sourceLine" id="cb8-23" title="23">  h2ab &lt;-<span class="st"> </span>b0<span class="op">^</span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span>Nu2; h2ac &lt;-<span class="st"> </span>c0<span class="op">^</span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span>Nu2</a>
<a class="sourceLine" id="cb8-24" title="24">  c2 &lt;-<span class="st"> </span><span class="dv">1</span>; a2 &lt;-<span class="st"> </span>c2 <span class="op">+</span><span class="st"> </span>h2ac; b2 &lt;-<span class="st"> </span>a2 <span class="op">-</span><span class="st"> </span>h2ab</a>
<a class="sourceLine" id="cb8-25" title="25">  h2bc &lt;-<span class="st"> </span>b2 <span class="op">-</span><span class="st"> </span>c2</a>
<a class="sourceLine" id="cb8-26" title="26">  <span class="co">#</span></a>
<a class="sourceLine" id="cb8-27" title="27">  <span class="cf">if</span>(b0 <span class="op">!=</span><span class="st"> </span>c0 <span class="op">&amp;&amp;</span><span class="st"> </span>c2<span class="op">+</span>du <span class="op">&gt;=</span><span class="st"> </span>b2){</a>
<a class="sourceLine" id="cb8-28" title="28">    <span class="kw">stop</span>(<span class="st">&quot;`du` is too large.&quot;</span>)</a>
<a class="sourceLine" id="cb8-29" title="29">  }</a>
<a class="sourceLine" id="cb8-30" title="30">  <span class="cf">if</span>(vmin <span class="op">&gt;=</span><span class="st"> </span>c2<span class="op">-</span>dv){</a>
<a class="sourceLine" id="cb8-31" title="31">    <span class="kw">stop</span>(<span class="st">&quot;`dv` is too large&quot;</span>)</a>
<a class="sourceLine" id="cb8-32" title="32">  }</a>
<a class="sourceLine" id="cb8-33" title="33">  v_ &lt;-<span class="st"> </span><span class="kw">seq</span>(vmin, c2<span class="op">-</span>dv, <span class="dt">length.out =</span> nv)</a>
<a class="sourceLine" id="cb8-34" title="34">  t_ &lt;-<span class="st"> </span><span class="kw">seq</span>(vmin, c2, <span class="dt">length.out =</span> npoints)</a>
<a class="sourceLine" id="cb8-35" title="35">  out &lt;-<span class="st"> </span><span class="kw">vector</span>(<span class="st">&quot;list&quot;</span>, <span class="dv">2</span><span class="op">*</span>nv <span class="op">+</span><span class="st"> </span><span class="dv">4</span><span class="op">*</span>nu <span class="op">-</span><span class="st"> </span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb8-36" title="36">  <span class="co">#</span></a>
<a class="sourceLine" id="cb8-37" title="37">  <span class="cf">if</span>(b0 <span class="op">!=</span><span class="st"> </span>c0){</a>
<a class="sourceLine" id="cb8-38" title="38">    u_ &lt;-<span class="st"> </span><span class="kw">seq</span>(c2<span class="op">+</span>du, b2, <span class="dt">length.out =</span> nu)</a>
<a class="sourceLine" id="cb8-39" title="39">    s_ &lt;-<span class="st"> </span><span class="kw">seq</span>(c2, b2, <span class="dt">length.out =</span> npoints)</a>
<a class="sourceLine" id="cb8-40" title="40">    mx &lt;-<span class="st"> </span>a0 <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(h2ac<span class="op">*</span>h2ab)</a>
<a class="sourceLine" id="cb8-41" title="41">    my &lt;-<span class="st"> </span>b0 <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(h2bc<span class="op">*</span>h2ab)</a>
<a class="sourceLine" id="cb8-42" title="42">    mz &lt;-<span class="st"> </span>c0 <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(h2bc<span class="op">*</span>h2ac)</a>
<a class="sourceLine" id="cb8-43" title="43">    <span class="cf">for</span>(j <span class="cf">in</span> 1L<span class="op">:</span>nv){</a>
<a class="sourceLine" id="cb8-44" title="44">      x &lt;-<span class="st"> </span>mx <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>((a2<span class="op">-</span>s_)<span class="op">*</span>(a2<span class="op">-</span>v_[j]))</a>
<a class="sourceLine" id="cb8-45" title="45">      y &lt;-<span class="st"> </span>my <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>((b2<span class="op">-</span>s_)<span class="op">*</span>(b2<span class="op">-</span>v_[j]))</a>
<a class="sourceLine" id="cb8-46" title="46">      z &lt;-<span class="st"> </span>mz <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>((s_<span class="op">-</span>c2)<span class="op">*</span>(c2<span class="op">-</span>v_[j]))</a>
<a class="sourceLine" id="cb8-47" title="47">      M1 &lt;-<span class="st"> </span><span class="kw">rbind</span>(<span class="kw">cbind</span>(x, y, z), <span class="kw">cbind</span>(x, <span class="op">-</span>y, z)[(npoints<span class="dv">-1</span>)<span class="op">:</span>1L,])</a>
<a class="sourceLine" id="cb8-48" title="48">      M2 &lt;-<span class="st"> </span><span class="kw">cbind</span>(M1[,<span class="kw">c</span>(1L,2L)], <span class="op">-</span>M1[,3L])</a>
<a class="sourceLine" id="cb8-49" title="49">      M &lt;-<span class="st"> </span><span class="kw">rbind</span>(M1, M2[(<span class="dv">2</span><span class="op">*</span>npoints<span class="dv">-2</span>)<span class="op">:</span>1L,])</a>
<a class="sourceLine" id="cb8-50" title="50">      out[[j]] &lt;-<span class="st"> </span><span class="cf">if</span>(exchange) M[,<span class="kw">c</span>(1L,3L,2L)] <span class="cf">else</span> M</a>
<a class="sourceLine" id="cb8-51" title="51">      out[[nv<span class="op">+</span>j]] &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb8-52" title="52"><span class="st">        </span><span class="kw">cbind</span>(<span class="op">-</span>M[,1L], <span class="cf">if</span>(exchange) M[,<span class="kw">c</span>(3L,2L)] <span class="cf">else</span> M[,<span class="kw">c</span>(2L,3L)])</a>
<a class="sourceLine" id="cb8-53" title="53">    }</a>
<a class="sourceLine" id="cb8-54" title="54">    <span class="cf">for</span>(i <span class="cf">in</span> 1L<span class="op">:</span>nu){</a>
<a class="sourceLine" id="cb8-55" title="55">      x &lt;-<span class="st"> </span>mx <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>((a2<span class="op">-</span>u_[i])<span class="op">*</span>(a2<span class="op">-</span>t_))</a>
<a class="sourceLine" id="cb8-56" title="56">      y &lt;-<span class="st"> </span>my <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>((b2<span class="op">-</span>u_[i])<span class="op">*</span>(b2<span class="op">-</span>t_))</a>
<a class="sourceLine" id="cb8-57" title="57">      z &lt;-<span class="st"> </span>mz <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>((u_[i]<span class="op">-</span>c2)<span class="op">*</span>(c2<span class="op">-</span>t_))</a>
<a class="sourceLine" id="cb8-58" title="58">      M &lt;-<span class="st"> </span><span class="kw">rbind</span>(<span class="kw">cbind</span>(x, y, z), <span class="kw">cbind</span>(x, y, <span class="op">-</span>z)[(npoints<span class="dv">-1</span>)<span class="op">:</span>1L,])</a>
<a class="sourceLine" id="cb8-59" title="59">      out[[<span class="dv">2</span><span class="op">*</span>nv<span class="op">+</span>i]] &lt;-<span class="st"> </span><span class="cf">if</span>(exchange) M[,<span class="kw">c</span>(1L,3L,2L)] <span class="cf">else</span> M</a>
<a class="sourceLine" id="cb8-60" title="60">      <span class="cf">if</span>(i <span class="op">&lt;</span><span class="st"> </span>nu){</a>
<a class="sourceLine" id="cb8-61" title="61">        out[[<span class="dv">2</span><span class="op">*</span>nv<span class="op">+</span>nu<span class="op">+</span>i]] &lt;-<span class="st"> </span><span class="cf">if</span>(exchange) </a>
<a class="sourceLine" id="cb8-62" title="62">          <span class="kw">cbind</span>(M[,<span class="kw">c</span>(1L,3L)], <span class="op">-</span>M[,2L]) </a>
<a class="sourceLine" id="cb8-63" title="63">        <span class="cf">else</span> </a>
<a class="sourceLine" id="cb8-64" title="64">          <span class="kw">cbind</span>(M[,1L], <span class="op">-</span>M[,2L], M[,3L])</a>
<a class="sourceLine" id="cb8-65" title="65">      }</a>
<a class="sourceLine" id="cb8-66" title="66">    }</a>
<a class="sourceLine" id="cb8-67" title="67">  }<span class="cf">else</span>{ <span class="co"># b0 = c0</span></a>
<a class="sourceLine" id="cb8-68" title="68">    u_ &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">2</span><span class="op">*</span>pi, <span class="dt">length.out =</span> nu<span class="op">+</span><span class="dv">1</span>)[<span class="op">-</span>1L] </a>
<a class="sourceLine" id="cb8-69" title="69">    s_ &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">2</span><span class="op">*</span>pi, <span class="dt">length.out =</span> npoints)</a>
<a class="sourceLine" id="cb8-70" title="70">    mx &lt;-<span class="st"> </span>a0 <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(h2ac)</a>
<a class="sourceLine" id="cb8-71" title="71">    myz &lt;-<span class="st"> </span>b0 <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(h2ab)</a>
<a class="sourceLine" id="cb8-72" title="72">    <span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>nv){</a>
<a class="sourceLine" id="cb8-73" title="73">      x &lt;-<span class="st"> </span>mx <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>(a2<span class="op">-</span>v_[j])</a>
<a class="sourceLine" id="cb8-74" title="74">      y &lt;-<span class="st"> </span>myz <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>(b2<span class="op">-</span>v_[j]) <span class="op">*</span><span class="st"> </span><span class="kw">cos</span>(s_)</a>
<a class="sourceLine" id="cb8-75" title="75">      z &lt;-<span class="st"> </span>myz <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>(c2<span class="op">-</span>v_[j]) <span class="op">*</span><span class="st"> </span><span class="kw">sin</span>(s_)</a>
<a class="sourceLine" id="cb8-76" title="76">      M &lt;-<span class="st"> </span><span class="kw">cbind</span>(x, y, z)</a>
<a class="sourceLine" id="cb8-77" title="77">      out[[j]] &lt;-<span class="st"> </span><span class="cf">if</span>(exchange) M[,<span class="kw">c</span>(1L,3L,2L)] <span class="cf">else</span> M</a>
<a class="sourceLine" id="cb8-78" title="78">      out[[nv<span class="op">+</span>j]] &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb8-79" title="79"><span class="st">        </span><span class="kw">cbind</span>(<span class="op">-</span>M[,1L], <span class="cf">if</span>(exchange) M[,<span class="kw">c</span>(3L,2L)] <span class="cf">else</span> M[,<span class="kw">c</span>(2L,3L)])</a>
<a class="sourceLine" id="cb8-80" title="80">    }</a>
<a class="sourceLine" id="cb8-81" title="81">    <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>nu){</a>
<a class="sourceLine" id="cb8-82" title="82">      x &lt;-<span class="st"> </span>mx <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>(a2<span class="op">-</span>t_)</a>
<a class="sourceLine" id="cb8-83" title="83">      y &lt;-<span class="st"> </span>myz <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>(b2<span class="op">-</span>t_) <span class="op">*</span><span class="st"> </span><span class="kw">cos</span>(u_[i])</a>
<a class="sourceLine" id="cb8-84" title="84">      z &lt;-<span class="st"> </span>myz <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>(c2<span class="op">-</span>t_) <span class="op">*</span><span class="st"> </span><span class="kw">sin</span>(u_[i])</a>
<a class="sourceLine" id="cb8-85" title="85">      M &lt;-<span class="st"> </span><span class="kw">rbind</span>(<span class="kw">cbind</span>(x, y, z), <span class="kw">cbind</span>(x, <span class="op">-</span>y, <span class="op">-</span>z)[(npoints<span class="dv">-1</span>)<span class="op">:</span>1L,])</a>
<a class="sourceLine" id="cb8-86" title="86">      out[[<span class="dv">2</span><span class="op">*</span>nv<span class="op">+</span>i]] &lt;-<span class="st"> </span><span class="cf">if</span>(exchange) M[,<span class="kw">c</span>(1L,3L,2L)] <span class="cf">else</span> M</a>
<a class="sourceLine" id="cb8-87" title="87">      <span class="cf">if</span>(i <span class="op">&lt;</span><span class="st"> </span>nu){</a>
<a class="sourceLine" id="cb8-88" title="88">        out[[<span class="dv">2</span><span class="op">*</span>nv<span class="op">+</span>nu<span class="op">+</span>i]] &lt;-<span class="st"> </span><span class="cf">if</span>(exchange) </a>
<a class="sourceLine" id="cb8-89" title="89">          <span class="kw">cbind</span>(M[,<span class="kw">c</span>(1L,3L)], <span class="op">-</span>M[,2L]) </a>
<a class="sourceLine" id="cb8-90" title="90">        <span class="cf">else</span> </a>
<a class="sourceLine" id="cb8-91" title="91">          <span class="kw">cbind</span>(M[,1L], <span class="op">-</span>M[,2L], M[,3L])</a>
<a class="sourceLine" id="cb8-92" title="92">      }</a>
<a class="sourceLine" id="cb8-93" title="93">    }</a>
<a class="sourceLine" id="cb8-94" title="94">  }</a>
<a class="sourceLine" id="cb8-95" title="95">  <span class="co">#</span></a>
<a class="sourceLine" id="cb8-96" title="96">  out[(<span class="dv">2</span><span class="op">*</span>nv<span class="op">+</span><span class="dv">2</span><span class="op">*</span>nu)<span class="op">:</span>(<span class="dv">2</span><span class="op">*</span>nv<span class="op">+</span><span class="dv">4</span><span class="op">*</span>nu<span class="dv">-2</span>)] &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb8-97" title="97"><span class="st">    </span><span class="kw">lapply</span>(out[(<span class="dv">2</span><span class="op">*</span>nv<span class="op">+</span><span class="dv">1</span>)<span class="op">:</span>(<span class="dv">2</span><span class="op">*</span>nv<span class="op">+</span><span class="dv">2</span><span class="op">*</span>nu<span class="dv">-1</span>)], <span class="cf">function</span>(M){</a>
<a class="sourceLine" id="cb8-98" title="98">      <span class="kw">cbind</span>(<span class="op">-</span>M[,1L], M[,<span class="kw">c</span>(2L,3L)])</a>
<a class="sourceLine" id="cb8-99" title="99">    })</a>
<a class="sourceLine" id="cb8-100" title="100">  out</a>
<a class="sourceLine" id="cb8-101" title="101">}</a></code></pre></div>
<p>An example:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" title="1">a =<span class="st"> </span><span class="dv">6</span>; b =<span class="st"> </span><span class="dv">5</span>; c =<span class="st"> </span><span class="dv">3</span></a>
<a class="sourceLine" id="cb9-2" title="2">sgntr =<span class="st"> &quot;-+-&quot;</span></a>
<a class="sourceLine" id="cb9-3" title="3">mesh &lt;-<span class="st"> </span><span class="kw">twoSheetsHyperboloidMesh</span>(a, b, c, sgntr, <span class="dv">100</span>, <span class="dv">100</span>, <span class="dt">vmin =</span> <span class="dv">-500</span>)</a>
<a class="sourceLine" id="cb9-4" title="4">clines &lt;-<span class="st"> </span><span class="kw">curvatureLinesH2</span>(a, b, c, sgntr, <span class="dt">nu =</span> <span class="dv">5</span>, <span class="dt">nv =</span> <span class="dv">5</span>, <span class="dt">vmin =</span> <span class="dv">-500</span>, </a>
<a class="sourceLine" id="cb9-5" title="5">                           <span class="dt">du =</span> <span class="dv">1</span>, <span class="dt">dv =</span> <span class="dv">20</span>, <span class="dt">npoints =</span> <span class="dv">300</span>)</a>
<a class="sourceLine" id="cb9-6" title="6"><span class="kw">shade3d</span>(mesh, <span class="dt">color =</span> <span class="st">&quot;navyblue&quot;</span>, <span class="dt">back =</span> <span class="st">&quot;culled&quot;</span>) </a>
<a class="sourceLine" id="cb9-7" title="7"><span class="kw">shade3d</span>(mesh, <span class="dt">color =</span> <span class="st">&quot;goldenrod&quot;</span>, <span class="dt">front =</span> <span class="st">&quot;culled&quot;</span>)</a>
<a class="sourceLine" id="cb9-8" title="8"><span class="kw">invisible</span>(<span class="kw">lapply</span>(clines, <span class="cf">function</span>(l){</a>
<a class="sourceLine" id="cb9-9" title="9">  <span class="kw">shade3d</span>(<span class="kw">cylinder3d</span>(l, <span class="dt">radius =</span> <span class="fl">0.2</span>, <span class="dt">sides =</span> <span class="dv">30</span>))</a>
<a class="sourceLine" id="cb9-10" title="10">}))</a></code></pre></div>
<p><img src="https://laustep.github.io/stlahblog/posts/figures/quadrics_H2.png" /></p>
<h1 id="general-quadric">General quadric</h1>
<p>A general quadric in <span class="math inline">\(\mathbb{R}^3\)</span> has equation <span class="math display">\[
(x \quad y \quad z)\, A
\begin{pmatrix} x \\ y \\ z \end{pmatrix}
+ J&#39; \begin{pmatrix} x \\ y \\ z \end{pmatrix}
+ K = 0,
\]</span> where <span class="math inline">\(A\)</span> is a symmetric <span class="math inline">\((3\times 3)\)</span>-matrix, <span class="math inline">\(J \in \mathbb{R}^3\)</span>, and <span class="math inline">\(K \in \mathbb{R}\)</span>. Let’s treat an example. We follow the strategy given at page 45 of Brannan &amp; al’s book <em>Geometry</em> (<a href="http://math.haifa.ac.il/ROVENSKI/B2.pdf">pdf</a>).</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" title="1">A =<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">c</span>(</a>
<a class="sourceLine" id="cb10-2" title="2">   <span class="dv">5</span>, <span class="dv">-1</span>, <span class="dv">-1</span>, </a>
<a class="sourceLine" id="cb10-3" title="3">  <span class="dv">-1</span>,  <span class="dv">3</span>,  <span class="dv">1</span>,</a>
<a class="sourceLine" id="cb10-4" title="4">  <span class="dv">-1</span>,  <span class="dv">1</span>, <span class="dv">-3</span></a>
<a class="sourceLine" id="cb10-5" title="5">  ), <span class="dt">nrow =</span> 3L, <span class="dt">ncol =</span> 3L)</a>
<a class="sourceLine" id="cb10-6" title="6">J =<span class="st"> </span><span class="kw">c</span>(<span class="dv">4</span>, <span class="dv">6</span>, <span class="dv">8</span>)</a>
<a class="sourceLine" id="cb10-7" title="7">K =<span class="st"> </span><span class="dv">-10</span></a>
<a class="sourceLine" id="cb10-8" title="8"><span class="co"># computes spectral decomposition of A</span></a>
<a class="sourceLine" id="cb10-9" title="9">eig &lt;-<span class="st"> </span><span class="kw">eigen</span>(A)</a>
<a class="sourceLine" id="cb10-10" title="10">P &lt;-<span class="st"> </span>eig<span class="op">$</span>vectors</a>
<a class="sourceLine" id="cb10-11" title="11">( evalues &lt;-<span class="st"> </span>eig<span class="op">$</span>values )</a>
<a class="sourceLine" id="cb10-12" title="12"><span class="co">## [1]  5.614627  2.632676 -3.247303</span></a></code></pre></div>
<p>There is no eigenvalue equal to <span class="math inline">\(0\)</span>; this is the first necessary condition in order for the solution of the equation to be a focal quadric.</p>
<p>Now we write the equation in the form <span class="math display">\[
\lambda_1 {(x&#39;&#39;)}^2 + \lambda_2 {(y&#39;&#39;)}^2 + \lambda_3 {(z&#39;&#39;)}^2 =
\mathrm{rhs}
\]</span> where <span class="math inline">\(\lambda_1\)</span>, <span class="math inline">\(\lambda_2\)</span>, <span class="math inline">\(\lambda_3\)</span> are the eigenvalues of <span class="math inline">\(A\)</span>, and <span class="math inline">\((x&#39;&#39;,y&#39;&#39;,z&#39;&#39;)\)</span> is a new coordinate system.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" title="1">center &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">t</span>(J) <span class="op">%*%</span><span class="st"> </span>P) <span class="op">/</span><span class="st"> </span>evalues <span class="op">/</span><span class="st"> </span><span class="dv">2</span></a>
<a class="sourceLine" id="cb11-2" title="2">( rhs &lt;-<span class="st"> </span><span class="kw">sum</span>(evalues <span class="op">*</span><span class="st"> </span>center<span class="op">^</span><span class="dv">2</span>) <span class="op">-</span><span class="st"> </span>K )</a>
<a class="sourceLine" id="cb11-3" title="3"><span class="co">## [1] 11.5</span></a>
<a class="sourceLine" id="cb11-4" title="4">( sgntr &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="kw">ifelse</span>(rhs<span class="op">*</span>evalues <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>, <span class="st">&quot;+&quot;</span>, <span class="st">&quot;-&quot;</span>), <span class="dt">collapse =</span> <span class="st">&quot;&quot;</span>) )</a>
<a class="sourceLine" id="cb11-5" title="5"><span class="co">## [1] &quot;++-&quot;</span></a></code></pre></div>
<p>We find <span class="math inline">\(\mathrm{rhs} \neq 0\)</span>, so the solution of the equation is a focal quadric. If <span class="math inline">\(\mathrm{rhs} = 0\)</span>, the solution is a cone.</p>
<p>The signature is <span class="math inline">\(++-\)</span>, so the solution of the equation is a one-sheeted hyperboloid. By dividing both members of the previous equality by <span class="math inline">\(\mathrm{rhs}\)</span>, we get its equation in standard form.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" title="1">abc &lt;-<span class="st"> </span><span class="kw">sqrt</span>(<span class="kw">abs</span>(rhs<span class="op">/</span>evalues))</a>
<a class="sourceLine" id="cb12-2" title="2">a &lt;-<span class="st"> </span>abc[<span class="dv">1</span>]; b &lt;-<span class="st"> </span>abc[<span class="dv">2</span>]; c &lt;-<span class="st"> </span>abc[<span class="dv">3</span>]</a>
<a class="sourceLine" id="cb12-3" title="3">mesh0 &lt;-<span class="st"> </span><span class="kw">hyperboloidMesh</span>(a, b, c, sgntr, <span class="dv">100</span>, <span class="dv">100</span>, <span class="dv">-5</span>)</a>
<a class="sourceLine" id="cb12-4" title="4"><span class="co"># final quadric mesh:</span></a>
<a class="sourceLine" id="cb12-5" title="5">mesh &lt;-<span class="st"> </span><span class="kw">rotate3d</span>(</a>
<a class="sourceLine" id="cb12-6" title="6">  <span class="kw">translate3d</span>(mesh0, <span class="op">-</span>center[<span class="dv">1</span>], <span class="op">-</span>center[<span class="dv">2</span>], <span class="op">-</span>center[<span class="dv">3</span>]), </a>
<a class="sourceLine" id="cb12-7" title="7">  <span class="dt">matrix =</span> <span class="kw">t</span>(P)</a>
<a class="sourceLine" id="cb12-8" title="8">)</a></code></pre></div>
<p>We can check that the equation is fulfilled for some vertices of the final mesh:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" title="1"><span class="kw">apply</span>(mesh<span class="op">$</span>vb[<span class="op">-</span><span class="dv">4</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>], 2L, <span class="cf">function</span>(x){</a>
<a class="sourceLine" id="cb13-2" title="2">  <span class="kw">c</span>(<span class="kw">t</span>(x) <span class="op">%*%</span><span class="st"> </span>A <span class="op">%*%</span><span class="st"> </span>x <span class="op">+</span><span class="st"> </span><span class="kw">t</span>(J) <span class="op">%*%</span><span class="st"> </span>x) <span class="op">+</span><span class="st"> </span>K</a>
<a class="sourceLine" id="cb13-3" title="3">})</a>
<a class="sourceLine" id="cb13-4" title="4"><span class="co">## [1] 5.684342e-14 7.105427e-14 4.973799e-14 4.973799e-14 4.263256e-14</span></a></code></pre></div>
<p>Up to small numerical errors, we indeed get <span class="math inline">\(0\)</span> for each of the five vertices.</p>

        </div>


        <div id="footer">
          Site proudly generated by
          <a href="http://jaspervdj.be/hakyll">Hakyll</a>
        </div>

      </div>

    </div>

    <div class="row">
      <div class="col-sm-12">
        <div id="disqus_thread"></div>
        <div class="pagination">
          <ul>
            <li>
              <a href="http://laustep.github.io/stlahblog/">&#171; Back Home</a>
            </li>
          </ul>
        </div>
      </div>
    </div>

  </div>


<script src="https://laustep.github.io/stlahblog/libraries/bootstrap/bootstrap.min.js"></script>
<!-- MathJax: Fall back to local if CDN offline but local image fonts are not supported (saves >100MB) -->
<script type="text/x-mathjax-config" src="https://laustep.github.io/stlahblog/libraries/mathjax/config/TeX-MML-AM_CHTML.js"></script>
<!-- <script>
  window.MathJax || document.write('<script type="text/x-mathjax-config">MathJax.Hub.Config({"HTML-CSS":{imageFont:null}});<\/script><script src="https://laustep.github.io/stlahblog/libraries/mathjax/MathJax.js"><\/script>');
</script> -->



]]></description>
    <pubDate>Sun, 03 May 2020 00:00:00 UT</pubDate>
    <guid>https://laustep.github.io/stlahblog/posts/focalQuadrics.html</guid>
    <dc:creator>Stéphane Laurent</dc:creator>

        <category>R</category>

</item>
<item>
    <title>Drawing slices of a hypersurface with R</title>
    <link>https://laustep.github.io/stlahblog/posts/slicedHypersurface.html</link>
    <description><![CDATA[
    <link href="https://laustep.github.io/stlahblog/libraries/bootstrap/bootstrap-grid.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://laustep.github.io/stlahblog/css/default2.css" />
  <link rel="stylesheet" href="https://laustep.github.io/stlahblog/css/post.css" />
  <link rel="stylesheet" href="https://laustep.github.io/stlahblog/css/misc.css" />

    <link rel="stylesheet" href="https://laustep.github.io/stlahblog/css/pandoc-solarized.css" />


    <link href="https://laustep.github.io/stlahblog/libraries/highlighters/prettify/css/minimal.css" rel="stylesheet">

  <link href="https://fonts.googleapis.com/css?family=Raleway:400,600,200,800" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Droid+Sans" rel="stylesheet" type="text/css">
  <script src="https://laustep.github.io/stlahblog/libraries/jquery.min.js"></script>
  <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>

  <div class="container-fluid">
    <div class="row">
      <div class="main col-sm-12">
        <div id="header">
          <div id="logo" style="position:absolute;">
            <a href="https://laustep.github.io/stlahblog/">
              <img src="https://laustep.github.io/stlahblog/images/stla.jpg" alt="stla" width="100px" />
            </a>
          </div>
          <div id="navigation" style="margin-top:50px;">
            <a href="https://laustep.github.io/stlahblog/">Home</a>
            <a href="https://laustep.github.io/stlahblog/about.html">About</a>
            <a href="https://laustep.github.io/stlahblog/contact.html">Contact</a>
            <a href="https://laustep.github.io/stlahblog/archive.html">Archive</a>
          </div>
        </div>

        <div class="content">
          <h1>Drawing slices of a hypersurface with R</h1>
          <div class="info">
    Posted on May  1, 2020

        by Stéphane Laurent

</div>
<div class="info">

    Tags: <a href="https://laustep.github.io/stlahblog/tags/R.html">R</a>, <a href="https://laustep.github.io/stlahblog/tags/graphics.html">graphics</a>, <a href="https://laustep.github.io/stlahblog/tags/rgl.html">rgl</a>, <a href="https://laustep.github.io/stlahblog/tags/geometry.html">geometry</a>, <a href="https://laustep.github.io/stlahblog/tags/maths.html">maths</a>

</div>

<p>Let <span class="math inline">\(s \colon I \times J \times K \to \mathbb{R}^4\)</span> be a parameterization of a hypersurface <span class="math inline">\(\mathcal{S}\)</span>, where <span class="math inline">\(I,J,K \subset \mathbb{R}\)</span> are some intervals. I’m going to show how to draw the cross-section of <span class="math inline">\(\mathcal{S}\)</span> by a hyperplane with R.</p>
<p>For the illustration, we consider the <a href="http://hi.gher.space/wiki/Tiger"><em>tiger</em></a>:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1">R1 =<span class="st"> </span><span class="dv">2</span>; R2 =<span class="st"> </span><span class="dv">2</span>; r =<span class="st"> </span><span class="fl">0.5</span></a>
<a class="sourceLine" id="cb1-2" title="2">s &lt;-<span class="st"> </span><span class="cf">function</span>(u, v, w){</a>
<a class="sourceLine" id="cb1-3" title="3">  <span class="kw">rbind</span>(</a>
<a class="sourceLine" id="cb1-4" title="4">    <span class="kw">cos</span>(u) <span class="op">*</span><span class="st"> </span>(R1 <span class="op">+</span><span class="st"> </span>r<span class="op">*</span><span class="kw">cos</span>(w)),</a>
<a class="sourceLine" id="cb1-5" title="5">    <span class="kw">sin</span>(u) <span class="op">*</span><span class="st"> </span>(R1 <span class="op">+</span><span class="st"> </span>r<span class="op">*</span><span class="kw">cos</span>(w)),</a>
<a class="sourceLine" id="cb1-6" title="6">    <span class="kw">cos</span>(v) <span class="op">*</span><span class="st"> </span>(R2 <span class="op">+</span><span class="st"> </span>r<span class="op">*</span><span class="kw">sin</span>(w)),</a>
<a class="sourceLine" id="cb1-7" title="7">    <span class="kw">sin</span>(v) <span class="op">*</span><span class="st"> </span>(R2 <span class="op">+</span><span class="st"> </span>r<span class="op">*</span><span class="kw">sin</span>(w))</a>
<a class="sourceLine" id="cb1-8" title="8">  )</a>
<a class="sourceLine" id="cb1-9" title="9">}</a></code></pre></div>
<p>Take a hyperplane: <span class="math display">\[
\mathcal{P}\colon \quad \langle \mathbf{a}, \mathbf{x} \rangle = b,
\]</span> let <span class="math inline">\(\vec{\mathbf{n}} = \frac{\mathbf{a}}{\Vert\mathbf{a}\Vert}\)</span> be a unit normal vector of <span class="math inline">\(\mathcal{P}\)</span>, and <span class="math inline">\(\mathbf{x}_0\)</span> be an arbitrary point in <span class="math inline">\(\mathcal{P}\)</span>.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1">a =<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>); b =<span class="st"> </span><span class="dv">2</span>        <span class="co"># plane x+y+z+w = 2</span></a>
<a class="sourceLine" id="cb2-2" title="2">x0 =<span class="st"> </span><span class="kw">c</span>(b, b, b, b)<span class="op">/</span><span class="dv">4</span>            <span class="co"># a point in this plane</span></a>
<a class="sourceLine" id="cb2-3" title="3">nrml &lt;-<span class="st"> </span>a<span class="op">/</span><span class="kw">sqrt</span>(<span class="kw">c</span>(<span class="kw">crossprod</span>(a))) <span class="co"># unit normal</span></a></code></pre></div>
<p>Compute a mesh <span class="math inline">\(\mathcal{M}_0\)</span> of the isosurface <span class="math display">\[
\bigl(s(u,v,w) - \mathbf{x}_0\bigr) \cdot \vec{\mathbf{n}} = 0.
\]</span></p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1"><span class="kw">library</span>(misc3d)</a>
<a class="sourceLine" id="cb3-2" title="2">f &lt;-<span class="st"> </span><span class="cf">function</span>(u, v, w){</a>
<a class="sourceLine" id="cb3-3" title="3">  <span class="kw">c</span>(<span class="kw">crossprod</span>(<span class="kw">s</span>(u, v, w), nrml))</a>
<a class="sourceLine" id="cb3-4" title="4">}</a>
<a class="sourceLine" id="cb3-5" title="5">u_ &lt;-<span class="st"> </span>v_ &lt;-<span class="st"> </span>w_ &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">2</span><span class="op">*</span>pi, <span class="dt">length.out =</span> 100L)</a>
<a class="sourceLine" id="cb3-6" title="6">g &lt;-<span class="st"> </span><span class="kw">expand.grid</span>(<span class="dt">u =</span> u_, <span class="dt">v =</span> v_, <span class="dt">w =</span> w_)</a>
<a class="sourceLine" id="cb3-7" title="7">voxel &lt;-<span class="st"> </span><span class="kw">array</span>(<span class="kw">with</span>(g, <span class="kw">f</span>(u,v,w)), <span class="dt">dim =</span> <span class="kw">c</span>(100L,100L,100L))</a>
<a class="sourceLine" id="cb3-8" title="8">surf &lt;-<span class="st"> </span><span class="kw">computeContour3d</span>(voxel, <span class="dt">level =</span> <span class="kw">sum</span>(x0<span class="op">*</span>nrml), </a>
<a class="sourceLine" id="cb3-9" title="9">                         <span class="dt">x =</span> u_, <span class="dt">y =</span> v_, <span class="dt">z =</span> w_)</a>
<a class="sourceLine" id="cb3-10" title="10">trgls &lt;-<span class="st"> </span><span class="kw">makeTriangles</span>(surf)</a>
<a class="sourceLine" id="cb3-11" title="11">mesh0 &lt;-<span class="st"> </span>misc3d<span class="op">:::</span><span class="kw">t2ve</span>(trgls)</a></code></pre></div>
<p>Denote by <span class="math inline">\(\mathcal{V}\mathcal{S}_0 \subset I \times J \times K\)</span> the set of vertices of <span class="math inline">\(\mathcal{M}_0\)</span>, and set <span class="math inline">\(\mathcal{V}\mathcal{S} = s(\mathcal{V}\mathcal{S}_0) \subset \mathbb{R}^4\)</span>.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1">VS0 &lt;-<span class="st"> </span>mesh0<span class="op">$</span>vb</a>
<a class="sourceLine" id="cb4-2" title="2">VS &lt;-<span class="st"> </span><span class="kw">s</span>(VS0[1L,], VS0[2L,], VS0[3L,]) </a></code></pre></div>
<p>Let <span class="math inline">\(R\)</span> be a rotation in <span class="math inline">\(\mathbb{R}^4\)</span> which sends <span class="math inline">\(\vec{\mathbf{n}} =: \vec{\mathbf{v}}_1\)</span> to the vector <span class="math inline">\((0,0,0,1) =: \vec{\mathbf{v}}_2\)</span>. One can take <span class="math inline">\(R\)</span> corresponding to the matrix <span class="math display">\[
\frac{2}{{(\vec{\mathbf{v}}_1+\vec{\mathbf{v}}_2)}&#39;
(\vec{\mathbf{v}}_1+\vec{\mathbf{v}}_2)}
(\vec{\mathbf{v}}_1+\vec{\mathbf{v}}_2)
{(\vec{\mathbf{v}}_1+\vec{\mathbf{v}}_2)}&#39; - I_4.
\]</span></p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1">rotationMatrix4D &lt;-<span class="st"> </span><span class="cf">function</span>(v1, v2){</a>
<a class="sourceLine" id="cb5-2" title="2">  v1 &lt;-<span class="st"> </span>v1 <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(<span class="kw">c</span>(<span class="kw">crossprod</span>(v1)))</a>
<a class="sourceLine" id="cb5-3" title="3">  v2 &lt;-<span class="st"> </span>v2 <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(<span class="kw">c</span>(<span class="kw">crossprod</span>(v2)))</a>
<a class="sourceLine" id="cb5-4" title="4">  <span class="dv">2</span><span class="op">*</span><span class="kw">tcrossprod</span>(v1<span class="op">+</span>v2)<span class="op">/</span><span class="kw">c</span>(<span class="kw">crossprod</span>(v1<span class="op">+</span>v2)) <span class="op">-</span><span class="st"> </span><span class="kw">diag</span>(4L)</a>
<a class="sourceLine" id="cb5-5" title="5">}</a>
<a class="sourceLine" id="cb5-6" title="6">Rot &lt;-<span class="st"> </span><span class="kw">rotationMatrix4D</span>(nrml, <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>))</a></code></pre></div>
<p>Now define <span class="math inline">\(\mathcal{V}\mathcal{S}&#39; = R(\mathcal{V}\mathcal{S}) \subset \mathbb{R}^4\)</span>. Then all points in <span class="math inline">\(\mathcal{V}\mathcal{S}&#39;\)</span> are equal on their fourth coordinate (up to numerical errors in R):</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1">VSprime &lt;-<span class="st"> </span>Rot <span class="op">%*%</span><span class="st"> </span>VS</a>
<a class="sourceLine" id="cb6-2" title="2"><span class="kw">head</span>(<span class="kw">t</span>(VSprime))</a>
<a class="sourceLine" id="cb6-3" title="3"><span class="co">##           [,1]      [,2]      [,3]      [,4]</span></a>
<a class="sourceLine" id="cb6-4" title="4"><span class="co">## [1,]  2.203740 -1.329658 -1.620365 0.9999785</span></a>
<a class="sourceLine" id="cb6-5" title="5"><span class="co">## [2,] -1.324840  2.206491 -1.657871 1.0002417</span></a>
<a class="sourceLine" id="cb6-6" title="6"><span class="co">## [3,] -1.320131  2.212244 -1.636339 0.9999972</span></a>
<a class="sourceLine" id="cb6-7" title="7"><span class="co">## [4,] -1.417790  2.116178 -1.698381 0.9999926</span></a>
<a class="sourceLine" id="cb6-8" title="8"><span class="co">## [5,]  2.219859 -1.310784 -1.651340 0.9999841</span></a>
<a class="sourceLine" id="cb6-9" title="9"><span class="co">## [6,]  2.253515 -1.275147 -1.633245 1.0005005</span></a></code></pre></div>
<p>Finally, define <span class="math inline">\(\mathcal{V}\mathcal{S}&#39;&#39; \subset \mathbb{R}^3\)</span> as the set obtained by removing the fourth coordinates of the elements of <span class="math inline">\(\mathcal{V}\mathcal{S}&#39;\)</span>, and define the mesh <span class="math inline">\(\mathcal{M}\)</span> whose set of vertices is <span class="math inline">\(\mathcal{V}\mathcal{S}&#39;&#39;\)</span> and with the same edges as <span class="math inline">\(\mathcal{M}_0\)</span>:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" title="1"><span class="kw">library</span>(rgl)</a>
<a class="sourceLine" id="cb7-2" title="2">mesh &lt;-<span class="st"> </span><span class="kw">tmesh3d</span>(</a>
<a class="sourceLine" id="cb7-3" title="3">  <span class="dt">vertices =</span> VSprime[<span class="op">-</span>4L,],</a>
<a class="sourceLine" id="cb7-4" title="4">  <span class="dt">indices =</span> mesh0<span class="op">$</span>ib,</a>
<a class="sourceLine" id="cb7-5" title="5">  <span class="dt">homogeneous =</span> <span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb7-6" title="6">  <span class="dt">normals =</span> ?</a>
<a class="sourceLine" id="cb7-7" title="7">)</a></code></pre></div>
<p>What about the normals? If you have an implicit equation defining <span class="math inline">\(\mathcal{S}\)</span>, that is, <span class="math inline">\(\mathcal{S} = \iota^{-1}(0)\)</span> with <span class="math inline">\(\iota\colon \mathbb{R}^4 \to \mathbb{R}\)</span>, then a normal to <span class="math inline">\(\mathcal{S}\)</span> at a point <span class="math inline">\(\mathbf{x} \in \mathbb{R}^4\)</span> is given by the gradient of <span class="math inline">\(\iota\)</span> at <span class="math inline">\(\mathbf{x}\)</span>. For the tiger, we know an implicit equation, and it is not difficult to get the gradient:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" title="1">sNormal &lt;-<span class="st"> </span><span class="cf">function</span>(XYZT){</a>
<a class="sourceLine" id="cb8-2" title="2">  x &lt;-<span class="st"> </span>XYZT[1L,]; y &lt;-<span class="st"> </span>XYZT[2L,]; z &lt;-<span class="st"> </span>XYZT[3L,]; t &lt;-<span class="st"> </span>XYZT[4L,]</a>
<a class="sourceLine" id="cb8-3" title="3">  <span class="kw">rbind</span>(</a>
<a class="sourceLine" id="cb8-4" title="4">    x <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>R1<span class="op">/</span><span class="kw">sqrt</span>(x<span class="op">^</span><span class="dv">2</span><span class="op">+</span>y<span class="op">^</span><span class="dv">2</span>)),</a>
<a class="sourceLine" id="cb8-5" title="5">    y <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>R1<span class="op">/</span><span class="kw">sqrt</span>(x<span class="op">^</span><span class="dv">2</span><span class="op">+</span>y<span class="op">^</span><span class="dv">2</span>)),</a>
<a class="sourceLine" id="cb8-6" title="6">    z <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>R2<span class="op">/</span><span class="kw">sqrt</span>(z<span class="op">^</span><span class="dv">2</span><span class="op">+</span>t<span class="op">^</span><span class="dv">2</span>)),</a>
<a class="sourceLine" id="cb8-7" title="7">    t <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>R2<span class="op">/</span><span class="kw">sqrt</span>(z<span class="op">^</span><span class="dv">2</span><span class="op">+</span>t<span class="op">^</span><span class="dv">2</span>))</a>
<a class="sourceLine" id="cb8-8" title="8">  )</a>
<a class="sourceLine" id="cb8-9" title="9">}</a>
<a class="sourceLine" id="cb8-10" title="10">Normals &lt;-<span class="st"> </span><span class="kw">sNormal</span>(VS)</a></code></pre></div>
<p>Once you get the normals:</p>
<ul>
<li><p>project them to the hyperplane <span class="math inline">\(\mathcal{P}\)</span>;</p></li>
<li><p>apply the rotation <span class="math inline">\(R\)</span> to the projected normals;</p></li>
<li><p>remove the fourth coordinates (all equal);</p></li>
<li><p>if necessary, negate the normals.</p></li>
</ul>
<p>The projection of <span class="math inline">\(\mathbf{x} \in \mathbb{R}^4\)</span> to the hyperplane <span class="math inline">\(\mathcal{P}\)</span> is given by <span class="math display">\[
\mathbf{x} -
\frac{\langle \mathbf{a}, \mathbf{x} \rangle - b}{\Vert \mathbf{a} \Vert^2}
\mathbf{a}.
\]</span></p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" title="1"><span class="co"># projection onto hyperplane &lt;a,x&gt; = b</span></a>
<a class="sourceLine" id="cb9-2" title="2">projection &lt;-<span class="st"> </span><span class="cf">function</span>(a, b, X){</a>
<a class="sourceLine" id="cb9-3" title="3">  X <span class="op">-</span><span class="st"> </span><span class="kw">tcrossprod</span>(a<span class="op">/</span><span class="kw">c</span>(<span class="kw">crossprod</span>(a)), <span class="kw">colSums</span>(a<span class="op">*</span>X)<span class="op">-</span>b)</a>
<a class="sourceLine" id="cb9-4" title="4">}</a>
<a class="sourceLine" id="cb9-5" title="5">mesh &lt;-<span class="st"> </span><span class="kw">tmesh3d</span>(</a>
<a class="sourceLine" id="cb9-6" title="6">  <span class="dt">vertices =</span> VSprime[<span class="op">-</span>4L,], </a>
<a class="sourceLine" id="cb9-7" title="7">  <span class="dt">indices =</span> mesh0<span class="op">$</span>ib, </a>
<a class="sourceLine" id="cb9-8" title="8">  <span class="dt">homogeneous =</span> <span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb9-9" title="9">  <span class="dt">normals =</span> <span class="op">-</span><span class="kw">t</span>((Rot <span class="op">%*%</span><span class="st"> </span><span class="kw">projection</span>(a, b, Normals))[<span class="op">-</span>4L,])</a>
<a class="sourceLine" id="cb9-10" title="10">)</a></code></pre></div>
<p>This works:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" title="1"><span class="kw">shade3d</span>(mesh, <span class="dt">color =</span> <span class="st">&quot;darkmagenta&quot;</span>)</a></code></pre></div>
<p><img src="https://laustep.github.io/stlahblog/posts/figures/tiger1.png" /></p>
<p>Here is another way to get the normals. The normal at the point <span class="math inline">\(s(u,v,w)\)</span> is <span class="math display">\[
\frac{\partial s}{\partial u}(u,v,w) \times
\frac{\partial s}{\partial v}(u,v,w) \times
\frac{\partial s}{\partial w}(u,v,w)
\]</span> where <span class="math inline">\(\cdot \times \cdot \times \cdot\)</span> is the <em>ternary cross-product</em> in <span class="math inline">\(\mathbb{R}^4\)</span>, defined by <span class="math display">\[
\vec v_1 \times \vec v_2 \times \vec v_3 =
\left\vert\begin{matrix}
\vec i &amp; \vec j &amp; \vec k &amp; \vec l \\
v_{1x} &amp; v_{1y} &amp; v_{1z} &amp; v_{1t} \\
v_{2x} &amp; v_{2y} &amp; v_{2z} &amp; v_{2t} \\
v_{3x} &amp; v_{3y} &amp; v_{3z} &amp; v_{3t}
\end{matrix}\right\vert.
\]</span></p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" title="1">crossProd4D &lt;-<span class="st"> </span><span class="cf">function</span>(v1, v2, v3){</a>
<a class="sourceLine" id="cb11-2" title="2">  M &lt;-<span class="st"> </span><span class="kw">rbind</span>(v1, v2, v3)</a>
<a class="sourceLine" id="cb11-3" title="3">  <span class="kw">c</span>(<span class="kw">det</span>(M[,<span class="op">-</span>1L]), <span class="op">-</span><span class="kw">det</span>(M[,<span class="op">-</span>2L]), <span class="kw">det</span>(M[,<span class="op">-</span>3L]), <span class="op">-</span><span class="kw">det</span>(M[,<span class="op">-</span>4L]))</a>
<a class="sourceLine" id="cb11-4" title="4">}</a>
<a class="sourceLine" id="cb11-5" title="5">sNormal &lt;-<span class="st"> </span><span class="cf">function</span>(uvw){</a>
<a class="sourceLine" id="cb11-6" title="6">  u &lt;-<span class="st"> </span>uvw[1L]; v &lt;-<span class="st"> </span>uvw[2L]; w &lt;-<span class="st"> </span>uvw[3L]</a>
<a class="sourceLine" id="cb11-7" title="7">  Du &lt;-<span class="st"> </span><span class="kw">c</span>((R1 <span class="op">+</span><span class="st"> </span>r<span class="op">*</span><span class="kw">cos</span>(w))<span class="op">*</span><span class="kw">c</span>(<span class="op">-</span><span class="kw">sin</span>(u),<span class="kw">cos</span>(u)), <span class="dv">0</span>, <span class="dv">0</span>)</a>
<a class="sourceLine" id="cb11-8" title="8">  Dv &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, (R2 <span class="op">+</span><span class="st"> </span>r<span class="op">*</span><span class="kw">sin</span>(w))<span class="op">*</span><span class="kw">c</span>(<span class="op">-</span><span class="kw">sin</span>(v),<span class="kw">cos</span>(v)))</a>
<a class="sourceLine" id="cb11-9" title="9">  Dw &lt;-<span class="st"> </span>r <span class="op">*</span><span class="st"> </span><span class="kw">c</span>(<span class="op">-</span><span class="kw">sin</span>(w)<span class="op">*</span><span class="kw">c</span>(<span class="kw">cos</span>(u),<span class="kw">sin</span>(u)), <span class="kw">cos</span>(w)<span class="op">*</span><span class="kw">c</span>(<span class="kw">cos</span>(v),<span class="kw">sin</span>(v)))</a>
<a class="sourceLine" id="cb11-10" title="10">  <span class="kw">crossProd4D</span>(Du, Dv, Dw)</a>
<a class="sourceLine" id="cb11-11" title="11">}</a>
<a class="sourceLine" id="cb11-12" title="12">Normals &lt;-<span class="st"> </span><span class="kw">apply</span>(VS0, 2L, sNormal)</a></code></pre></div>
<p>Then you can calculate the normals in this way and proceed as before:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" title="1">mesh &lt;-<span class="st"> </span><span class="kw">tmesh3d</span>(</a>
<a class="sourceLine" id="cb12-2" title="2">  <span class="dt">vertices =</span> VSprime[<span class="op">-</span>4L,], </a>
<a class="sourceLine" id="cb12-3" title="3">  <span class="dt">indices =</span> mesh0<span class="op">$</span>ib, </a>
<a class="sourceLine" id="cb12-4" title="4">  <span class="dt">homogeneous =</span> <span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb12-5" title="5">  <span class="dt">normals =</span> <span class="kw">t</span>((Rot <span class="op">%*%</span><span class="st"> </span><span class="kw">projection</span>(a, b, Normals))[<span class="op">-</span>4L,])</a>
<a class="sourceLine" id="cb12-6" title="6">)</a></code></pre></div>
<p>Here is how to do an animation:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" title="1">b_ &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="op">-</span><span class="fl">11.5</span>, <span class="fl">11.5</span>, <span class="dt">length.out =</span> 60L)</a>
<a class="sourceLine" id="cb13-2" title="2"><span class="kw">open3d</span>(<span class="dt">windowRect =</span> <span class="kw">c</span>(<span class="dv">100</span>, <span class="dv">100</span>, <span class="dv">612</span>, <span class="dv">612</span>), <span class="dt">zoom =</span> <span class="fl">0.8</span>)</a>
<a class="sourceLine" id="cb13-3" title="3"><span class="kw">bg3d</span>(<span class="kw">rgb</span>(<span class="dv">54</span>, <span class="dv">57</span>, <span class="dv">64</span>, <span class="dt">maxColorValue =</span> <span class="dv">255</span>))</a>
<a class="sourceLine" id="cb13-4" title="4"><span class="kw">view3d</span>(<span class="dv">45</span>, <span class="dv">40</span>)</a>
<a class="sourceLine" id="cb13-5" title="5"><span class="cf">for</span>(i <span class="cf">in</span> 1L<span class="op">:</span><span class="kw">length</span>(b_)){</a>
<a class="sourceLine" id="cb13-6" title="6">  x0 &lt;-<span class="st"> </span><span class="kw">rep</span>(b_[i]<span class="op">/</span><span class="dv">4</span>, 4L) </a>
<a class="sourceLine" id="cb13-7" title="7">  surf &lt;-<span class="st"> </span><span class="kw">computeContour3d</span>(voxel, <span class="dt">level =</span> <span class="kw">sum</span>(x0<span class="op">*</span>nrml), </a>
<a class="sourceLine" id="cb13-8" title="8">                           <span class="dt">x =</span> u_, <span class="dt">y =</span> v_, <span class="dt">z =</span> w_)</a>
<a class="sourceLine" id="cb13-9" title="9">  trgls &lt;-<span class="st"> </span><span class="kw">makeTriangles</span>(surf)</a>
<a class="sourceLine" id="cb13-10" title="10">  mesh0 &lt;-<span class="st"> </span>misc3d<span class="op">:::</span><span class="kw">t2ve</span>(trgls)</a>
<a class="sourceLine" id="cb13-11" title="11">  VS0 &lt;-<span class="st"> </span>mesh0<span class="op">$</span>vb</a>
<a class="sourceLine" id="cb13-12" title="12">  VS &lt;-<span class="st"> </span><span class="kw">s</span>(VS0[1L,], VS0[2L,], VS0[3L,])</a>
<a class="sourceLine" id="cb13-13" title="13">  Normals &lt;-<span class="st"> </span><span class="kw">sNormal</span>(VS)</a>
<a class="sourceLine" id="cb13-14" title="14">  mesh &lt;-<span class="st"> </span><span class="kw">tmesh3d</span>(</a>
<a class="sourceLine" id="cb13-15" title="15">    <span class="dt">vertices =</span> (Rot <span class="op">%*%</span><span class="st"> </span>VS)[<span class="op">-</span>4L,], </a>
<a class="sourceLine" id="cb13-16" title="16">    <span class="dt">indices =</span> mesh0<span class="op">$</span>ib, </a>
<a class="sourceLine" id="cb13-17" title="17">    <span class="dt">homogeneous =</span> <span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb13-18" title="18">    <span class="dt">normals =</span> <span class="op">-</span><span class="kw">t</span>((Rot <span class="op">%*%</span><span class="st"> </span><span class="kw">projection</span>(a, b_[i], Normals))[<span class="op">-</span>4L,])</a>
<a class="sourceLine" id="cb13-19" title="19">  )</a>
<a class="sourceLine" id="cb13-20" title="20">  <span class="kw">shade3d</span>(mesh, <span class="dt">color =</span> <span class="st">&quot;firebrick3&quot;</span>)</a>
<a class="sourceLine" id="cb13-21" title="21">  <span class="kw">snapshot3d</span>(<span class="kw">sprintf</span>(<span class="st">&quot;pic%03d.png&quot;</span>, i))</a>
<a class="sourceLine" id="cb13-22" title="22">  <span class="kw">clear3d</span>()</a>
<a class="sourceLine" id="cb13-23" title="23">}</a>
<a class="sourceLine" id="cb13-24" title="24"><span class="cf">for</span>(i <span class="cf">in</span> 1L<span class="op">:</span>59L){</a>
<a class="sourceLine" id="cb13-25" title="25">  <span class="kw">file.copy</span>(<span class="kw">sprintf</span>(<span class="st">&quot;pic%03d.png&quot;</span>, <span class="dv">60</span><span class="op">-</span>i), <span class="kw">sprintf</span>(<span class="st">&quot;pic%03d.png&quot;</span>, <span class="dv">60</span><span class="op">+</span>i))</a>
<a class="sourceLine" id="cb13-26" title="26">}</a>
<a class="sourceLine" id="cb13-27" title="27"><span class="co"># run gifski</span></a>
<a class="sourceLine" id="cb13-28" title="28">command &lt;-<span class="st"> &quot;gifski --fps 12 pic*.png -o slicedTiger.gif&quot;</span></a>
<a class="sourceLine" id="cb13-29" title="29"><span class="kw">system</span>(command)</a>
<a class="sourceLine" id="cb13-30" title="30"><span class="co"># cleaning</span></a>
<a class="sourceLine" id="cb13-31" title="31">pngfiles &lt;-<span class="st"> </span><span class="kw">list.files</span>(<span class="dt">pattern =</span> <span class="st">&quot;^pic.*png$&quot;</span>)</a>
<a class="sourceLine" id="cb13-32" title="32"><span class="kw">file.remove</span>(pngfiles)</a></code></pre></div>
<p><img src="https://laustep.github.io/stlahblog/posts/figures/tiger2.gif" /></p>
<h2 id="toroidal-hyperboloid">Toroidal hyperboloid</h2>
<p>Let’s give another example, a <em>toroidal hyperboloid</em>. This is a quadric with implicit equation <span class="math display">\[
\frac{x^2}{a^2} + \frac{y^2}{b^2} - \frac{z^2}{c^2} - \frac{t^2}{d^2} = 1,
\]</span> and a parameterization of this quadric is <span class="math display">\[
\begin{array}{ccc}
s \colon &amp; (0,2\pi) \times (0,2\pi) \times (0, +\infty[ &amp;
\longrightarrow &amp; \mathbb{R}^4 \\
 &amp; (u,v,w) &amp; \longmapsto &amp;
\begin{pmatrix}
a \cos u \cosh w \\
b \sin u \cosh w \\
c \cos v \sinh w \\
d \sin v \sinh w
\end{pmatrix}
\end{array}.
\]</span></p>
<p><img src="https://laustep.github.io/stlahblog/posts/figures/toroidalHyperboloid.gif" /></p>

        </div>


        <div id="footer">
          Site proudly generated by
          <a href="http://jaspervdj.be/hakyll">Hakyll</a>
        </div>

      </div>

    </div>

    <div class="row">
      <div class="col-sm-12">
        <div id="disqus_thread"></div>
        <div class="pagination">
          <ul>
            <li>
              <a href="http://laustep.github.io/stlahblog/">&#171; Back Home</a>
            </li>
          </ul>
        </div>
      </div>
    </div>

  </div>

<script src="https://laustep.github.io/stlahblog/libraries/bootstrap/bootstrap.min.js"></script>
<!-- MathJax: Fall back to local if CDN offline but local image fonts are not supported (saves >100MB) -->
<script type="text/x-mathjax-config" src="https://laustep.github.io/stlahblog/libraries/mathjax/config/TeX-MML-AM_CHTML.js"></script>
<!-- <script>
  window.MathJax || document.write('<script type="text/x-mathjax-config">MathJax.Hub.Config({"HTML-CSS":{imageFont:null}});<\/script><script src="https://laustep.github.io/stlahblog/libraries/mathjax/MathJax.js"><\/script>');
</script> -->



]]></description>
    <pubDate>Fri, 01 May 2020 00:00:00 UT</pubDate>
    <guid>https://laustep.github.io/stlahblog/posts/slicedHypersurface.html</guid>
    <dc:creator>Stéphane Laurent</dc:creator>

        <category>R</category>

</item>
<item>
    <title>An orbit of the modular tessellation</title>
    <link>https://laustep.github.io/stlahblog/posts/ModularTessellationOrbit.html</link>
    <description><![CDATA[
    <link href="https://laustep.github.io/stlahblog/libraries/bootstrap/bootstrap-grid.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://laustep.github.io/stlahblog/css/default2.css" />
  <link rel="stylesheet" href="https://laustep.github.io/stlahblog/css/post.css" />
  <link rel="stylesheet" href="https://laustep.github.io/stlahblog/css/misc.css" />

    <link rel="stylesheet" href="https://laustep.github.io/stlahblog/css/pandoc-solarized.css" />


    <link href="https://laustep.github.io/stlahblog/libraries/highlighters/prettify/css/minimal.css" rel="stylesheet">

  <link href="https://fonts.googleapis.com/css?family=Raleway:400,600,200,800" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Droid+Sans" rel="stylesheet" type="text/css">
  <script src="https://laustep.github.io/stlahblog/libraries/jquery.min.js"></script>
  <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>

  <div class="container-fluid">
    <div class="row">
      <div class="main col-sm-12">
        <div id="header">
          <div id="logo" style="position:absolute;">
            <a href="https://laustep.github.io/stlahblog/">
              <img src="https://laustep.github.io/stlahblog/images/stla.jpg" alt="stla" width="100px" />
            </a>
          </div>
          <div id="navigation" style="margin-top:50px;">
            <a href="https://laustep.github.io/stlahblog/">Home</a>
            <a href="https://laustep.github.io/stlahblog/about.html">About</a>
            <a href="https://laustep.github.io/stlahblog/contact.html">Contact</a>
            <a href="https://laustep.github.io/stlahblog/archive.html">Archive</a>
          </div>
        </div>

        <div class="content">
          <h1>An orbit of the modular tessellation</h1>
          <div class="info">
    Posted on February 19, 2020

        by Stéphane Laurent

</div>
<div class="info">

    Tags: <a href="https://laustep.github.io/stlahblog/tags/R.html">R</a>, <a href="https://laustep.github.io/stlahblog/tags/maths.html">maths</a>, <a href="https://laustep.github.io/stlahblog/tags/geometry.html">geometry</a>

</div>

<p>I came across this <a href="https://www3.risc.jku.at/publications/download/risc_5011/DiplomaThesisPonweiser.pdf">interesting paper</a> entitled <em>Complex Variables Visualized</em> and written by Thomas Ponweiser.</p>
<p>In particular, I was intrigued by the <em>generalized powers</em> of a Möbius transformation (of a matrix, actually), and their actions on the modular tessellation.</p>
<p>So I firstly implemented the generalized powers in my package <code>PlaneGeometry</code>. Then I wrote the script below to visualize the orbit of the modular tessellation under the action of <span class="math inline">\(R^t\)</span>, <span class="math inline">\(0 \leqslant t &lt; 3\)</span>, with the notations of the paper. The command <code>fplot(u)</code> generates the modular tessellation under the action of <span class="math inline">\(R^t\)</span> when <code>u</code> is the value of <span class="math inline">\(t\)</span>. Then I use the <code>gifski</code> package to create the animation.</p>
<p>To get the modular transformations <span class="math inline">\(z \mapsto \frac{az+b}{cz+d}\)</span>, I use the <code>unimodular</code> function of the <code>elliptic</code> package. It generates the quadruples <span class="math inline">\((a,b,c,d)\)</span> of <em>positive</em> integers such that <span class="math inline">\(ad-bc=1\)</span>. Then we can get all such quadruples <span class="math inline">\((a,b,c,d) \in \mathbb{Z}^4\)</span> by inverting these modular transformations, swapping <span class="math inline">\(a\)</span> and <span class="math inline">\(d\)</span> and changing their signs.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1"><span class="kw">library</span>(PlaneGeometry)</a>
<a class="sourceLine" id="cb1-2" title="2"><span class="kw">library</span>(elliptic) <span class="co"># for the &#39;unimodular&#39; function</span></a>
<a class="sourceLine" id="cb1-3" title="3"></a>
<a class="sourceLine" id="cb1-4" title="4"><span class="co"># Möbius transformations</span></a>
<a class="sourceLine" id="cb1-5" title="5">T &lt;-<span class="st"> </span>Mobius<span class="op">$</span><span class="kw">new</span>(<span class="kw">rbind</span>(<span class="kw">c</span>(<span class="dv">0</span>,<span class="op">-</span><span class="dv">1</span>), <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">0</span>)))</a>
<a class="sourceLine" id="cb1-6" title="6">U &lt;-<span class="st"> </span>Mobius<span class="op">$</span><span class="kw">new</span>(<span class="kw">rbind</span>(<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">1</span>), <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)))</a>
<a class="sourceLine" id="cb1-7" title="7">R &lt;-<span class="st"> </span>U<span class="op">$</span><span class="kw">compose</span>(T)</a>
<a class="sourceLine" id="cb1-8" title="8"><span class="co"># R^t, generalized power</span></a>
<a class="sourceLine" id="cb1-9" title="9">Rt &lt;-<span class="st"> </span><span class="cf">function</span>(t) R<span class="op">$</span><span class="kw">gpower</span>(t)</a>
<a class="sourceLine" id="cb1-10" title="10"></a>
<a class="sourceLine" id="cb1-11" title="11"><span class="co"># starting circles</span></a>
<a class="sourceLine" id="cb1-12" title="12">I &lt;-<span class="st"> </span>Circle<span class="op">$</span><span class="kw">new</span>(<span class="kw">c</span>(<span class="dv">0</span>,<span class="fl">1.5</span>), <span class="fl">0.5</span>)</a>
<a class="sourceLine" id="cb1-13" title="13">TI &lt;-<span class="st"> </span>T<span class="op">$</span><span class="kw">transformCircle</span>(I)</a>
<a class="sourceLine" id="cb1-14" title="14"></a>
<a class="sourceLine" id="cb1-15" title="15"><span class="co"># modified Cayley transformation</span></a>
<a class="sourceLine" id="cb1-16" title="16">Phi &lt;-<span class="st"> </span>Mobius<span class="op">$</span><span class="kw">new</span>(<span class="kw">rbind</span>(<span class="kw">c</span>(1i,<span class="dv">1</span>), <span class="kw">c</span>(<span class="dv">1</span>,1i)))</a>
<a class="sourceLine" id="cb1-17" title="17"></a>
<a class="sourceLine" id="cb1-18" title="18"><span class="co"># plotting function ####</span></a>
<a class="sourceLine" id="cb1-19" title="19">n &lt;-<span class="st"> </span>8L</a>
<a class="sourceLine" id="cb1-20" title="20">transfos &lt;-<span class="st"> </span><span class="kw">unimodular</span>(n)</a>
<a class="sourceLine" id="cb1-21" title="21">fplot &lt;-<span class="st"> </span><span class="cf">function</span>(u){</a>
<a class="sourceLine" id="cb1-22" title="22">  opar &lt;-<span class="st"> </span><span class="kw">par</span>(<span class="dt">mar =</span> <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>), <span class="dt">bg =</span> <span class="st">&quot;black&quot;</span>)</a>
<a class="sourceLine" id="cb1-23" title="23">  <span class="kw">plot</span>(<span class="ot">NULL</span>, <span class="dt">asp =</span> <span class="dv">1</span>, <span class="dt">xlim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="fl">1.1</span>,<span class="fl">1.1</span>), <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="fl">1.1</span>,<span class="fl">1.1</span>),</a>
<a class="sourceLine" id="cb1-24" title="24">       <span class="dt">xlab =</span> <span class="ot">NA</span>, <span class="dt">ylab =</span> <span class="ot">NA</span>, <span class="dt">axes =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb1-25" title="25">  <span class="kw">draw</span>(unitCircle, <span class="dt">col =</span> <span class="st">&quot;black&quot;</span>)</a>
<a class="sourceLine" id="cb1-26" title="26">  <span class="cf">for</span>(i <span class="cf">in</span> 1L<span class="op">:</span><span class="kw">dim</span>(transfos)[3L]){</a>
<a class="sourceLine" id="cb1-27" title="27">    transfo &lt;-<span class="st"> </span>transfos[,,i]</a>
<a class="sourceLine" id="cb1-28" title="28">    <span class="co">#</span></a>
<a class="sourceLine" id="cb1-29" title="29">    M &lt;-<span class="st"> </span>Mobius<span class="op">$</span><span class="kw">new</span>(transfo)</a>
<a class="sourceLine" id="cb1-30" title="30">    <span class="kw">draw</span>(M<span class="op">$</span><span class="kw">compose</span>(<span class="kw">Rt</span>(u))<span class="op">$</span><span class="kw">compose</span>(Phi)<span class="op">$</span><span class="kw">transformCircle</span>(I),</a>
<a class="sourceLine" id="cb1-31" title="31">         <span class="dt">border =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">col =</span> <span class="st">&quot;magenta&quot;</span>)</a>
<a class="sourceLine" id="cb1-32" title="32">    <span class="kw">draw</span>(M<span class="op">$</span><span class="kw">compose</span>(<span class="kw">Rt</span>(u))<span class="op">$</span><span class="kw">compose</span>(Phi)<span class="op">$</span><span class="kw">transformCircle</span>(TI),</a>
<a class="sourceLine" id="cb1-33" title="33">         <span class="dt">border =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">col =</span> <span class="st">&quot;magenta&quot;</span>)</a>
<a class="sourceLine" id="cb1-34" title="34">    M &lt;-<span class="st"> </span>M<span class="op">$</span><span class="kw">inverse</span>()</a>
<a class="sourceLine" id="cb1-35" title="35">    <span class="kw">draw</span>(M<span class="op">$</span><span class="kw">compose</span>(<span class="kw">Rt</span>(u))<span class="op">$</span><span class="kw">compose</span>(Phi)<span class="op">$</span><span class="kw">transformCircle</span>(I),</a>
<a class="sourceLine" id="cb1-36" title="36">         <span class="dt">border =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">col =</span> <span class="st">&quot;magenta&quot;</span>)</a>
<a class="sourceLine" id="cb1-37" title="37">    <span class="kw">draw</span>(M<span class="op">$</span><span class="kw">compose</span>(<span class="kw">Rt</span>(u))<span class="op">$</span><span class="kw">compose</span>(Phi)<span class="op">$</span><span class="kw">transformCircle</span>(TI),</a>
<a class="sourceLine" id="cb1-38" title="38">         <span class="dt">border =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">col =</span> <span class="st">&quot;magenta&quot;</span>)</a>
<a class="sourceLine" id="cb1-39" title="39">    <span class="co">#</span></a>
<a class="sourceLine" id="cb1-40" title="40">    <span class="kw">diag</span>(transfo) &lt;-<span class="st"> </span><span class="op">-</span><span class="kw">diag</span>(transfo)</a>
<a class="sourceLine" id="cb1-41" title="41">    M &lt;-<span class="st"> </span>Mobius<span class="op">$</span><span class="kw">new</span>(transfo)</a>
<a class="sourceLine" id="cb1-42" title="42">    <span class="kw">draw</span>(M<span class="op">$</span><span class="kw">compose</span>(<span class="kw">Rt</span>(u))<span class="op">$</span><span class="kw">compose</span>(Phi)<span class="op">$</span><span class="kw">transformCircle</span>(I),</a>
<a class="sourceLine" id="cb1-43" title="43">         <span class="dt">border =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">col =</span> <span class="st">&quot;magenta&quot;</span>)</a>
<a class="sourceLine" id="cb1-44" title="44">    <span class="kw">draw</span>(M<span class="op">$</span><span class="kw">compose</span>(<span class="kw">Rt</span>(u))<span class="op">$</span><span class="kw">compose</span>(Phi)<span class="op">$</span><span class="kw">transformCircle</span>(TI),</a>
<a class="sourceLine" id="cb1-45" title="45">         <span class="dt">border =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">col =</span> <span class="st">&quot;magenta&quot;</span>)</a>
<a class="sourceLine" id="cb1-46" title="46">    M &lt;-<span class="st"> </span>M<span class="op">$</span><span class="kw">inverse</span>()</a>
<a class="sourceLine" id="cb1-47" title="47">    <span class="kw">draw</span>(M<span class="op">$</span><span class="kw">compose</span>(<span class="kw">Rt</span>(u))<span class="op">$</span><span class="kw">compose</span>(Phi)<span class="op">$</span><span class="kw">transformCircle</span>(I),</a>
<a class="sourceLine" id="cb1-48" title="48">         <span class="dt">border =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">col =</span> <span class="st">&quot;magenta&quot;</span>)</a>
<a class="sourceLine" id="cb1-49" title="49">    <span class="kw">draw</span>(M<span class="op">$</span><span class="kw">compose</span>(<span class="kw">Rt</span>(u))<span class="op">$</span><span class="kw">compose</span>(Phi)<span class="op">$</span><span class="kw">transformCircle</span>(TI),</a>
<a class="sourceLine" id="cb1-50" title="50">         <span class="dt">border =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">col =</span> <span class="st">&quot;magenta&quot;</span>)</a>
<a class="sourceLine" id="cb1-51" title="51">    <span class="co">#</span></a>
<a class="sourceLine" id="cb1-52" title="52">    d &lt;-<span class="st"> </span><span class="kw">diag</span>(transfo)</a>
<a class="sourceLine" id="cb1-53" title="53">    <span class="cf">if</span>(d[1L] <span class="op">!=</span><span class="st"> </span>d[2L]){</a>
<a class="sourceLine" id="cb1-54" title="54">      <span class="kw">diag</span>(transfo) &lt;-<span class="st"> </span><span class="kw">rev</span>(d)</a>
<a class="sourceLine" id="cb1-55" title="55">      M &lt;-<span class="st"> </span>Mobius<span class="op">$</span><span class="kw">new</span>(transfo)</a>
<a class="sourceLine" id="cb1-56" title="56">      <span class="kw">draw</span>(M<span class="op">$</span><span class="kw">compose</span>(<span class="kw">Rt</span>(u))<span class="op">$</span><span class="kw">compose</span>(Phi)<span class="op">$</span><span class="kw">transformCircle</span>(I),</a>
<a class="sourceLine" id="cb1-57" title="57">           <span class="dt">border =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">col =</span> <span class="st">&quot;magenta&quot;</span>)</a>
<a class="sourceLine" id="cb1-58" title="58">      <span class="kw">draw</span>(M<span class="op">$</span><span class="kw">compose</span>(<span class="kw">Rt</span>(u))<span class="op">$</span><span class="kw">compose</span>(Phi)<span class="op">$</span><span class="kw">transformCircle</span>(TI),</a>
<a class="sourceLine" id="cb1-59" title="59">           <span class="dt">border =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">col =</span> <span class="st">&quot;magenta&quot;</span>)</a>
<a class="sourceLine" id="cb1-60" title="60">      M &lt;-<span class="st"> </span>M<span class="op">$</span><span class="kw">inverse</span>()</a>
<a class="sourceLine" id="cb1-61" title="61">      <span class="kw">draw</span>(M<span class="op">$</span><span class="kw">compose</span>(<span class="kw">Rt</span>(u))<span class="op">$</span><span class="kw">compose</span>(Phi)<span class="op">$</span><span class="kw">transformCircle</span>(I),</a>
<a class="sourceLine" id="cb1-62" title="62">           <span class="dt">border =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">col =</span> <span class="st">&quot;magenta&quot;</span>)</a>
<a class="sourceLine" id="cb1-63" title="63">      <span class="kw">draw</span>(M<span class="op">$</span><span class="kw">compose</span>(<span class="kw">Rt</span>(u))<span class="op">$</span><span class="kw">compose</span>(Phi)<span class="op">$</span><span class="kw">transformCircle</span>(TI),</a>
<a class="sourceLine" id="cb1-64" title="64">           <span class="dt">border =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">col =</span> <span class="st">&quot;magenta&quot;</span>)</a>
<a class="sourceLine" id="cb1-65" title="65">    }</a>
<a class="sourceLine" id="cb1-66" title="66">  }</a>
<a class="sourceLine" id="cb1-67" title="67">  <span class="cf">for</span>(i <span class="cf">in</span> 1L<span class="op">:</span><span class="kw">dim</span>(transfos)[3L]){</a>
<a class="sourceLine" id="cb1-68" title="68">    transfo &lt;-<span class="st"> </span>transfos[,,i]</a>
<a class="sourceLine" id="cb1-69" title="69">    <span class="co">#</span></a>
<a class="sourceLine" id="cb1-70" title="70">    M &lt;-<span class="st"> </span>Mobius<span class="op">$</span><span class="kw">new</span>(transfo)<span class="op">$</span><span class="kw">compose</span>(T)</a>
<a class="sourceLine" id="cb1-71" title="71">    <span class="kw">draw</span>(M<span class="op">$</span><span class="kw">compose</span>(<span class="kw">Rt</span>(u))<span class="op">$</span><span class="kw">compose</span>(Phi)<span class="op">$</span><span class="kw">transformCircle</span>(I),</a>
<a class="sourceLine" id="cb1-72" title="72">         <span class="dt">border =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">col =</span> <span class="st">&quot;magenta&quot;</span>)</a>
<a class="sourceLine" id="cb1-73" title="73">    <span class="kw">draw</span>(M<span class="op">$</span><span class="kw">compose</span>(<span class="kw">Rt</span>(u))<span class="op">$</span><span class="kw">compose</span>(Phi)<span class="op">$</span><span class="kw">transformCircle</span>(TI),</a>
<a class="sourceLine" id="cb1-74" title="74">         <span class="dt">border =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">col =</span> <span class="st">&quot;magenta&quot;</span>)</a>
<a class="sourceLine" id="cb1-75" title="75">    M &lt;-<span class="st"> </span>M<span class="op">$</span><span class="kw">inverse</span>()</a>
<a class="sourceLine" id="cb1-76" title="76">    <span class="kw">draw</span>(M<span class="op">$</span><span class="kw">compose</span>(<span class="kw">Rt</span>(u))<span class="op">$</span><span class="kw">compose</span>(Phi)<span class="op">$</span><span class="kw">transformCircle</span>(I),</a>
<a class="sourceLine" id="cb1-77" title="77">         <span class="dt">border =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">col =</span> <span class="st">&quot;magenta&quot;</span>)</a>
<a class="sourceLine" id="cb1-78" title="78">    <span class="kw">draw</span>(M<span class="op">$</span><span class="kw">compose</span>(<span class="kw">Rt</span>(u))<span class="op">$</span><span class="kw">compose</span>(Phi)<span class="op">$</span><span class="kw">transformCircle</span>(TI),</a>
<a class="sourceLine" id="cb1-79" title="79">         <span class="dt">border =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">col =</span> <span class="st">&quot;magenta&quot;</span>)</a>
<a class="sourceLine" id="cb1-80" title="80">    <span class="co">#</span></a>
<a class="sourceLine" id="cb1-81" title="81">    <span class="kw">diag</span>(transfo) &lt;-<span class="st"> </span><span class="op">-</span><span class="kw">diag</span>(transfo)</a>
<a class="sourceLine" id="cb1-82" title="82">    M &lt;-<span class="st"> </span>Mobius<span class="op">$</span><span class="kw">new</span>(transfo)<span class="op">$</span><span class="kw">compose</span>(T)</a>
<a class="sourceLine" id="cb1-83" title="83">    <span class="kw">draw</span>(M<span class="op">$</span><span class="kw">compose</span>(<span class="kw">Rt</span>(u))<span class="op">$</span><span class="kw">compose</span>(Phi)<span class="op">$</span><span class="kw">transformCircle</span>(I),</a>
<a class="sourceLine" id="cb1-84" title="84">         <span class="dt">border =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">col =</span> <span class="st">&quot;magenta&quot;</span>)</a>
<a class="sourceLine" id="cb1-85" title="85">    <span class="kw">draw</span>(M<span class="op">$</span><span class="kw">compose</span>(<span class="kw">Rt</span>(u))<span class="op">$</span><span class="kw">compose</span>(Phi)<span class="op">$</span><span class="kw">transformCircle</span>(TI),</a>
<a class="sourceLine" id="cb1-86" title="86">         <span class="dt">border =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">col =</span> <span class="st">&quot;magenta&quot;</span>)</a>
<a class="sourceLine" id="cb1-87" title="87">    M &lt;-<span class="st"> </span>M<span class="op">$</span><span class="kw">inverse</span>()</a>
<a class="sourceLine" id="cb1-88" title="88">    <span class="kw">draw</span>(M<span class="op">$</span><span class="kw">compose</span>(<span class="kw">Rt</span>(u))<span class="op">$</span><span class="kw">compose</span>(Phi)<span class="op">$</span><span class="kw">transformCircle</span>(I),</a>
<a class="sourceLine" id="cb1-89" title="89">         <span class="dt">border =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">col =</span> <span class="st">&quot;magenta&quot;</span>)</a>
<a class="sourceLine" id="cb1-90" title="90">    <span class="kw">draw</span>(M<span class="op">$</span><span class="kw">compose</span>(<span class="kw">Rt</span>(u))<span class="op">$</span><span class="kw">compose</span>(Phi)<span class="op">$</span><span class="kw">transformCircle</span>(TI),</a>
<a class="sourceLine" id="cb1-91" title="91">         <span class="dt">border =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">col =</span> <span class="st">&quot;magenta&quot;</span>)</a>
<a class="sourceLine" id="cb1-92" title="92">    <span class="co">#</span></a>
<a class="sourceLine" id="cb1-93" title="93">    d &lt;-<span class="st"> </span><span class="kw">diag</span>(transfo)</a>
<a class="sourceLine" id="cb1-94" title="94">    <span class="cf">if</span>(d[1L] <span class="op">!=</span><span class="st"> </span>d[2L]){</a>
<a class="sourceLine" id="cb1-95" title="95">      <span class="kw">diag</span>(transfo) &lt;-<span class="st"> </span><span class="kw">rev</span>(d)</a>
<a class="sourceLine" id="cb1-96" title="96">      M &lt;-<span class="st"> </span>Mobius<span class="op">$</span><span class="kw">new</span>(transfo)<span class="op">$</span><span class="kw">compose</span>(T)</a>
<a class="sourceLine" id="cb1-97" title="97">      <span class="kw">draw</span>(M<span class="op">$</span><span class="kw">compose</span>(<span class="kw">Rt</span>(u))<span class="op">$</span><span class="kw">compose</span>(Phi)<span class="op">$</span><span class="kw">transformCircle</span>(I),</a>
<a class="sourceLine" id="cb1-98" title="98">           <span class="dt">border =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">col =</span> <span class="st">&quot;magenta&quot;</span>)</a>
<a class="sourceLine" id="cb1-99" title="99">      <span class="kw">draw</span>(M<span class="op">$</span><span class="kw">compose</span>(<span class="kw">Rt</span>(u))<span class="op">$</span><span class="kw">compose</span>(Phi)<span class="op">$</span><span class="kw">transformCircle</span>(TI),</a>
<a class="sourceLine" id="cb1-100" title="100">           <span class="dt">border =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">col =</span> <span class="st">&quot;magenta&quot;</span>)</a>
<a class="sourceLine" id="cb1-101" title="101">      M &lt;-<span class="st"> </span>M<span class="op">$</span><span class="kw">inverse</span>()</a>
<a class="sourceLine" id="cb1-102" title="102">      <span class="kw">draw</span>(M<span class="op">$</span><span class="kw">compose</span>(<span class="kw">Rt</span>(u))<span class="op">$</span><span class="kw">compose</span>(Phi)<span class="op">$</span><span class="kw">transformCircle</span>(I),</a>
<a class="sourceLine" id="cb1-103" title="103">           <span class="dt">border =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">col =</span> <span class="st">&quot;magenta&quot;</span>)</a>
<a class="sourceLine" id="cb1-104" title="104">      <span class="kw">draw</span>(M<span class="op">$</span><span class="kw">compose</span>(<span class="kw">Rt</span>(u))<span class="op">$</span><span class="kw">compose</span>(Phi)<span class="op">$</span><span class="kw">transformCircle</span>(TI),</a>
<a class="sourceLine" id="cb1-105" title="105">           <span class="dt">border =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">col =</span> <span class="st">&quot;magenta&quot;</span>)</a>
<a class="sourceLine" id="cb1-106" title="106">    }</a>
<a class="sourceLine" id="cb1-107" title="107">  }</a>
<a class="sourceLine" id="cb1-108" title="108">}</a>
<a class="sourceLine" id="cb1-109" title="109"></a>
<a class="sourceLine" id="cb1-110" title="110"><span class="co"># animation ####</span></a>
<a class="sourceLine" id="cb1-111" title="111"><span class="kw">library</span>(gifski)</a>
<a class="sourceLine" id="cb1-112" title="112">u_ &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">3</span>, <span class="dt">length.out =</span> 181L)[<span class="op">-</span>1L]</a>
<a class="sourceLine" id="cb1-113" title="113"><span class="kw">save_gif</span>({</a>
<a class="sourceLine" id="cb1-114" title="114">  <span class="cf">for</span>(u <span class="cf">in</span> u_){</a>
<a class="sourceLine" id="cb1-115" title="115">    <span class="kw">fplot</span>(u)</a>
<a class="sourceLine" id="cb1-116" title="116">  }</a>
<a class="sourceLine" id="cb1-117" title="117">}, <span class="st">&quot;ModularTessellation.gif&quot;</span>, <span class="dv">512</span>, <span class="dv">512</span>, <span class="dt">delay =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">12</span>, <span class="dt">res =</span> <span class="dv">144</span>)</a></code></pre></div>
<p><img src="https://laustep.github.io/stlahblog/posts/figures/ModularTessellationOrbit.gif" /></p>

        </div>


        <div id="footer">
          Site proudly generated by
          <a href="http://jaspervdj.be/hakyll">Hakyll</a>
        </div>

      </div>

    </div>

    <div class="row">
      <div class="col-sm-12">
        <div id="disqus_thread"></div>
        <div class="pagination">
          <ul>
            <li>
              <a href="http://laustep.github.io/stlahblog/">&#171; Back Home</a>
            </li>
          </ul>
        </div>
      </div>
    </div>

  </div>


<script src="https://laustep.github.io/stlahblog/libraries/bootstrap/bootstrap.min.js"></script>
<!-- MathJax: Fall back to local if CDN offline but local image fonts are not supported (saves >100MB) -->
<script type="text/x-mathjax-config" src="https://laustep.github.io/stlahblog/libraries/mathjax/config/TeX-MML-AM_CHTML.js"></script>
<!-- <script>
  window.MathJax || document.write('<script type="text/x-mathjax-config">MathJax.Hub.Config({"HTML-CSS":{imageFont:null}});<\/script><script src="https://laustep.github.io/stlahblog/libraries/mathjax/MathJax.js"><\/script>');
</script> -->



]]></description>
    <pubDate>Wed, 19 Feb 2020 00:00:00 UT</pubDate>
    <guid>https://laustep.github.io/stlahblog/posts/ModularTessellationOrbit.html</guid>
    <dc:creator>Stéphane Laurent</dc:creator>

        <category>R</category>

</item>
<item>
    <title>Tooltips for the headers of a datatable in Shiny</title>
    <link>https://laustep.github.io/stlahblog/posts/DTqTips.html</link>
    <description><![CDATA[
    <link href="https://laustep.github.io/stlahblog/libraries/bootstrap/bootstrap-grid.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://laustep.github.io/stlahblog/css/default2.css" />
  <link rel="stylesheet" href="https://laustep.github.io/stlahblog/css/post.css" />
  <link rel="stylesheet" href="https://laustep.github.io/stlahblog/css/misc.css" />

    <link rel="stylesheet" href="https://laustep.github.io/stlahblog/css/pandoc-solarized.css" />


    <link href="https://laustep.github.io/stlahblog/libraries/highlighters/prettify/css/minimal.css" rel="stylesheet">

  <link href="https://fonts.googleapis.com/css?family=Raleway:400,600,200,800" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Droid+Sans" rel="stylesheet" type="text/css">
  <script src="https://laustep.github.io/stlahblog/libraries/jquery.min.js"></script>
  <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>

  <div class="container-fluid">
    <div class="row">
      <div class="main col-sm-12">
        <div id="header">
          <div id="logo" style="position:absolute;">
            <a href="https://laustep.github.io/stlahblog/">
              <img src="https://laustep.github.io/stlahblog/images/stla.jpg" alt="stla" width="100px" />
            </a>
          </div>
          <div id="navigation" style="margin-top:50px;">
            <a href="https://laustep.github.io/stlahblog/">Home</a>
            <a href="https://laustep.github.io/stlahblog/about.html">About</a>
            <a href="https://laustep.github.io/stlahblog/contact.html">Contact</a>
            <a href="https://laustep.github.io/stlahblog/archive.html">Archive</a>
          </div>
        </div>

        <div class="content">
          <h1>Tooltips for the headers of a datatable in Shiny</h1>
          <div class="info">
    Posted on February 16, 2020

        by Stéphane Laurent

</div>
<div class="info">

    Tags: <a href="https://laustep.github.io/stlahblog/tags/R.html">R</a>, <a href="https://laustep.github.io/stlahblog/tags/datatables.html">datatables</a>, <a href="https://laustep.github.io/stlahblog/tags/javascript.html">javascript</a>, <a href="https://laustep.github.io/stlahblog/tags/shiny.html">shiny</a>

</div>

<p>In this post, I show how to use the <a href="http://qtip2.com/">qTip2</a> JavaScript library to create some tooltips on the headers of a <code>DT</code> datatable in Shiny, displaying some information about the columns, such as summary statistics.</p>
<p>Firstly, we write a function returning some JavaScript code that creates some hidden <code>div</code> elements which will contain the contents of the tooltips. This function takes two arguments: <code>n</code>, the number of <code>div</code> elements to create (this will be the number of columns of the table), and <code>prefixID</code>; the i-th <code>div</code> will have the identifier <code>{prefixID}-{i}</code>. We also set a class to each <code>div</code>, namely <code>qtip-big</code>.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1">createDiv &lt;-<span class="st"> </span><span class="cf">function</span>(n, prefixID){</a>
<a class="sourceLine" id="cb1-2" title="2">  <span class="kw">sprintf</span>(<span class="kw">paste</span>(</a>
<a class="sourceLine" id="cb1-3" title="3">    <span class="st">&quot;for(var i = 1; i &lt;= %d; i++){&quot;</span>,</a>
<a class="sourceLine" id="cb1-4" title="4">    <span class="st">&quot;  var div;&quot;</span>,</a>
<a class="sourceLine" id="cb1-5" title="5">    <span class="kw">sprintf</span>(<span class="st">&quot;  var id = &#39;%s-&#39; + i.toString();&quot;</span>, prefixID),</a>
<a class="sourceLine" id="cb1-6" title="6">    <span class="st">&quot;  if(document.getElementById(id) === null){&quot;</span>,</a>
<a class="sourceLine" id="cb1-7" title="7">    <span class="st">&quot;    div = document.createElement(&#39;div&#39;);&quot;</span>,</a>
<a class="sourceLine" id="cb1-8" title="8">    <span class="st">&quot;    div.setAttribute(&#39;id&#39;, id);&quot;</span>,</a>
<a class="sourceLine" id="cb1-9" title="9">    <span class="st">&quot;    div.setAttribute(&#39;class&#39;, &#39;qtip-big&#39;);&quot;</span>,</a>
<a class="sourceLine" id="cb1-10" title="10">    <span class="st">&quot;    div.style.display = &#39;none&#39;;&quot;</span>,</a>
<a class="sourceLine" id="cb1-11" title="11">    <span class="st">&quot;    document.body.appendChild(div);&quot;</span>,</a>
<a class="sourceLine" id="cb1-12" title="12">    <span class="st">&quot;  }&quot;</span>,</a>
<a class="sourceLine" id="cb1-13" title="13">    <span class="st">&quot;}&quot;</span>,</a>
<a class="sourceLine" id="cb1-14" title="14">    <span class="dt">sep =</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span></a>
<a class="sourceLine" id="cb1-15" title="15">  ), n)</a>
<a class="sourceLine" id="cb1-16" title="16">}</a></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1"><span class="kw">cat</span>(<span class="kw">createDiv</span>(<span class="dv">3</span>, <span class="st">&quot;TOOLTIP&quot;</span>))</a>
<a class="sourceLine" id="cb2-2" title="2"><span class="co">## for(var i = 1; i &lt;= 3; i++){</span></a>
<a class="sourceLine" id="cb2-3" title="3"><span class="co">##   var div;</span></a>
<a class="sourceLine" id="cb2-4" title="4"><span class="co">##   var id = &#39;TOOLTIP-&#39; + i.toString();</span></a>
<a class="sourceLine" id="cb2-5" title="5"><span class="co">##   if(document.getElementById(id) === null){</span></a>
<a class="sourceLine" id="cb2-6" title="6"><span class="co">##     div = document.createElement(&#39;div&#39;);</span></a>
<a class="sourceLine" id="cb2-7" title="7"><span class="co">##     div.setAttribute(&#39;id&#39;, id);</span></a>
<a class="sourceLine" id="cb2-8" title="8"><span class="co">##     div.setAttribute(&#39;class&#39;, &#39;qtip-big&#39;);</span></a>
<a class="sourceLine" id="cb2-9" title="9"><span class="co">##     div.style.display = &#39;none&#39;;</span></a>
<a class="sourceLine" id="cb2-10" title="10"><span class="co">##     document.body.appendChild(div);</span></a>
<a class="sourceLine" id="cb2-11" title="11"><span class="co">##   }</span></a>
<a class="sourceLine" id="cb2-12" title="12"><span class="co">## }</span></a></code></pre></div>
<p>Now we write a function returning some JavaScript code that writes the contents of the <code>div</code> elements. It takes as arguments <code>dat</code>, the dataframe for the table, <code>i</code>, the index of a column of <code>dat</code>, and <code>prefixID</code> as in the function <code>createDiv</code>. If the <code>i</code>-th column is numeric, we fill the <code>div</code> element with some summary statistics of this column, otherwise the information we provide in the <code>div</code> element is the number of levels of the contents of the column, an enumeration of the levels (at most three), and the number of missing values.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1">fillDiv &lt;-<span class="st"> </span><span class="cf">function</span>(dat, i, prefixID){</a>
<a class="sourceLine" id="cb3-2" title="2">  x &lt;-<span class="st"> </span>dat[[i]]</a>
<a class="sourceLine" id="cb3-3" title="3">  <span class="cf">if</span>(<span class="kw">is.numeric</span>(x)){</a>
<a class="sourceLine" id="cb3-4" title="4">    <span class="kw">sprintf</span>(<span class="kw">paste</span>(</a>
<a class="sourceLine" id="cb3-5" title="5">      <span class="st">&quot;var div = document.getElementById(&#39;%s-%d&#39;);&quot;</span>,</a>
<a class="sourceLine" id="cb3-6" title="6">      <span class="st">&quot;var html = &#39;&lt;b&gt; Min: &lt;/b&gt; %s&lt;/br&gt;&#39;;&quot;</span>,</a>
<a class="sourceLine" id="cb3-7" title="7">      <span class="st">&quot;html = html + &#39;&lt;b&gt; Max: &lt;/b&gt; %s&lt;/br&gt;&#39;;&quot;</span>,</a>
<a class="sourceLine" id="cb3-8" title="8">      <span class="st">&quot;html = html + &#39;&lt;b&gt; Mean: &lt;/b&gt; %s&lt;/br&gt;&#39;;&quot;</span>,</a>
<a class="sourceLine" id="cb3-9" title="9">      <span class="st">&quot;html = html + &#39;&lt;b&gt; Std. dev.: &lt;/b&gt; %s&lt;/br&gt;&#39;;&quot;</span>,</a>
<a class="sourceLine" id="cb3-10" title="10">      <span class="st">&quot;html = html + &#39;&lt;b&gt; Missing values: &lt;/b&gt; %d&#39;;&quot;</span>,</a>
<a class="sourceLine" id="cb3-11" title="11">      <span class="st">&quot;div.innerHTML = html;&quot;</span>,</a>
<a class="sourceLine" id="cb3-12" title="12">      <span class="dt">sep =</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span></a>
<a class="sourceLine" id="cb3-13" title="13">    ), </a>
<a class="sourceLine" id="cb3-14" title="14">    prefixID,</a>
<a class="sourceLine" id="cb3-15" title="15">    i, </a>
<a class="sourceLine" id="cb3-16" title="16">    <span class="kw">formatC</span>(<span class="kw">min</span>(x, <span class="dt">na.rm=</span><span class="ot">TRUE</span>)),</a>
<a class="sourceLine" id="cb3-17" title="17">    <span class="kw">formatC</span>(<span class="kw">max</span>(x, <span class="dt">na.rm=</span><span class="ot">TRUE</span>)),</a>
<a class="sourceLine" id="cb3-18" title="18">    <span class="kw">formatC</span>(<span class="kw">mean</span>(x, <span class="dt">na.rm=</span><span class="ot">TRUE</span>)),</a>
<a class="sourceLine" id="cb3-19" title="19">    <span class="kw">formatC</span>(<span class="kw">sd</span>(x, <span class="dt">na.rm=</span><span class="ot">TRUE</span>)),</a>
<a class="sourceLine" id="cb3-20" title="20">    <span class="kw">sum</span>(<span class="kw">is.na</span>(x)))</a>
<a class="sourceLine" id="cb3-21" title="21">  }<span class="cf">else</span>{</a>
<a class="sourceLine" id="cb3-22" title="22">    <span class="cf">if</span>(<span class="kw">is.factor</span>(x)) x &lt;-<span class="st"> </span><span class="kw">as.character</span>(x)</a>
<a class="sourceLine" id="cb3-23" title="23">    levels0 &lt;-<span class="st"> </span><span class="kw">sort</span>(<span class="kw">unique</span>(<span class="kw">na.omit</span>(x)))</a>
<a class="sourceLine" id="cb3-24" title="24">    nlevels &lt;-<span class="st"> </span><span class="kw">length</span>(levels0)</a>
<a class="sourceLine" id="cb3-25" title="25">    levels &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb3-26" title="26"><span class="st">      </span><span class="cf">if</span>(nlevels<span class="op">&gt;</span><span class="dv">3</span>) <span class="kw">c</span>(levels0[<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>], levels0[nlevels]) <span class="cf">else</span> levels0</a>
<a class="sourceLine" id="cb3-27" title="27">    ncharMax &lt;-<span class="st"> </span><span class="dv">25</span></a>
<a class="sourceLine" id="cb3-28" title="28">    nchars &lt;-<span class="st"> </span><span class="kw">nchar</span>(levels)</a>
<a class="sourceLine" id="cb3-29" title="29">    <span class="cf">if</span>(<span class="dv">7</span><span class="op">+</span><span class="kw">sum</span>(nchars) <span class="op">&gt;</span><span class="st"> </span>ncharMax){</a>
<a class="sourceLine" id="cb3-30" title="30">      levels[<span class="dv">1</span>] &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;&lt;br/&gt;&quot;</span>, levels[<span class="dv">1</span>])</a>
<a class="sourceLine" id="cb3-31" title="31">      <span class="cf">if</span>(nlevels <span class="op">&gt;=</span><span class="st"> </span><span class="dv">2</span> <span class="op">&amp;&amp;</span><span class="st"> </span><span class="kw">sum</span>(nchars) <span class="op">&gt;</span><span class="st"> </span>ncharMax){</a>
<a class="sourceLine" id="cb3-32" title="32">        levels[<span class="dv">2</span>] &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;&lt;br/&gt;&quot;</span>, levels[<span class="dv">2</span>])</a>
<a class="sourceLine" id="cb3-33" title="33">        <span class="cf">if</span>(nlevels <span class="op">&gt;=</span><span class="st"> </span><span class="dv">3</span> <span class="op">&amp;&amp;</span><span class="st"> </span><span class="kw">sum</span>(nchars[<span class="dv">2</span><span class="op">:</span><span class="dv">3</span>]) <span class="op">&gt;</span><span class="st"> </span>ncharMax){</a>
<a class="sourceLine" id="cb3-34" title="34">          levels[<span class="dv">3</span>] &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;&lt;br/&gt;&quot;</span>, levels[<span class="dv">3</span>])</a>
<a class="sourceLine" id="cb3-35" title="35">        }</a>
<a class="sourceLine" id="cb3-36" title="36">      }</a>
<a class="sourceLine" id="cb3-37" title="37">    }</a>
<a class="sourceLine" id="cb3-38" title="38">    levelsSummary &lt;-<span class="st"> </span><span class="kw">ifelse</span>(nlevels <span class="op">&gt;</span><span class="st"> </span><span class="dv">3</span>,</a>
<a class="sourceLine" id="cb3-39" title="39">                            <span class="kw">paste0</span>(<span class="kw">c</span>(levels[<span class="dv">1</span>],</a>
<a class="sourceLine" id="cb3-40" title="40">                                     <span class="kw">paste0</span>(levels[<span class="dv">2</span>], <span class="st">&quot;, ...&quot;</span>),</a>
<a class="sourceLine" id="cb3-41" title="41">                                     levels[<span class="dv">3</span>]),</a>
<a class="sourceLine" id="cb3-42" title="42">                                   <span class="dt">collapse =</span> <span class="st">&quot;, &quot;</span>),</a>
<a class="sourceLine" id="cb3-43" title="43">                            <span class="kw">paste0</span>(levels, <span class="dt">collapse =</span> <span class="st">&quot;, &quot;</span>))</a>
<a class="sourceLine" id="cb3-44" title="44">    <span class="kw">sprintf</span>(<span class="kw">paste</span>(</a>
<a class="sourceLine" id="cb3-45" title="45">      <span class="st">&quot;var div = document.getElementById(&#39;%s-%d&#39;);&quot;</span>,</a>
<a class="sourceLine" id="cb3-46" title="46">      <span class="st">&quot;var html = &#39;&lt;b&gt; Number of levels: &lt;/b&gt; %d&lt;/br&gt;&#39;;&quot;</span>,</a>
<a class="sourceLine" id="cb3-47" title="47">      <span class="kw">sprintf</span>(<span class="st">&quot;html = html + &#39;&lt;b&gt; Level%s: &lt;/b&gt; %%s&lt;/br&gt;&#39;&quot;</span>, </a>
<a class="sourceLine" id="cb3-48" title="48">              <span class="kw">ifelse</span>(nlevels<span class="op">==</span><span class="dv">1</span>, <span class="st">&quot;&quot;</span>, <span class="st">&quot;s&quot;</span>)),</a>
<a class="sourceLine" id="cb3-49" title="49">      <span class="st">&quot;html = html + &#39;&lt;b&gt; Missing values: &lt;/b&gt; %d&#39;&quot;</span>,</a>
<a class="sourceLine" id="cb3-50" title="50">      <span class="st">&quot;div.innerHTML = html;&quot;</span>,</a>
<a class="sourceLine" id="cb3-51" title="51">      <span class="dt">sep =</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span></a>
<a class="sourceLine" id="cb3-52" title="52">    ),</a>
<a class="sourceLine" id="cb3-53" title="53">    prefixID,</a>
<a class="sourceLine" id="cb3-54" title="54">    i, </a>
<a class="sourceLine" id="cb3-55" title="55">    nlevels,</a>
<a class="sourceLine" id="cb3-56" title="56">    levelsSummary,</a>
<a class="sourceLine" id="cb3-57" title="57">    <span class="kw">sum</span>(<span class="kw">is.na</span>(x)))</a>
<a class="sourceLine" id="cb3-58" title="58">  }</a>
<a class="sourceLine" id="cb3-59" title="59">}</a></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1"><span class="kw">cat</span>(<span class="kw">fillDiv</span>(iris, <span class="dv">1</span>, <span class="st">&quot;TOOLTIP&quot;</span>))</a>
<a class="sourceLine" id="cb4-2" title="2"><span class="co">## var div = document.getElementById(&#39;TOOLTIP-1&#39;);</span></a>
<a class="sourceLine" id="cb4-3" title="3"><span class="co">## var html = &#39;&lt;b&gt; Min: &lt;/b&gt; 4.3&lt;/br&gt;&#39;;</span></a>
<a class="sourceLine" id="cb4-4" title="4"><span class="co">## html = html + &#39;&lt;b&gt; Max: &lt;/b&gt; 7.9&lt;/br&gt;&#39;;</span></a>
<a class="sourceLine" id="cb4-5" title="5"><span class="co">## html = html + &#39;&lt;b&gt; Mean: &lt;/b&gt; 5.843&lt;/br&gt;&#39;;</span></a>
<a class="sourceLine" id="cb4-6" title="6"><span class="co">## html = html + &#39;&lt;b&gt; Std. dev.: &lt;/b&gt; 0.8281&lt;/br&gt;&#39;;</span></a>
<a class="sourceLine" id="cb4-7" title="7"><span class="co">## html = html + &#39;&lt;b&gt; Missing values: &lt;/b&gt; 0&#39;;</span></a>
<a class="sourceLine" id="cb4-8" title="8"><span class="co">## div.innerHTML = html;</span></a>
<a class="sourceLine" id="cb4-9" title="9"><span class="kw">cat</span>(<span class="kw">fillDiv</span>(iris, <span class="dv">5</span>, <span class="st">&quot;TOOLTIP&quot;</span>))</a>
<a class="sourceLine" id="cb4-10" title="10"><span class="co">## var div = document.getElementById(&#39;TOOLTIP-5&#39;);</span></a>
<a class="sourceLine" id="cb4-11" title="11"><span class="co">## var html = &#39;&lt;b&gt; Number of levels: &lt;/b&gt; 3&lt;/br&gt;&#39;;</span></a>
<a class="sourceLine" id="cb4-12" title="12"><span class="co">## html = html + &#39;&lt;b&gt; Levels: &lt;/b&gt; &lt;br/&gt;setosa, versicolor, virginica&lt;/br&gt;&#39;</span></a>
<a class="sourceLine" id="cb4-13" title="13"><span class="co">## html = html + &#39;&lt;b&gt; Missing values: &lt;/b&gt; 0&#39;</span></a>
<a class="sourceLine" id="cb4-14" title="14"><span class="co">## div.innerHTML = html;</span></a></code></pre></div>
<p>Finally we write a function returning the JavaScript code of the <code>qTip</code> tooltips. Its arguments are <code>n</code>, the number of columns of the table, and <code>prefixID</code> as before.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1">tooltips &lt;-<span class="st"> </span><span class="cf">function</span>(n, prefixID){</a>
<a class="sourceLine" id="cb5-2" title="2">  settings &lt;-<span class="st"> </span><span class="kw">sprintf</span>(<span class="kw">paste</span>(</a>
<a class="sourceLine" id="cb5-3" title="3">    <span class="st">&quot;{&quot;</span>,</a>
<a class="sourceLine" id="cb5-4" title="4">    <span class="st">&quot;  overwrite: true,&quot;</span>,</a>
<a class="sourceLine" id="cb5-5" title="5">    <span class="st">&quot;  content: {&quot;</span>,</a>
<a class="sourceLine" id="cb5-6" title="6">    <span class="kw">sprintf</span>(<span class="st">&quot;    text: $(&#39;#%s-%%s&#39;).clone()&quot;</span>, prefixID),</a>
<a class="sourceLine" id="cb5-7" title="7">    <span class="st">&quot;  },&quot;</span>,</a>
<a class="sourceLine" id="cb5-8" title="8">    <span class="st">&quot;  show: {&quot;</span>,</a>
<a class="sourceLine" id="cb5-9" title="9">    <span class="st">&quot;    ready: false&quot;</span>,</a>
<a class="sourceLine" id="cb5-10" title="10">    <span class="st">&quot;  },&quot;</span>,</a>
<a class="sourceLine" id="cb5-11" title="11">    <span class="st">&quot;  position: {&quot;</span>,</a>
<a class="sourceLine" id="cb5-12" title="12">    <span class="st">&quot;    my: &#39;bottom %%s&#39;,&quot;</span>,</a>
<a class="sourceLine" id="cb5-13" title="13">    <span class="st">&quot;    at: &#39;top center&#39;&quot;</span>,</a>
<a class="sourceLine" id="cb5-14" title="14">    <span class="st">&quot;  },&quot;</span>,</a>
<a class="sourceLine" id="cb5-15" title="15">    <span class="st">&quot;  style: {&quot;</span>,</a>
<a class="sourceLine" id="cb5-16" title="16">    <span class="st">&quot;    classes: &#39;qtip-youtube&#39;&quot;</span>,</a>
<a class="sourceLine" id="cb5-17" title="17">    <span class="st">&quot;  }&quot;</span>,</a>
<a class="sourceLine" id="cb5-18" title="18">    <span class="st">&quot;}&quot;</span>,</a>
<a class="sourceLine" id="cb5-19" title="19">    <span class="dt">sep =</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span></a>
<a class="sourceLine" id="cb5-20" title="20">  ), <span class="dv">1</span><span class="op">:</span>n)</a>
<a class="sourceLine" id="cb5-21" title="21">  settings &lt;-<span class="st"> </span><span class="kw">sprintf</span>(settings, <span class="kw">ifelse</span>(<span class="dv">1</span><span class="op">:</span>n <span class="op">&gt;</span><span class="st"> </span>n<span class="op">/</span><span class="dv">2</span>, <span class="st">&quot;right&quot;</span>, <span class="st">&quot;left&quot;</span>))</a>
<a class="sourceLine" id="cb5-22" title="22">  <span class="kw">sprintf</span>(<span class="st">&quot;var tooltips = [%s];&quot;</span>, <span class="kw">paste0</span>(settings, <span class="dt">collapse=</span><span class="st">&quot;,&quot;</span>))</a>
<a class="sourceLine" id="cb5-23" title="23">}</a></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1"><span class="kw">cat</span>(<span class="kw">tooltips</span>(<span class="dv">2</span>, <span class="st">&quot;TOOLTIP&quot;</span>))</a>
<a class="sourceLine" id="cb6-2" title="2"><span class="co">## var tooltips = [{</span></a>
<a class="sourceLine" id="cb6-3" title="3"><span class="co">##   overwrite: true,</span></a>
<a class="sourceLine" id="cb6-4" title="4"><span class="co">##   content: {</span></a>
<a class="sourceLine" id="cb6-5" title="5"><span class="co">##     text: $(&#39;#TOOLTIP-1&#39;).clone()</span></a>
<a class="sourceLine" id="cb6-6" title="6"><span class="co">##   },</span></a>
<a class="sourceLine" id="cb6-7" title="7"><span class="co">##   show: {</span></a>
<a class="sourceLine" id="cb6-8" title="8"><span class="co">##     ready: false</span></a>
<a class="sourceLine" id="cb6-9" title="9"><span class="co">##   },</span></a>
<a class="sourceLine" id="cb6-10" title="10"><span class="co">##   position: {</span></a>
<a class="sourceLine" id="cb6-11" title="11"><span class="co">##     my: &#39;bottom left&#39;,</span></a>
<a class="sourceLine" id="cb6-12" title="12"><span class="co">##     at: &#39;top center&#39;</span></a>
<a class="sourceLine" id="cb6-13" title="13"><span class="co">##   },</span></a>
<a class="sourceLine" id="cb6-14" title="14"><span class="co">##   style: {</span></a>
<a class="sourceLine" id="cb6-15" title="15"><span class="co">##     classes: &#39;qtip-youtube&#39;</span></a>
<a class="sourceLine" id="cb6-16" title="16"><span class="co">##   }</span></a>
<a class="sourceLine" id="cb6-17" title="17"><span class="co">## },{</span></a>
<a class="sourceLine" id="cb6-18" title="18"><span class="co">##   overwrite: true,</span></a>
<a class="sourceLine" id="cb6-19" title="19"><span class="co">##   content: {</span></a>
<a class="sourceLine" id="cb6-20" title="20"><span class="co">##     text: $(&#39;#TOOLTIP-2&#39;).clone()</span></a>
<a class="sourceLine" id="cb6-21" title="21"><span class="co">##   },</span></a>
<a class="sourceLine" id="cb6-22" title="22"><span class="co">##   show: {</span></a>
<a class="sourceLine" id="cb6-23" title="23"><span class="co">##     ready: false</span></a>
<a class="sourceLine" id="cb6-24" title="24"><span class="co">##   },</span></a>
<a class="sourceLine" id="cb6-25" title="25"><span class="co">##   position: {</span></a>
<a class="sourceLine" id="cb6-26" title="26"><span class="co">##     my: &#39;bottom right&#39;,</span></a>
<a class="sourceLine" id="cb6-27" title="27"><span class="co">##     at: &#39;top center&#39;</span></a>
<a class="sourceLine" id="cb6-28" title="28"><span class="co">##   },</span></a>
<a class="sourceLine" id="cb6-29" title="29"><span class="co">##   style: {</span></a>
<a class="sourceLine" id="cb6-30" title="30"><span class="co">##     classes: &#39;qtip-youtube&#39;</span></a>
<a class="sourceLine" id="cb6-31" title="31"><span class="co">##   }</span></a>
<a class="sourceLine" id="cb6-32" title="32"><span class="co">## }];</span></a></code></pre></div>
<p>Now we are ready to write the Shiny app. Put the files <strong>jquery.qtip.min.css</strong> and <strong>jquery.qtip.min.js</strong> in the <strong>www</strong> subfolder. We use the <code>shinyjs</code> package to run the JavaScript code with the function <code>runjs</code>.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" title="1"><span class="kw">library</span>(shiny)</a>
<a class="sourceLine" id="cb7-2" title="2"><span class="kw">library</span>(shinyjs)</a>
<a class="sourceLine" id="cb7-3" title="3"><span class="kw">library</span>(DT)</a>
<a class="sourceLine" id="cb7-4" title="4"></a>
<a class="sourceLine" id="cb7-5" title="5">CSS &lt;-<span class="st"> &quot;</span></a>
<a class="sourceLine" id="cb7-6" title="6"><span class="st">.qtip-big { </span></a>
<a class="sourceLine" id="cb7-7" title="7"><span class="st">  font-size: 15px;</span></a>
<a class="sourceLine" id="cb7-8" title="8"><span class="st">  line-height: 18px;</span></a>
<a class="sourceLine" id="cb7-9" title="9"><span class="st">  white-space: nowrap;</span></a>
<a class="sourceLine" id="cb7-10" title="10"><span class="st">  word-spacing: 1px;</span></a>
<a class="sourceLine" id="cb7-11" title="11"><span class="st">}</span></a>
<a class="sourceLine" id="cb7-12" title="12"><span class="st">&quot;</span></a>
<a class="sourceLine" id="cb7-13" title="13"></a>
<a class="sourceLine" id="cb7-14" title="14">ui &lt;-<span class="st"> </span><span class="kw">fluidPage</span>(</a>
<a class="sourceLine" id="cb7-15" title="15">  tags<span class="op">$</span><span class="kw">head</span>(</a>
<a class="sourceLine" id="cb7-16" title="16">    tags<span class="op">$</span><span class="kw">link</span>(<span class="dt">rel =</span> <span class="st">&quot;stylesheet&quot;</span>, <span class="dt">href =</span> <span class="st">&quot;jquery.qtip.min.css&quot;</span>),</a>
<a class="sourceLine" id="cb7-17" title="17">    tags<span class="op">$</span><span class="kw">script</span>(<span class="dt">src =</span> <span class="st">&quot;jquery.qtip.min.js&quot;</span>),</a>
<a class="sourceLine" id="cb7-18" title="18">    tags<span class="op">$</span><span class="kw">style</span>(CSS)</a>
<a class="sourceLine" id="cb7-19" title="19">  ),</a>
<a class="sourceLine" id="cb7-20" title="20">  <span class="kw">useShinyjs</span>(),</a>
<a class="sourceLine" id="cb7-21" title="21">  <span class="kw">br</span>(), <span class="kw">br</span>(), <span class="kw">br</span>(), <span class="kw">br</span>(), <span class="kw">br</span>(), </a>
<a class="sourceLine" id="cb7-22" title="22">  <span class="kw">DTOutput</span>(<span class="st">&quot;dtable&quot;</span>)</a>
<a class="sourceLine" id="cb7-23" title="23">)</a>
<a class="sourceLine" id="cb7-24" title="24"></a>
<a class="sourceLine" id="cb7-25" title="25">server &lt;-<span class="st"> </span><span class="cf">function</span>(input, output, session){</a>
<a class="sourceLine" id="cb7-26" title="26">  </a>
<a class="sourceLine" id="cb7-27" title="27">  output[[<span class="st">&quot;dtable&quot;</span>]] &lt;-<span class="st"> </span><span class="kw">renderDT</span>({</a>
<a class="sourceLine" id="cb7-28" title="28">    </a>
<a class="sourceLine" id="cb7-29" title="29">    dat &lt;-<span class="st"> </span>iris</a>
<a class="sourceLine" id="cb7-30" title="30">    </a>
<a class="sourceLine" id="cb7-31" title="31">    <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">ncol</span>(dat)){</a>
<a class="sourceLine" id="cb7-32" title="32">      <span class="kw">runjs</span>(<span class="kw">createDiv</span>(i, <span class="st">&quot;TOOLTIP&quot;</span>))</a>
<a class="sourceLine" id="cb7-33" title="33">      <span class="kw">runjs</span>(<span class="kw">fillDiv</span>(dat, i, <span class="st">&quot;TOOLTIP&quot;</span>))</a>
<a class="sourceLine" id="cb7-34" title="34">    }</a>
<a class="sourceLine" id="cb7-35" title="35">    </a>
<a class="sourceLine" id="cb7-36" title="36">    headerCallback &lt;-<span class="st"> </span><span class="kw">c</span>(</a>
<a class="sourceLine" id="cb7-37" title="37">      <span class="st">&quot;function(thead, data, start, end, display){&quot;</span>,</a>
<a class="sourceLine" id="cb7-38" title="38">      <span class="st">&quot;  var ncols = data[0].length;&quot;</span>,</a>
<a class="sourceLine" id="cb7-39" title="39">      <span class="kw">tooltips</span>(<span class="kw">ncol</span>(dat), <span class="st">&quot;TOOLTIP&quot;</span>),</a>
<a class="sourceLine" id="cb7-40" title="40">      <span class="st">&quot;  for(var i = 1; i &lt; ncols; i++){&quot;</span>,</a>
<a class="sourceLine" id="cb7-41" title="41">      <span class="st">&quot;    $(&#39;th:eq(&#39; + i + &#39;)&#39;, thead).qtip(tooltips[i-1]);&quot;</span>, </a>
<a class="sourceLine" id="cb7-42" title="42">      <span class="st">&quot;  }&quot;</span>,</a>
<a class="sourceLine" id="cb7-43" title="43">      <span class="st">&quot;}&quot;</span></a>
<a class="sourceLine" id="cb7-44" title="44">    )</a>
<a class="sourceLine" id="cb7-45" title="45">    </a>
<a class="sourceLine" id="cb7-46" title="46">    <span class="kw">datatable</span>(</a>
<a class="sourceLine" id="cb7-47" title="47">      dat, </a>
<a class="sourceLine" id="cb7-48" title="48">      <span class="dt">options =</span> <span class="kw">list</span>(</a>
<a class="sourceLine" id="cb7-49" title="49">        <span class="dt">headerCallback =</span> <span class="kw">JS</span>(headerCallback),</a>
<a class="sourceLine" id="cb7-50" title="50">        <span class="dt">columnDefs =</span> <span class="kw">list</span>(</a>
<a class="sourceLine" id="cb7-51" title="51">          <span class="kw">list</span>(<span class="dt">className =</span> <span class="st">&quot;dt-center&quot;</span>, <span class="dt">targets =</span> <span class="st">&quot;_all&quot;</span>)</a>
<a class="sourceLine" id="cb7-52" title="52">        )</a>
<a class="sourceLine" id="cb7-53" title="53">      )</a>
<a class="sourceLine" id="cb7-54" title="54">    )</a>
<a class="sourceLine" id="cb7-55" title="55">  })</a>
<a class="sourceLine" id="cb7-56" title="56">  </a>
<a class="sourceLine" id="cb7-57" title="57">}</a>
<a class="sourceLine" id="cb7-58" title="58"></a>
<a class="sourceLine" id="cb7-59" title="59"><span class="kw">shinyApp</span>(ui, server)</a></code></pre></div>
<p><img src="https://laustep.github.io/stlahblog/posts/figures/DTqTip.gif" /></p>

        </div>


        <div id="footer">
          Site proudly generated by
          <a href="http://jaspervdj.be/hakyll">Hakyll</a>
        </div>

      </div>

    </div>

    <div class="row">
      <div class="col-sm-12">
        <div id="disqus_thread"></div>
        <div class="pagination">
          <ul>
            <li>
              <a href="http://laustep.github.io/stlahblog/">&#171; Back Home</a>
            </li>
          </ul>
        </div>
      </div>
    </div>

  </div>


<script src="https://laustep.github.io/stlahblog/libraries/bootstrap/bootstrap.min.js"></script>
<!-- MathJax: Fall back to local if CDN offline but local image fonts are not supported (saves >100MB) -->
<script type="text/x-mathjax-config" src="https://laustep.github.io/stlahblog/libraries/mathjax/config/TeX-MML-AM_CHTML.js"></script>
<!-- <script>
  window.MathJax || document.write('<script type="text/x-mathjax-config">MathJax.Hub.Config({"HTML-CSS":{imageFont:null}});<\/script><script src="https://laustep.github.io/stlahblog/libraries/mathjax/MathJax.js"><\/script>');
</script> -->



]]></description>
    <pubDate>Sun, 16 Feb 2020 00:00:00 UT</pubDate>
    <guid>https://laustep.github.io/stlahblog/posts/DTqTips.html</guid>
    <dc:creator>Stéphane Laurent</dc:creator>

        <category>R</category>

</item>
    </channel>
</rss>
